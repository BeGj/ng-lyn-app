(self.webpackChunkNgLyn=self.webpackChunkNgLyn||[]).push([[69],{3069:(Yi,ir,it)=>{"use strict";it.r(ir),it.d(ir,{LigthningMapModule:()=>Rp});var Pn=it(4274),q=it(2859),Ln=function(){function n(){this.disposed=!1}return n.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},n.prototype.disposeInternal=function(){},n}();const Bt=Ln;function jt(n,r){return n>r?1:n<r?-1:0}function or(n,r,t){var e=n.length;if(n[0]<=r)return 0;if(r<=n[e-1])return e-1;var i=void 0;if(t>0){for(i=1;i<e;++i)if(n[i]<r)return i-1}else if(t<0){for(i=1;i<e;++i)if(n[i]<=r)return i}else for(i=1;i<e;++i){if(n[i]==r)return i;if(n[i]<r)return"function"==typeof t?t(r,n[i-1],n[i])>0?i-1:i:n[i-1]-r<r-n[i]?i-1:i}return e-1}function xe(n,r){for(var t=Array.isArray(r)?r:[r],e=t.length,i=0;i<e;i++)n[n.length]=t[i]}function Dt(n,r){var t=n.length;if(t!==r.length)return!1;for(var e=0;e<t;e++)if(n[e]!==r[e])return!1;return!0}function x(){return!0}function M(){return!1}function O(){}function A(){return function(){throw new Error("Unimplemented abstract method.")}()}var Y=0;function P(n){return n.ol_uid||(n.ol_uid=String(++Y))}var n,z=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",st=-1!==z.indexOf("firefox"),ee=-1!==z.indexOf("safari")&&-1==z.indexOf("chrom")&&!!(z.indexOf("version/15.4")>=0||z.match(/cpu (os|iphone os) 15_4 like mac os x/)),ue=-1!==z.indexOf("webkit")&&-1==z.indexOf("edge"),le=-1!==z.indexOf("macintosh"),Lr=typeof devicePixelRatio<"u"?devicePixelRatio:1,ce=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,we=typeof Image<"u"&&Image.prototype.decode,Ct=function(){var n=!1;try{var r=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,r),window.removeEventListener("_",null,r)}catch{}return n}(),Os=(n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)},function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),Ps=function(n){function r(t){var e=this,o="Assertion failed. See https://openlayers.org/en/v"+"6.15.1".split("-")[0]+"/doc/errors/#"+t+" for details.";return(e=n.call(this,o)||this).code=t,e.name="AssertionError",e.message=o,e}return Os(r,n),r}(Error);const Vi=Ps;function W(n,r){if(!n)throw new Vi(r)}var Zi,Mn=new Array(6);function Ir(n){return sr(n,1,0,0,1,0,0)}function De(n,r){var t=n[0],e=n[1],i=n[2],o=n[3],a=n[4],s=n[5],u=r[0],l=r[1],c=r[2],h=r[3],f=r[4],d=r[5];return n[0]=t*u+i*l,n[1]=e*u+o*l,n[2]=t*c+i*h,n[3]=e*c+o*h,n[4]=t*f+i*d+a,n[5]=e*f+o*d+s,n}function sr(n,r,t,e,i,o,a){return n[0]=r,n[1]=t,n[2]=e,n[3]=i,n[4]=o,n[5]=a,n}function ut(n,r){var t=r[0],e=r[1];return r[0]=n[0]*t+n[2]*e+n[4],r[1]=n[1]*t+n[3]*e+n[5],r}function Ki(n,r){var t=Math.cos(r),e=Math.sin(r);return De(n,sr(Mn,t,e,-e,t,0,0))}function Fn(n,r,t){return De(n,sr(Mn,r,0,0,t,0,0))}function Dn(n,r,t){return De(n,sr(Mn,1,0,0,1,r,t))}function Zt(n,r,t,e,i,o,a,s){var u=Math.sin(o),l=Math.cos(o);return n[0]=e*l,n[1]=i*u,n[2]=-e*u,n[3]=i*l,n[4]=a*e*l-s*e*u+r,n[5]=a*i*u+s*i*l+t,n}function Mr(n,r){var t=function Ls(n){return n[0]*n[3]-n[1]*n[2]}(r);W(0!==t,32);var e=r[0],i=r[1],o=r[2],a=r[3],s=r[4],u=r[5];return n[0]=a/t,n[1]=-i/t,n[2]=-o/t,n[3]=e/t,n[4]=(o*u-a*s)/t,n[5]=-(e*u-i*s)/t,n}function Nn(n){for(var r=[1/0,1/0,-1/0,-1/0],t=0,e=n.length;t<e;++t)ur(r,n[t]);return r}function qi(n,r,t){var e,i;return(e=r<n[0]?n[0]-r:n[2]<r?r-n[2]:0)*e+(i=t<n[1]?n[1]-t:n[3]<t?t-n[3]:0)*i}function Ae(n,r){return Ji(n,r[0],r[1])}function bn(n,r){return n[0]<=r[0]&&r[2]<=n[2]&&n[1]<=r[1]&&r[3]<=n[3]}function Ji(n,r,t){return n[0]<=r&&r<=n[2]&&n[1]<=t&&t<=n[3]}function Qi(n,r){var a=r[0],s=r[1],u=0;return a<n[0]?u|=16:a>n[2]&&(u|=4),s<n[1]?u|=8:s>n[3]&&(u|=2),0===u&&(u=1),u}function fe(n,r,t,e,i){return i?(i[0]=n,i[1]=r,i[2]=t,i[3]=e,i):[n,r,t,e]}function Ne(n){return fe(1/0,1/0,-1/0,-1/0,n)}function be(n,r){return n[0]==r[0]&&n[2]==r[2]&&n[1]==r[1]&&n[3]==r[3]}function ur(n,r){r[0]<n[0]&&(n[0]=r[0]),r[0]>n[2]&&(n[2]=r[0]),r[1]<n[1]&&(n[1]=r[1]),r[1]>n[3]&&(n[3]=r[1])}function to(n,r,t,e,i){for(;t<e;t+=i)Us(n,r[t],r[t+1]);return n}function Us(n,r,t){n[0]=Math.min(n[0],r),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],r),n[3]=Math.max(n[3],t)}function eo(n,r){var t;return!!((t=r(Dr(n)))||(t=r(Nr(n)),t)||(t=r(br(n)),t)||(t=r(Se(n)),t))&&t}function Fr(n){var r=0;return Gr(n)||(r=et(n)*Pt(n)),r}function Dr(n){return[n[0],n[1]]}function Nr(n){return[n[2],n[1]]}function Ge(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function Xs(n,r){var t;return"bottom-left"===r?t=Dr(n):"bottom-right"===r?t=Nr(n):"top-left"===r?t=Se(n):"top-right"===r?t=br(n):W(!1,13),t}function Gn(n,r,t,e,i){var o=Un(n,r,t,e),a=o[0],s=o[1],u=o[2],l=o[3],c=o[4],h=o[5],f=o[6],d=o[7];return fe(Math.min(a,u,c,f),Math.min(s,l,h,d),Math.max(a,u,c,f),Math.max(s,l,h,d),i)}function Un(n,r,t,e){var i=r*e[0]/2,o=r*e[1]/2,a=Math.cos(t),s=Math.sin(t),u=i*a,l=i*s,c=o*a,h=o*s,f=n[0],d=n[1];return[f-u+h,d-l-c,f-u-h,d-l+c,f+u-h,d+l+c,f+u+h,d+l-c,f-u+h,d-l-c]}function Pt(n){return n[3]-n[1]}function re(n,r,t){var e=t||[1/0,1/0,-1/0,-1/0];return Ht(n,r)?(e[0]=n[0]>r[0]?n[0]:r[0],e[1]=n[1]>r[1]?n[1]:r[1],e[2]=n[2]<r[2]?n[2]:r[2],e[3]=n[3]<r[3]?n[3]:r[3]):Ne(e),e}function Se(n){return[n[0],n[3]]}function br(n){return[n[2],n[3]]}function et(n){return n[2]-n[0]}function Ht(n,r){return n[0]<=r[2]&&n[2]>=r[0]&&n[1]<=r[3]&&n[3]>=r[1]}function Gr(n){return n[2]<n[0]||n[3]<n[1]}function ht(n,r,t){return Math.min(Math.max(n,r),t)}var ks="cosh"in Math?Math.cosh:function(r){var t=Math.exp(r);return(t+1/t)/2},ro="log2"in Math?Math.log2:function(r){return Math.log(r)*Math.LOG2E};function Vs(n,r,t,e,i,o){var a=i-t,s=o-e;if(0!==a||0!==s){var u=((n-t)*a+(r-e)*s)/(a*a+s*s);u>1?(t=i,e=o):u>0&&(t+=a*u,e+=s*u)}return Ue(n,r,t,e)}function Ue(n,r,t,e){var i=t-n,o=e-r;return i*i+o*o}function Ur(n){return n*Math.PI/180}function Xe(n,r){var t=n%r;return t*r<0?t+r:t}function Zs(n,r,t){return n+t*(r-n)}function Xn(n,r){var t=Math.pow(10,r);return Math.round(n*t)/t}function Xr(n,r){return Math.floor(Xn(n,r))}function Br(n,r){return Math.ceil(Xn(n,r))}var no=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,io=/^([a-z]*)$|^hsla?\(.*\)$/i;function oo(n){var r=document.createElement("div");if(r.style.color=n,""!==r.style.color){document.body.appendChild(r);var t=getComputedStyle(r).color;return document.body.removeChild(r),t}return""}var r,t,ao=(r={},t=0,function(e){var i;if(r.hasOwnProperty(e))i=r[e];else{if(t>=1024){var o=0;for(var a in r)0==(3&o++)&&(delete r[a],--t)}i=function qs(n){var r,t,e,i,o;if(io.exec(n)&&(n=oo(n)),no.exec(n)){var s,a=n.length-1;s=a<=4?1:2;var u=4===a||8===a;r=parseInt(n.substr(1+0*s,s),16),t=parseInt(n.substr(1+1*s,s),16),e=parseInt(n.substr(1+2*s,s),16),i=u?parseInt(n.substr(1+3*s,s),16):255,1==s&&(r=(r<<4)+r,t=(t<<4)+t,e=(e<<4)+e,u&&(i=(i<<4)+i)),o=[r,t,e,i/255]}else 0==n.indexOf("rgba(")?so(o=n.slice(5,-1).split(",").map(Number)):0==n.indexOf("rgb(")?((o=n.slice(4,-1).split(",").map(Number)).push(1),so(o)):W(!1,14);return o}(e),r[e]=i,++t}return i});function jr(n){return Array.isArray(n)?n:ao(n)}function so(n){return n[0]=ht(n[0]+.5|0,0,255),n[1]=ht(n[1]+.5|0,0,255),n[2]=ht(n[2]+.5|0,0,255),n[3]=ht(n[3],0,1),n}function uo(n){var r=n[0];r!=(0|r)&&(r=r+.5|0);var t=n[1];t!=(0|t)&&(t=t+.5|0);var e=n[2];return e!=(0|e)&&(e=e+.5|0),"rgba("+r+","+t+","+e+","+(void 0===n[3]?1:Math.round(100*n[3])/100)+")"}var Qs=function(){function n(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return n.prototype.clear=function(){this.cache_={},this.cacheSize_=0},n.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},n.prototype.expire=function(){if(this.canExpireCache()){var r=0;for(var t in this.cache_)0==(3&r++)&&!this.cache_[t].hasListener()&&(delete this.cache_[t],--this.cacheSize_)}},n.prototype.get=function(r,t,e){var i=lo(r,t,e);return i in this.cache_?this.cache_[i]:null},n.prototype.set=function(r,t,e,i){var o=lo(r,t,e);this.cache_[o]=i,++this.cacheSize_},n.prototype.setSize=function(r){this.maxCacheSize_=r,this.expire()},n}();function lo(n,r,t){var e=t?function Hs(n){return"string"==typeof n?n:uo(n)}(t):"null";return r+":"+n+":"+e}var co=new Qs,$s=function(){function n(r){this.type=r,this.target=null}return n.prototype.preventDefault=function(){this.defaultPrevented=!0},n.prototype.stopPropagation=function(){this.propagationStopped=!0},n}();const ne=$s;var ot="function"==typeof Object.assign?Object.assign:function(n,r){if(null==n)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(n),e=1,i=arguments.length;e<i;++e){var o=arguments[e];if(null!=o)for(var a in o)o.hasOwnProperty(a)&&(t[a]=o[a])}return t};function je(n){for(var r in n)delete n[r]}var ho="function"==typeof Object.values?Object.values:function(n){var r=[];for(var t in n)r.push(n[t]);return r};function zr(n){var r;for(r in n)return!1;return!r}var tu=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),eu=function(n){function r(t){var e=n.call(this)||this;return e.eventTarget_=t,e.pendingRemovals_=null,e.dispatching_=null,e.listeners_=null,e}return tu(r,n),r.prototype.addEventListener=function(t,e){if(t&&e){var i=this.listeners_||(this.listeners_={}),o=i[t]||(i[t]=[]);-1===o.indexOf(e)&&o.push(e)}},r.prototype.dispatchEvent=function(t){var e="string"==typeof t,i=e?t:t.type,o=this.listeners_&&this.listeners_[i];if(o){var a=e?new ne(t):t;a.target||(a.target=this.eventTarget_||this);var s=this.dispatching_||(this.dispatching_={}),u=this.pendingRemovals_||(this.pendingRemovals_={});i in s||(s[i]=0,u[i]=0),++s[i];for(var l,c=0,h=o.length;c<h;++c)if(!1===(l="handleEvent"in o[c]?o[c].handleEvent(a):o[c].call(this,a))||a.propagationStopped){l=!1;break}if(0==--s[i]){var f=u[i];for(delete u[i];f--;)this.removeEventListener(i,O);delete s[i]}return l}},r.prototype.disposeInternal=function(){this.listeners_&&je(this.listeners_)},r.prototype.getListeners=function(t){return this.listeners_&&this.listeners_[t]||void 0},r.prototype.hasListener=function(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)},r.prototype.removeEventListener=function(t,e){var i=this.listeners_&&this.listeners_[t];if(i){var o=i.indexOf(e);-1!==o&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[o]=O,++this.pendingRemovals_[t]):(i.splice(o,1),0===i.length&&delete this.listeners_[t]))}},r}(Bt);const ze=eu;function j(n,r,t,e,i){if(e&&e!==n&&(t=t.bind(e)),i){var o=t;t=function(){n.removeEventListener(r,t),o.apply(this,arguments)}}var a={target:n,type:r,listener:t};return n.addEventListener(r,t),a}function Wr(n,r,t,e){return j(n,r,t,e,!0)}function Q(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),je(n))}var ru=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Yr=function(n){function r(){var t=n.call(this)||this;return t.on=t.onInternal,t.once=t.onceInternal,t.un=t.unInternal,t.revision_=0,t}return ru(r,n),r.prototype.changed=function(){++this.revision_,this.dispatchEvent("change")},r.prototype.getRevision=function(){return this.revision_},r.prototype.onInternal=function(t,e){if(Array.isArray(t)){for(var i=t.length,o=new Array(i),a=0;a<i;++a)o[a]=j(this,t[a],e);return o}return j(this,t,e)},r.prototype.onceInternal=function(t,e){var i;if(Array.isArray(t)){var o=t.length;i=new Array(o);for(var a=0;a<o;++a)i[a]=Wr(this,t[a],e)}else i=Wr(this,t,e);return e.ol_key=i,i},r.prototype.unInternal=function(t,e){var i=e.ol_key;if(i)fo(i);else if(Array.isArray(t))for(var o=0,a=t.length;o<a;++o)this.removeEventListener(t[o],e);else this.removeEventListener(t,e)},r}(ze);function fo(n){if(Array.isArray(n))for(var r=0,t=n.length;r<t;++r)Q(n[r]);else Q(n)}const po=Yr;var vo=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),_o=function(n){function r(t,e,i){var o=n.call(this,t)||this;return o.key=e,o.oldValue=i,o}return vo(r,n),r}(ne),nu=function(n){function r(t){var e=n.call(this)||this;return P(e),e.values_=null,void 0!==t&&e.setProperties(t),e}return vo(r,n),r.prototype.get=function(t){var e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},r.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},r.prototype.getProperties=function(){return this.values_&&ot({},this.values_)||{}},r.prototype.hasProperties=function(){return!!this.values_},r.prototype.notify=function(t,e){var i;i="change:".concat(t),this.hasListener(i)&&this.dispatchEvent(new _o(i,t,e)),this.hasListener(i="propertychange")&&this.dispatchEvent(new _o(i,t,e))},r.prototype.addChangeListener=function(t,e){this.addEventListener("change:".concat(t),e)},r.prototype.removeChangeListener=function(t,e){this.removeEventListener("change:".concat(t),e)},r.prototype.set=function(t,e,i){var o=this.values_||(this.values_={});if(i)o[t]=e;else{var a=o[t];o[t]=e,a!==e&&this.notify(t,a)}},r.prototype.setProperties=function(t,e){for(var i in t)this.set(i,t[i],e)},r.prototype.applyProperties=function(t){!t.values_||ot(this.values_||(this.values_={}),t.values_)},r.prototype.unset=function(t,e){if(this.values_&&t in this.values_){var i=this.values_[t];delete this.values_[t],zr(this.values_)&&(this.values_=null),e||this.notify(t,i)}},r}(po);const qt=nu;var iu=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),ou=function(n){function r(t){var e=n.call(this)||this;e.background_=t.background;var i=ot({},t);return"object"==typeof t.properties&&(delete i.properties,ot(i,t.properties)),i.opacity=void 0!==t.opacity?t.opacity:1,W("number"==typeof i.opacity,64),i.visible=void 0===t.visible||t.visible,i.zIndex=t.zIndex,i.maxResolution=void 0!==t.maxResolution?t.maxResolution:1/0,i.minResolution=void 0!==t.minResolution?t.minResolution:0,i.minZoom=void 0!==t.minZoom?t.minZoom:-1/0,i.maxZoom=void 0!==t.maxZoom?t.maxZoom:1/0,e.className_=void 0!==i.className?i.className:"ol-layer",delete i.className,e.setProperties(i),e.state_=null,e}return iu(r,n),r.prototype.getBackground=function(){return this.background_},r.prototype.getClassName=function(){return this.className_},r.prototype.getLayerState=function(t){var e=this.state_||{layer:this,managed:void 0===t||t},i=this.getZIndex();return e.opacity=ht(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==i||e.managed?i:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e},r.prototype.getLayersArray=function(t){return A()},r.prototype.getLayerStatesArray=function(t){return A()},r.prototype.getExtent=function(){return this.get("extent")},r.prototype.getMaxResolution=function(){return this.get("maxResolution")},r.prototype.getMinResolution=function(){return this.get("minResolution")},r.prototype.getMinZoom=function(){return this.get("minZoom")},r.prototype.getMaxZoom=function(){return this.get("maxZoom")},r.prototype.getOpacity=function(){return this.get("opacity")},r.prototype.getSourceState=function(){return A()},r.prototype.getVisible=function(){return this.get("visible")},r.prototype.getZIndex=function(){return this.get("zIndex")},r.prototype.setBackground=function(t){this.background_=t,this.changed()},r.prototype.setExtent=function(t){this.set("extent",t)},r.prototype.setMaxResolution=function(t){this.set("maxResolution",t)},r.prototype.setMinResolution=function(t){this.set("minResolution",t)},r.prototype.setMaxZoom=function(t){this.set("maxZoom",t)},r.prototype.setMinZoom=function(t){this.set("minZoom",t)},r.prototype.setOpacity=function(t){W("number"==typeof t,64),this.set("opacity",t)},r.prototype.setVisible=function(t){this.set("visible",t)},r.prototype.setZIndex=function(t){this.set("zIndex",t)},r.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),n.prototype.disposeInternal.call(this)},r}(qt);const go=ou;var au=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),su=function(n){function r(t){var e=this,i=ot({},t);return delete i.source,(e=n.call(this,i)||this).mapPrecomposeKey_=null,e.mapRenderKey_=null,e.sourceChangeKey_=null,e.renderer_=null,e.rendered=!1,t.render&&(e.render=t.render),t.map&&e.setMap(t.map),e.addChangeListener("source",e.handleSourcePropertyChange_),e.setSource(t.source?t.source:null),e}return au(r,n),r.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},r.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},r.prototype.getSource=function(){return this.get("source")||null},r.prototype.getRenderSource=function(){return this.getSource()},r.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():"undefined"},r.prototype.handleSourceChange_=function(){this.changed()},r.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(Q(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=j(t,"change",this.handleSourceChange_,this)),this.changed()},r.prototype.getFeatures=function(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(function(e){return e([])})},r.prototype.getData=function(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null},r.prototype.render=function(t,e){var i=this.getRenderer();if(i.prepareFrame(t))return this.rendered=!0,i.renderFrame(t,e)},r.prototype.unrender=function(){this.rendered=!1},r.prototype.setMapInternal=function(t){t||this.unrender(),this.set("map",t)},r.prototype.getMapInternal=function(){return this.get("map")},r.prototype.setMap=function(t){this.mapPrecomposeKey_&&(Q(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Q(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=j(t,"precompose",function(e){var o=e.frameState.layerStatesArray,a=this.getLayerState(!1);W(!o.some(function(s){return s.layer===a.layer}),67),o.push(a)},this),this.mapRenderKey_=j(this,"change",t.render,t),this.changed())},r.prototype.setSource=function(t){this.set("source",t)},r.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},r.prototype.hasRenderer=function(){return!!this.renderer_},r.prototype.createRenderer=function(){return null},r.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),n.prototype.disposeInternal.call(this)},r}(go);function kr(n,r){if(!n.visible)return!1;var t=r.resolution;if(t<n.minResolution||t>=n.maxResolution)return!1;var e=r.zoom;return e>n.minZoom&&e<=n.maxZoom}const lr=su;function Vr(n,r){for(var t=!0,e=n.length-1;e>=0;--e)if(n[e]!=r[e]){t=!1;break}return t}function Bn(n,r){var t=Math.cos(r),e=Math.sin(r),o=n[1]*t+n[0]*e;return n[0]=n[0]*t-n[1]*e,n[1]=o,n}var vu=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),_u=function(n){function r(t){var e=n.call(this)||this;return e.map_=t,e}return vu(r,n),r.prototype.dispatchRenderEvent=function(t,e){A()},r.prototype.calculateMatrices2D=function(t){var e=t.viewState,i=t.coordinateToPixelTransform,o=t.pixelToCoordinateTransform;Zt(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Mr(o,i)},r.prototype.forEachFeatureAtCoordinate=function(t,e,i,o,a,s,u,l){var c,h=e.viewState;function f(rt,Z,J,H){return a.call(s,Z,rt?J:null,H)}var d=h.projection,p=function du(n,r){if(r.canWrapX()){var t=et(r.getExtent()),e=function pu(n,r,t){var e=r.getExtent(),i=0;if(r.canWrapX()&&(n[0]<e[0]||n[0]>e[2])){var o=t||et(e);i=Math.floor((n[0]-e[0])/o)}return i}(n,r,t);e&&(n[0]-=e*t)}return n}(t.slice(),d),v=[[0,0]];if(d.canWrapX()&&o){var R=et(d.getExtent());v.push([-R,0],[R,0])}for(var T=e.layerStatesArray,m=T.length,E=[],w=[],I=0;I<v.length;I++)for(var C=m-1;C>=0;--C){var N=T[C],X=N.layer;if(X.hasRenderer()&&kr(N,h)&&u.call(l,X)){var B=X.getRenderer(),k=X.getSource();if(B&&k){var lt=k.getWrapX()?p:t,Tt=f.bind(null,N.managed);w[0]=lt[0]+v[I][0],w[1]=lt[1]+v[I][1],c=B.forEachFeatureAtCoordinate(w,e,i,Tt,E)}if(c)return c}}if(0!==E.length){var Rt=1/E.length;return E.forEach(function(rt,Z){return rt.distanceSq+=Z*Rt}),E.sort(function(rt,Z){return rt.distanceSq-Z.distanceSq}),E.some(function(rt){return c=rt.callback(rt.feature,rt.layer,rt.geometry)}),c}},r.prototype.forEachLayerAtPixel=function(t,e,i,o,a){return A()},r.prototype.hasFeatureAtCoordinate=function(t,e,i,o,a,s){return void 0!==this.forEachFeatureAtCoordinate(t,e,i,o,x,this,a,s)},r.prototype.getMap=function(){return this.map_},r.prototype.renderFrame=function(t){A()},r.prototype.scheduleExpireIconCache=function(t){co.canExpireCache()&&t.postRenderFunctions.push(gu)},r}(Bt);function gu(n,r){co.expire()}const yu=_u;var mu=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Eu=function(n){function r(t,e,i,o){var a=n.call(this,t)||this;return a.inversePixelTransform=e,a.frameState=i,a.context=o,a}return mu(r,n),r}(ne);const cr=Eu;var Kr="ol-hidden",hr="ol-unselectable",Eo="ol-unsupported",Zr="ol-control",To="ol-collapsed";new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i");function Oe(n,r,t,e){var i;return i=t&&t.length?t.shift():ce?new OffscreenCanvas(n||300,r||300):document.createElement("canvas"),n&&(i.width=n),r&&(i.height=r),i.getContext("2d",e)}function Hr(n,r){var t=r.parentNode;t&&t.replaceChild(n,r)}function jn(n){return n&&n.parentNode?n.parentNode.removeChild(n):null}var qr="#000",wo=[],Jr="round",Wn="#000",ie=new qt;(new ze).setSize=function(){console.warn("labelCache is deprecated.")};var Lu=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Iu=function(n){function r(t){var e=n.call(this,t)||this;e.fontChangeListenerKey_=j(ie,"propertychange",t.redrawText.bind(t)),e.element_=document.createElement("div");var i=e.element_.style;i.position="absolute",i.width="100%",i.height="100%",i.zIndex="0",e.element_.className=hr+" ol-layers";var o=t.getViewport();return o.insertBefore(e.element_,o.firstChild||null),e.children_=[],e.renderedVisible_=!0,e}return Lu(r,n),r.prototype.dispatchRenderEvent=function(t,e){var i=this.getMap();if(i.hasListener(t)){var o=new cr(t,void 0,e);i.dispatchEvent(o)}},r.prototype.disposeInternal=function(){Q(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),n.prototype.disposeInternal.call(this)},r.prototype.renderFrame=function(t){if(t){this.calculateMatrices2D(t),this.dispatchRenderEvent("precompose",t);var e=t.layerStatesArray.sort(function(d,p){return d.zIndex-p.zIndex}),i=t.viewState;this.children_.length=0;for(var o=[],a=null,s=0,u=e.length;s<u;++s){var l=e[s];t.layerIndex=s;var c=l.layer,h=c.getSourceState();if(!kr(l,i)||"ready"!=h&&"undefined"!=h)c.unrender();else{var f=c.render(t,a);!f||(f!==a&&(this.children_.push(f),a=f),"getDeclutter"in c&&o.push(c))}}for(s=o.length-1;s>=0;--s)o[s].renderDeclutter(t);(function Cu(n,r){for(var t=n.childNodes,e=0;;++e){var i=t[e],o=r[e];if(!i&&!o)break;if(i!==o){if(!i){n.appendChild(o);continue}if(!o){n.removeChild(i),--e;continue}n.insertBefore(o,i)}}})(this.element_,this.children_),this.dispatchRenderEvent("postcompose",t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}else this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1)},r.prototype.forEachLayerAtPixel=function(t,e,i,o,a){for(var s=e.viewState,u=e.layerStatesArray,c=u.length-1;c>=0;--c){var h=u[c],f=h.layer;if(f.hasRenderer()&&kr(h,s)&&a(f)){var p=f.getRenderer().getDataAtPixel(t,e,i);if(p){var v=o(f,p);if(v)return v}}}},r}(yu);const Mu=Iu;var Po=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),$r=function(n){function r(t,e,i){var o=n.call(this,t)||this;return o.element=e,o.index=i,o}return Po(r,n),r}(ne),Fu=function(n){function r(t,e){var i=n.call(this)||this;if(i.unique_=!!(e||{}).unique,i.array_=t||[],i.unique_)for(var a=0,s=i.array_.length;a<s;++a)i.assertUnique_(i.array_[a],a);return i.updateLength_(),i}return Po(r,n),r.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},r.prototype.extend=function(t){for(var e=0,i=t.length;e<i;++e)this.push(t[e]);return this},r.prototype.forEach=function(t){for(var e=this.array_,i=0,o=e.length;i<o;++i)t(e[i],i,e)},r.prototype.getArray=function(){return this.array_},r.prototype.item=function(t){return this.array_[t]},r.prototype.getLength=function(){return this.get("length")},r.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new $r("add",e,t))},r.prototype.pop=function(){return this.removeAt(this.getLength()-1)},r.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()},r.prototype.remove=function(t){for(var e=this.array_,i=0,o=e.length;i<o;++i)if(e[i]===t)return this.removeAt(i)},r.prototype.removeAt=function(t){var e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new $r("remove",e,t)),e},r.prototype.setAt=function(t,e){var i=this.getLength();if(t<i){this.unique_&&this.assertUnique_(e,t);var o=this.array_[t];this.array_[t]=e,this.dispatchEvent(new $r("remove",o,t)),this.dispatchEvent(new $r("add",e,t))}else{for(var a=i;a<t;++a)this.insertAt(a,void 0);this.insertAt(t,e)}},r.prototype.updateLength_=function(){this.set("length",this.array_.length)},r.prototype.assertUnique_=function(t,e){for(var i=0,o=this.array_.length;i<o;++i)if(this.array_[i]===t&&i!==e)throw new Vi(58)},r}(qt);const Nt=Fu;var Io=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),de=function(n){function r(t,e){var i=n.call(this,t)||this;return i.layer=e,i}return Io(r,n),r}(ne),Du=function(n){function r(t){var e=this,i=t||{},o=ot({},i);delete o.layers;var a=i.layers;return(e=n.call(this,o)||this).layersListenerKeys_=[],e.listenerKeys_={},e.addChangeListener("layers",e.handleLayersChanged_),a?Array.isArray(a)?a=new Nt(a.slice(),{unique:!0}):W("function"==typeof a.getArray,43):a=new Nt(void 0,{unique:!0}),e.setLayers(a),e}return Io(r,n),r.prototype.handleLayerChange_=function(){this.changed()},r.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(Q),this.layersListenerKeys_.length=0;var t=this.getLayers();for(var e in this.layersListenerKeys_.push(j(t,"add",this.handleLayersAdd_,this),j(t,"remove",this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[e].forEach(Q);je(this.listenerKeys_);for(var i=t.getArray(),o=0,a=i.length;o<a;o++){var s=i[o];this.registerLayerListeners_(s),this.dispatchEvent(new de("addlayer",s))}this.changed()},r.prototype.registerLayerListeners_=function(t){var e=[j(t,"propertychange",this.handleLayerChange_,this),j(t,"change",this.handleLayerChange_,this)];t instanceof r&&e.push(j(t,"addlayer",this.handleLayerGroupAdd_,this),j(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[P(t)]=e},r.prototype.handleLayerGroupAdd_=function(t){this.dispatchEvent(new de("addlayer",t.layer))},r.prototype.handleLayerGroupRemove_=function(t){this.dispatchEvent(new de("removelayer",t.layer))},r.prototype.handleLayersAdd_=function(t){var e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new de("addlayer",e)),this.changed()},r.prototype.handleLayersRemove_=function(t){var e=t.element,i=P(e);this.listenerKeys_[i].forEach(Q),delete this.listenerKeys_[i],this.dispatchEvent(new de("removelayer",e)),this.changed()},r.prototype.getLayers=function(){return this.get("layers")},r.prototype.setLayers=function(t){var e=this.getLayers();if(e)for(var i=e.getArray(),o=0,a=i.length;o<a;++o)this.dispatchEvent(new de("removelayer",i[o]));this.set("layers",t)},r.prototype.getLayersArray=function(t){var e=void 0!==t?t:[];return this.getLayers().forEach(function(i){i.getLayersArray(e)}),e},r.prototype.getLayerStatesArray=function(t){var e=void 0!==t?t:[],i=e.length;this.getLayers().forEach(function(c){c.getLayerStatesArray(e)});var o=this.getLayerState(),a=o.zIndex;!t&&void 0===o.zIndex&&(a=0);for(var s=i,u=e.length;s<u;s++){var l=e[s];l.opacity*=o.opacity,l.visible=l.visible&&o.visible,l.maxResolution=Math.min(l.maxResolution,o.maxResolution),l.minResolution=Math.max(l.minResolution,o.minResolution),l.minZoom=Math.max(l.minZoom,o.minZoom),l.maxZoom=Math.min(l.maxZoom,o.maxZoom),void 0!==o.extent&&(l.extent=void 0!==l.extent?re(l.extent,o.extent):o.extent),void 0===l.zIndex&&(l.zIndex=a)}return e},r.prototype.getSourceState=function(){return"ready"},r}(go);const tn=Du;var Nu=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),bu=function(n){function r(t,e,i){var o=n.call(this,t)||this;return o.map=e,o.frameState=void 0!==i?i:null,o}return Nu(r,n),r}(ne);const Ye=bu;var Gu=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Uu=function(n){function r(t,e,i,o,a,s){var u=n.call(this,t,e,a)||this;return u.originalEvent=i,u.pixel_=null,u.coordinate_=null,u.dragging=void 0!==o&&o,u.activePointers=s,u}return Gu(r,n),Object.defineProperty(r.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(t){this.pixel_=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(t){this.coordinate_=t},enumerable:!1,configurable:!0}),r.prototype.preventDefault=function(){n.prototype.preventDefault.call(this),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()},r.prototype.stopPropagation=function(){n.prototype.stopPropagation.call(this),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()},r}(Ye);const pe=Uu,nt={SINGLECLICK:"singleclick",CLICK:"click",DBLCLICK:"dblclick",POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var Xu=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Bu=function(n){function r(t,e){var i=n.call(this,t)||this;i.map_=t,i.emulateClicks_=!1,i.dragging_=!1,i.dragListenerKeys_=[],i.moveTolerance_=void 0===e?1:e,i.down_=null;var o=i.map_.getViewport();return i.activePointers_=[],i.trackedTouches_={},i.element_=o,i.pointerdownListenerKey_=j(o,"pointerdown",i.handlePointerDown_,i),i.relayedListenerKey_=j(o,"pointermove",i.relayMoveEvent_,i),i.boundHandleTouchMove_=i.handleTouchMove_.bind(i),i.element_.addEventListener("touchmove",i.boundHandleTouchMove_,!!Ct&&{passive:!1}),i}return Xu(r,n),r.prototype.emulateClick_=function(t){var e=new pe(nt.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new pe(nt.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var i=new pe(nt.SINGLECLICK,this.map_,t);this.dispatchEvent(i)}.bind(this),250)},r.prototype.updateActivePointers_=function(t){var e=t,i=e.pointerId;if(e.type==nt.POINTERUP||e.type==nt.POINTERCANCEL){for(var o in delete this.trackedTouches_[i],this.trackedTouches_)if(this.trackedTouches_[o].target!==e.target){delete this.trackedTouches_[o];break}}else(e.type==nt.POINTERDOWN||e.type==nt.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=ho(this.trackedTouches_)},r.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var e=new pe(nt.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(Q),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},r.prototype.isMouseActionButton_=function(t){return 0===t.button},r.prototype.handlePointerDown_=function(t){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(t);var e=new pe(nt.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);for(var i in this.dispatchEvent(e),this.down_={},t){var o=t[i];this.down_[i]="function"==typeof o?O:o}if(0===this.dragListenerKeys_.length){var a=this.map_.getOwnerDocument();this.dragListenerKeys_.push(j(a,nt.POINTERMOVE,this.handlePointerMove_,this),j(a,nt.POINTERUP,this.handlePointerUp_,this),j(this.element_,nt.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==a&&this.dragListenerKeys_.push(j(this.element_.getRootNode(),nt.POINTERUP,this.handlePointerUp_,this))}},r.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;var e=new pe(nt.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}},r.prototype.relayMoveEvent_=function(t){this.originalPointerMoveEvent_=t;var e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new pe(nt.POINTERMOVE,this.map_,t,e))},r.prototype.handleTouchMove_=function(t){var e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&("boolean"!=typeof t.cancelable||!0===t.cancelable)&&t.preventDefault()},r.prototype.isMoving_=function(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_},r.prototype.disposeInternal=function(){this.relayedListenerKey_&&(Q(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener("touchmove",this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Q(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Q),this.dragListenerKeys_.length=0,this.element_=null,n.prototype.disposeInternal.call(this)},r}(ze);const ju=Bu;var en=1/0,zu=function(){function n(r,t){this.priorityFunction_=r,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return n.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,je(this.queuedElements_)},n.prototype.dequeue=function(){var r=this.elements_,t=this.priorities_,e=r[0];1==r.length?(r.length=0,t.length=0):(r[0]=r.pop(),t[0]=t.pop(),this.siftUp_(0));var i=this.keyFunction_(e);return delete this.queuedElements_[i],e},n.prototype.enqueue=function(r){W(!(this.keyFunction_(r)in this.queuedElements_),31);var t=this.priorityFunction_(r);return t!=en&&(this.elements_.push(r),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(r)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},n.prototype.getCount=function(){return this.elements_.length},n.prototype.getLeftChildIndex_=function(r){return 2*r+1},n.prototype.getRightChildIndex_=function(r){return 2*r+2},n.prototype.getParentIndex_=function(r){return r-1>>1},n.prototype.heapify_=function(){var r;for(r=(this.elements_.length>>1)-1;r>=0;r--)this.siftUp_(r)},n.prototype.isEmpty=function(){return 0===this.elements_.length},n.prototype.isKeyQueued=function(r){return r in this.queuedElements_},n.prototype.isQueued=function(r){return this.isKeyQueued(this.keyFunction_(r))},n.prototype.siftUp_=function(r){for(var t=this.elements_,e=this.priorities_,i=t.length,o=t[r],a=e[r],s=r;r<i>>1;){var u=this.getLeftChildIndex_(r),l=this.getRightChildIndex_(r),c=l<i&&e[l]<e[u]?l:u;t[r]=t[c],e[r]=e[c],r=c}t[r]=o,e[r]=a,this.siftDown_(s,r)},n.prototype.siftDown_=function(r,t){for(var e=this.elements_,i=this.priorities_,o=e[t],a=i[t];t>r;){var s=this.getParentIndex_(t);if(!(i[s]>a))break;e[t]=e[s],i[t]=i[s],t=s}e[t]=o,i[t]=a},n.prototype.reprioritize=function(){var a,s,u,r=this.priorityFunction_,t=this.elements_,e=this.priorities_,i=0,o=t.length;for(s=0;s<o;++s)(u=r(a=t[s]))==en?delete this.queuedElements_[this.keyFunction_(a)]:(e[i]=u,t[i++]=a);t.length=i,e.length=i,this.heapify_()},n}();const Wu=zu;var Yu=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),ku=function(n){function r(t,e){var i=n.call(this,function(o){return t.apply(null,o)},function(o){return o[0].getKey()})||this;return i.boundHandleTileChange_=i.handleTileChange.bind(i),i.tileChangeCallback_=e,i.tilesLoading_=0,i.tilesLoadingKeys_={},i}return Yu(r,n),r.prototype.enqueue=function(t){var e=n.prototype.enqueue.call(this,t);return e&&t[0].addEventListener("change",this.boundHandleTileChange_),e},r.prototype.getTilesLoading=function(){return this.tilesLoading_},r.prototype.handleTileChange=function(t){var e=t.target,i=e.getState();if(2===i||3===i||4===i){e.removeEventListener("change",this.boundHandleTileChange_);var o=e.getKey();o in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[o],--this.tilesLoading_),this.tileChangeCallback_()}},r.prototype.loadMoreTiles=function(t,e){for(var a,s,i=0;this.tilesLoading_<t&&i<e&&this.getCount()>0;)s=(a=this.dequeue()[0]).getKey(),0===a.getState()&&!(s in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[s]=!0,++this.tilesLoading_,++i,a.load())},r}(Wu);const Vu=ku;var zt={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},Jt={};Jt[zt.RADIANS]=6370997/(2*Math.PI),Jt[zt.DEGREES]=2*Math.PI*6370997/360,Jt[zt.FEET]=.3048,Jt[zt.METERS]=1,Jt[zt.USFEET]=1200/3937;const _e=zt,Wt={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};var qu=function(){function n(r){this.code_=r.code,this.units_=r.units,this.extent_=void 0!==r.extent?r.extent:null,this.worldExtent_=void 0!==r.worldExtent?r.worldExtent:null,this.axisOrientation_=void 0!==r.axisOrientation?r.axisOrientation:"enu",this.global_=void 0!==r.global&&r.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=r.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=r.metersPerUnit}return n.prototype.canWrapX=function(){return this.canWrapX_},n.prototype.getCode=function(){return this.code_},n.prototype.getExtent=function(){return this.extent_},n.prototype.getUnits=function(){return this.units_},n.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||Jt[this.units_]},n.prototype.getWorldExtent=function(){return this.worldExtent_},n.prototype.getAxisOrientation=function(){return this.axisOrientation_},n.prototype.isGlobal=function(){return this.global_},n.prototype.setGlobal=function(r){this.global_=r,this.canWrapX_=!(!r||!this.extent_)},n.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},n.prototype.setDefaultTileGrid=function(r){this.defaultTileGrid_=r},n.prototype.setExtent=function(r){this.extent_=r,this.canWrapX_=!(!this.global_||!r)},n.prototype.setWorldExtent=function(r){this.worldExtent_=r},n.prototype.setGetPointResolution=function(r){this.getPointResolutionFunc_=r},n.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},n}();const Mo=qu;var Ju=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),fr=6378137,ke=Math.PI*fr,Qu=[-ke,-ke,ke,ke],$u=[-180,-85,180,85],rn=fr*Math.log(Math.tan(Math.PI/2)),Ve=function(n){function r(t){return n.call(this,{code:t,units:_e.METERS,extent:Qu,global:!0,worldExtent:$u,getPointResolution:function(e,i){return e/ks(i[1]/fr)}})||this}return Ju(r,n),r}(Mo),Fo=[new Ve("EPSG:3857"),new Ve("EPSG:102100"),new Ve("EPSG:102113"),new Ve("EPSG:900913"),new Ve("http://www.opengis.net/def/crs/EPSG/0/3857"),new Ve("http://www.opengis.net/gml/srs/epsg.xml#3857")];function tl(n,r,t){var e=n.length,i=t>1?t:2,o=r;void 0===o&&(o=i>2?n.slice():new Array(e));for(var a=0;a<e;a+=i){o[a]=ke*n[a]/180;var s=fr*Math.log(Math.tan(Math.PI*(+n[a+1]+90)/360));s>rn?s=rn:s<-rn&&(s=-rn),o[a+1]=s}return o}function el(n,r,t){var e=n.length,i=t>1?t:2,o=r;void 0===o&&(o=i>2?n.slice():new Array(e));for(var a=0;a<e;a+=i)o[a]=180*n[a]/ke,o[a+1]=360*Math.atan(Math.exp(n[a+1]/fr))/Math.PI-90;return o}var rl=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Do=[-180,-90,180,90],il=6378137*Math.PI/180,Pe=function(n){function r(t,e){return n.call(this,{code:t,units:_e.DEGREES,extent:Do,axisOrientation:e,global:!0,metersPerUnit:il,worldExtent:Do})||this}return rl(r,n),r}(Mo),No=[new Pe("CRS:84"),new Pe("EPSG:4326","neu"),new Pe("urn:ogc:def:crs:OGC:1.3:CRS84"),new Pe("urn:ogc:def:crs:OGC:2:84"),new Pe("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Pe("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Pe("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],nn={},Yt={};function on(n,r,t){var e=n.getCode(),i=r.getCode();e in Yt||(Yt[e]={}),Yt[e][i]=t}function qn(n,r,t){var e=t||6371008.8,i=Ur(n[1]),o=Ur(r[1]),a=(o-i)/2,s=Ur(r[0]-n[0])/2,u=Math.sin(a)*Math.sin(a)+Math.sin(s)*Math.sin(s)*Math.cos(i)*Math.cos(o);return 2*e*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))}var Qn=!0;function bo(n){Qn=!(void 0===n||n)}function $n(n,r,t){var e;if(void 0!==r){for(var i=0,o=n.length;i<o;++i)r[i]=n[i];e=r}else e=n.slice();return e}function Go(n,r,t){if(void 0!==r&&n!==r){for(var e=0,i=n.length;e<i;++e)r[e]=n[e];n=r}return n}function cl(n){(function al(n,r){nn[n]=r})(n.getCode(),n),on(n,n,$n)}function _t(n){return"string"==typeof n?function ol(n){return nn[n]||nn[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}(n):n||null}function Uo(n,r,t,e){var i,o=(n=_t(n)).getPointResolutionFunc();if(o)i=o(r,t),e&&e!==n.getUnits()&&(a=n.getMetersPerUnit())&&(i=i*a/Jt[e]);else{var s=n.getUnits();if(s==_e.DEGREES&&!e||e==_e.DEGREES)i=r;else{var a,u=dr(n,_t("EPSG:4326"));if(u===Go&&s!==_e.DEGREES)i=r*n.getMetersPerUnit();else{var l=[t[0]-r/2,t[1],t[0]+r/2,t[1],t[0],t[1]-r/2,t[0],t[1]+r/2];i=(qn((l=u(l,l,2)).slice(0,2),l.slice(2,4))+qn(l.slice(4,6),l.slice(6,8)))/2}void 0!==(a=e?Jt[e]:n.getMetersPerUnit())&&(i/=a)}}return i}function Xo(n){(function hl(n){n.forEach(cl)})(n),n.forEach(function(r){n.forEach(function(t){r!==t&&on(r,t,$n)})})}function ti(n,r){return n?"string"==typeof n?_t(n):n:_t(r)}function un(n,r){return bo(),vr(n,"EPSG:4326",void 0!==r?r:"EPSG:3857")}function Ke(n,r){if(n===r)return!0;var t=n.getUnits()===r.getUnits();return(n.getCode()===r.getCode()||dr(n,r)===$n)&&t}function dr(n,r){var i=function sl(n,r){var t;return n in Yt&&r in Yt[n]&&(t=Yt[n][r]),t}(n.getCode(),r.getCode());return i||(i=Go),i}function pr(n,r){return dr(_t(n),_t(r))}function vr(n,r,t){return pr(r,t)(n,void 0,n.length)}var gt=null;function zo(){return gt}function ei(n,r){return n}function oe(n,r){return Qn&&!Vr(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(Qn=!1,console.warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function ge(n,r){return n}function Wo(n,r,t){return function(e,i,o,a,s){if(e){if(!i&&!r)return e;var u=r?0:o[0]*i,l=r?0:o[1]*i,c=s?s[0]:0,h=s?s[1]:0,f=n[0]+u/2+c,d=n[2]-u/2+c,p=n[1]+l/2+h,v=n[3]-l/2+h;f>d&&(d=f=(d+f)/2),p>v&&(v=p=(v+p)/2);var y=ht(e[0],f,d),R=ht(e[1],p,v);if(a&&t&&i){var T=30*i;y+=-T*Math.log(1+Math.max(0,f-e[0])/T)+T*Math.log(1+Math.max(0,e[0]-d)/T),R+=-T*Math.log(1+Math.max(0,p-e[1])/T)+T*Math.log(1+Math.max(0,e[1]-v)/T)}return[y,R]}}}function _l(n){return n}function ri(n,r,t,e){var i=et(r)/t[0],o=Pt(r)/t[1];return e?Math.min(n,Math.max(i,o)):Math.min(n,Math.min(i,o))}function ni(n,r,t){var e=Math.min(n,r);return e*=Math.log(1+50*Math.max(0,n/r-1))/50+1,t&&(e=Math.max(e,t),e/=Math.log(1+50*Math.max(0,t/n-1))/50+1),ht(e,t/2,2*r)}function Yo(n,r,t,e,i){return function(o,a,s,u){if(void 0!==o){var l=e?ri(n,e,s,i):n;return(void 0===t||t)&&u?ni(o,l,r):ht(o,r,l)}}}function ii(n){if(void 0!==n)return 0}function ko(n){if(void 0!==n)return n}function Vo(n){return Math.pow(n,3)}function ye(n){return 1-Vo(1-n)}function oi(n){return 3*n*n-2*n*n*n}function Tl(n){return n}!function vl(){Xo(Fo),Xo(No),function fl(n,r,t,e){n.forEach(function(i){r.forEach(function(o){on(i,o,t),on(o,i,e)})})}(No,Fo,tl,el)}();function _r(n,r,t,e,i,o){for(var a=o||[],s=0,u=r;u<t;u+=e){var l=n[u],c=n[u+1];a[s++]=i[0]*l+i[2]*c+i[4],a[s++]=i[1]*l+i[3]*c+i[5]}return o&&a.length!=s&&(a.length=s),a}var wl=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Ko=[1,0,0,1,0,0],Al=function(n){function r(){var t=n.call(this)||this;return t.extent_=[1/0,1/0,-1/0,-1/0],t.extentRevision_=-1,t.simplifiedGeometryMaxMinSquaredTolerance=0,t.simplifiedGeometryRevision=0,t.simplifyTransformedInternal=function D(n){var t,e,i,r=!1;return function(){var o=Array.prototype.slice.call(arguments);return(!r||this!==i||!Dt(o,e))&&(r=!0,i=this,e=o,t=n.apply(this,arguments)),t}}(function(e,i,o){if(!o)return this.getSimplifiedGeometry(i);var a=this.clone();return a.applyTransform(o),a.getSimplifiedGeometry(i)}),t}return wl(r,n),r.prototype.simplifyTransformed=function(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)},r.prototype.clone=function(){return A()},r.prototype.closestPointXY=function(t,e,i,o){return A()},r.prototype.containsXY=function(t,e){var i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e},r.prototype.getClosestPoint=function(t,e){var i=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],i,1/0),i},r.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},r.prototype.computeExtent=function(t){return A()},r.prototype.getExtent=function(t){if(this.extentRevision_!=this.getRevision()){var e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Ne(e),this.extentRevision_=this.getRevision()}return function Bs(n,r){return r?(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r):n}(this.extent_,t)},r.prototype.rotate=function(t,e){A()},r.prototype.scale=function(t,e,i){A()},r.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},r.prototype.getSimplifiedGeometry=function(t){return A()},r.prototype.getType=function(){return A()},r.prototype.applyTransform=function(t){A()},r.prototype.intersectsExtent=function(t){return A()},r.prototype.translate=function(t,e){A()},r.prototype.transform=function(t,e){var i=_t(t),o=i.getUnits()==_e.TILE_PIXELS?function(a,s,u){var l=i.getExtent(),c=i.getWorldExtent(),h=Pt(c)/Pt(l);return Zt(Ko,c[0],c[3],h,-h,0,0,0),_r(a,0,a.length,u,Ko,s),pr(i,e)(a,s,u)}:pr(i,e);return this.applyTransform(o),this},r}(qt);const Sl=Al;var Ol=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Pl=function(n){function r(){var t=n.call(this)||this;return t.layout="XY",t.stride=2,t.flatCoordinates=null,t}return Ol(r,n),r.prototype.computeExtent=function(t){return function Ns(n,r,t,e,i){return to(Ne(i),n,r,t,e)}(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},r.prototype.getCoordinates=function(){return A()},r.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},r.prototype.getFlatCoordinates=function(){return this.flatCoordinates},r.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},r.prototype.getLayout=function(){return this.layout},r.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},r.prototype.getSimplifiedGeometryInternal=function(t){return this},r.prototype.getStride=function(){return this.stride},r.prototype.setFlatCoordinates=function(t,e){this.stride=Zo(t),this.layout=t,this.flatCoordinates=e},r.prototype.setCoordinates=function(t,e){A()},r.prototype.setLayout=function(t,e,i){var o;if(t)o=Zo(t);else{for(var a=0;a<i;++a){if(0===e.length)return this.layout="XY",void(this.stride=2);e=e[0]}t=function Ll(n){var r;return 2==n?r="XY":3==n?r="XYZ":4==n&&(r="XYZM"),r}(o=e.length)}this.layout=t,this.stride=o},r.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},r.prototype.rotate=function(t,e){var i=this.getFlatCoordinates();if(i){var o=this.getStride();(function Rl(n,r,t,e,i,o,a){for(var s=a||[],u=Math.cos(i),l=Math.sin(i),c=o[0],h=o[1],f=0,d=r;d<t;d+=e){var p=n[d]-c,v=n[d+1]-h;s[f++]=c+p*u-v*l,s[f++]=h+p*l+v*u;for(var y=d+2;y<d+e;++y)s[f++]=n[y]}a&&s.length!=f&&(s.length=f)})(i,0,i.length,o,t,e,i),this.changed()}},r.prototype.scale=function(t,e,i){var o=e;void 0===o&&(o=t);var a=i;a||(a=Ge(this.getExtent()));var s=this.getFlatCoordinates();if(s){var u=this.getStride();(function xl(n,r,t,e,i,o,a,s){for(var u=s||[],l=a[0],c=a[1],h=0,f=r;f<t;f+=e){var p=n[f+1]-c;u[h++]=l+i*(n[f]-l),u[h++]=c+o*p;for(var v=f+2;v<f+e;++v)u[h++]=n[v]}s&&u.length!=h&&(u.length=h)})(s,0,s.length,u,t,o,a,s),this.changed()}},r.prototype.translate=function(t,e){var i=this.getFlatCoordinates();if(i){var o=this.getStride();(function Cl(n,r,t,e,i,o,a){for(var s=a||[],u=0,l=r;l<t;l+=e){s[u++]=n[l]+i,s[u++]=n[l+1]+o;for(var c=l+2;c<l+e;++c)s[u++]=n[c]}a&&s.length!=u&&(s.length=u)})(i,0,i.length,o,t,e,i),this.changed()}},r}(Sl);function Zo(n){var r;return"XY"==n?r=2:"XYZ"==n||"XYM"==n?r=3:"XYZM"==n&&(r=4),r}const ai=Pl;function Ho(n,r,t,e,i,o,a){var h,s=n[r],u=n[r+1],l=n[t]-s,c=n[t+1]-u;if(0===l&&0===c)h=r;else{var f=((i-s)*l+(o-u)*c)/(l*l+c*c);if(f>1)h=t;else{if(f>0){for(var d=0;d<e;++d)a[d]=Zs(n[r+d],n[t+d],f);return void(a.length=e)}h=r}}for(d=0;d<e;++d)a[d]=n[h+d];a.length=e}function qo(n,r,t,e,i){var o=n[r],a=n[r+1];for(r+=e;r<t;r+=e){var s=n[r],u=n[r+1],l=Ue(o,a,s,u);l>i&&(i=l),o=s,a=u}return i}function Qo(n,r,t,e,i,o,a,s,u,l,c){if(r==t)return l;var h,f;if(0===i){if((f=Ue(a,s,n[r],n[r+1]))<l){for(h=0;h<e;++h)u[h]=n[r+h];return u.length=e,f}return l}for(var d=c||[NaN,NaN],p=r+e;p<t;)if(Ho(n,p-e,p,e,a,s,d),(f=Ue(a,s,d[0],d[1]))<l){for(l=f,h=0;h<e;++h)u[h]=d[h];u.length=e,p+=e}else p+=e*Math.max((Math.sqrt(f)-Math.sqrt(l))/i|0,1);if(o&&(Ho(n,t-e,r,e,a,s,d),(f=Ue(a,s,d[0],d[1]))<l)){for(l=f,h=0;h<e;++h)u[h]=d[h];u.length=e}return l}function ta(n,r,t,e){for(var i=0,o=t.length;i<o;++i)for(var a=t[i],s=0;s<e;++s)n[r++]=a[s];return r}function Ze(n,r){return r*Math.round(n/r)}function Nl(n,r,t,e,i,o,a){if(r==t)return a;var l,c,s=Ze(n[r],i),u=Ze(n[r+1],i);r+=e,o[a++]=s,o[a++]=u;do{if(l=Ze(n[r],i),c=Ze(n[r+1],i),(r+=e)==t)return o[a++]=l,o[a++]=c,a}while(l==s&&c==u);for(;r<t;){var h=Ze(n[r],i),f=Ze(n[r+1],i);if(r+=e,h!=l||f!=c){var d=l-s,p=c-u,v=h-s,y=f-u;if(d*y==p*v&&(d<0&&v<d||d==v||d>0&&v>d)&&(p<0&&y<p||p==y||p>0&&y>p)){l=h,c=f;continue}o[a++]=l,o[a++]=c,s=l,u=c,l=h,c=f}}return o[a++]=l,o[a++]=c,a}function na(n,r,t,e,i){for(var o=void 0!==i?i:[],a=0,s=r;s<t;s+=e)o[a++]=n.slice(s,s+e);return o.length=a,o}function oa(n,r,t,e){for(var i=0,o=n[t-e],a=n[t-e+1];r<t;r+=e){var s=n[r],u=n[r+1];i+=a*s-o*u,o=s,a=u}return i/2}var bl=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Gl=function(n){function r(t,e){var i=n.call(this)||this;return i.maxDelta_=-1,i.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?i.setCoordinates(t,e):i.setFlatCoordinates(e,t),i}return bl(r,n),r.prototype.clone=function(){return new r(this.flatCoordinates.slice(),this.layout)},r.prototype.closestPointXY=function(t,e,i,o){return o<qi(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(qo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Qo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,o))},r.prototype.getArea=function(){return oa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},r.prototype.getCoordinates=function(){return na(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},r.prototype.getSimplifiedGeometryInternal=function(t){var e=[];return e.length=function si(n,r,t,e,i,o,a){var s=(t-r)/e;if(s<3){for(;r<t;r+=e)o[a++]=n[r],o[a++]=n[r+1];return a}var u=new Array(s);u[0]=1,u[s-1]=1;for(var l=[r,t-e],c=0;l.length>0;){for(var h=l.pop(),f=l.pop(),d=0,p=n[f],v=n[f+1],y=n[h],R=n[h+1],T=f+e;T<h;T+=e){var w=Vs(n[T],n[T+1],p,v,y,R);w>d&&(c=T,d=w)}d>i&&(u[(c-r)/e]=1,f+e<c&&l.push(f,c),c+e<h&&l.push(c,h))}for(T=0;T<s;++T)u[T]&&(o[a++]=n[r+T*e],o[a++]=n[r+T*e+1]);return a}(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new r(e,"XY")},r.prototype.getType=function(){return"LinearRing"},r.prototype.intersectsExtent=function(t){return!1},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ta(this.flatCoordinates,0,t,this.stride),this.changed()},r}(ai);const sa=Gl;var Ul=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Xl=function(n){function r(t,e){var i=n.call(this)||this;return i.setCoordinates(t,e),i}return Ul(r,n),r.prototype.clone=function(){var t=new r(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},r.prototype.closestPointXY=function(t,e,i,o){var a=this.flatCoordinates,s=Ue(t,e,a[0],a[1]);if(s<o){for(var u=this.stride,l=0;l<u;++l)i[l]=a[l];return i.length=u,s}return o},r.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},r.prototype.computeExtent=function(t){return function Ds(n,r){var t=n[0],e=n[1];return fe(t,e,t,e,r)}(this.flatCoordinates,t)},r.prototype.getType=function(){return"Point"},r.prototype.intersectsExtent=function(t){return Ji(t,this.flatCoordinates[0],this.flatCoordinates[1])},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function Ml(n,r,t,e){for(var i=0,o=t.length;i<o;++i)n[r++]=t[i];return r}(this.flatCoordinates,0,t),this.changed()},r}(ai);const ui=Xl;function Bl(n,r,t,e,i){return!eo(i,function(a){return!Le(n,r,t,e,a[0],a[1])})}function Le(n,r,t,e,i,o){for(var a=0,s=n[t-e],u=n[t-e+1];r<t;r+=e){var l=n[r],c=n[r+1];u<=o?c>o&&(l-s)*(o-u)-(i-s)*(c-u)>0&&a++:c<=o&&(l-s)*(o-u)-(i-s)*(c-u)<0&&a--,s=l,u=c}return 0!==a}function li(n,r,t,e,i,o){if(0===t.length||!Le(n,r,t[0],e,i,o))return!1;for(var a=1,s=t.length;a<s;++a)if(Le(n,t[a-1],t[a],e,i,o))return!1;return!0}function ci(n,r,t,e,i){var o=to([1/0,1/0,-1/0,-1/0],n,r,t,e);return!!Ht(i,o)&&(!!(bn(i,o)||o[0]>=i[0]&&o[2]<=i[2]||o[1]>=i[1]&&o[3]<=i[3])||function jl(n,r,t,e,i){var o;for(r+=e;r<t;r+=e)if(o=i(n.slice(r-e,r),n.slice(r,r+e)))return o;return!1}(n,r,t,e,function(a,s){return function js(n,r,t){var e=!1,i=Qi(n,r),o=Qi(n,t);if(1===i||1===o)e=!0;else{var a=n[0],s=n[1],u=n[2],l=n[3],f=t[0],d=t[1],p=(d-r[1])/(f-r[0]),v=void 0,y=void 0;!!(2&o)&&!(2&i)&&(e=(v=f-(d-l)/p)>=a&&v<=u),e||!(4&o)||4&i||(e=(y=d-(f-u)*p)>=s&&y<=l),e||!(8&o)||8&i||(e=(v=f-(d-s)/p)>=a&&v<=u),!e&&16&o&&!(16&i)&&(e=(y=d-(f-a)*p)>=s&&y<=l)}return e}(i,a,s)}))}function la(n,r,t,e,i){return!!(ci(n,r,t,e,i)||Le(n,r,t,e,i[0],i[1])||Le(n,r,t,e,i[0],i[3])||Le(n,r,t,e,i[2],i[1])||Le(n,r,t,e,i[2],i[3]))}function zl(n,r,t,e){for(;r<t-e;){for(var i=0;i<e;++i){var o=n[r+i];n[r+i]=n[t-e+i],n[t-e+i]=o}r+=e,t-=e}}function hi(n,r,t,e){for(var i=0,o=n[t-e],a=n[t-e+1];r<t;r+=e){var s=n[r],u=n[r+1];i+=(s-o)*(u+a),o=s,a=u}return 0===i?void 0:i>0}function fi(n,r,t,e,i){for(var o=void 0!==i&&i,a=0,s=t.length;a<s;++a){var u=t[a],l=hi(n,r,u,e);(0===a?o&&l||!o&&!l:o&&!l||!o&&l)&&zl(n,r,u,e),r=u}return r}var Wl=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),ln=function(n){function r(t,e,i){var o=n.call(this)||this;return o.ends_=[],o.flatInteriorPointRevision_=-1,o.flatInteriorPoint_=null,o.maxDelta_=-1,o.maxDeltaRevision_=-1,o.orientedRevision_=-1,o.orientedFlatCoordinates_=null,void 0!==e&&i?(o.setFlatCoordinates(e,t),o.ends_=i):o.setCoordinates(t,e),o}return Wl(r,n),r.prototype.appendLinearRing=function(t){this.flatCoordinates?xe(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},r.prototype.clone=function(){var t=new r(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},r.prototype.closestPointXY=function(t,e,i,o){return o<qi(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function Jo(n,r,t,e,i){for(var o=0,a=t.length;o<a;++o){var s=t[o];i=qo(n,r,s,e,i),r=s}return i}(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function $o(n,r,t,e,i,o,a,s,u,l,c){for(var h=c||[NaN,NaN],f=0,d=t.length;f<d;++f){var p=t[f];l=Qo(n,r,p,e,i,o,a,s,u,l,h),r=p}return l}(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,o))},r.prototype.containsXY=function(t,e){return li(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},r.prototype.getArea=function(){return function aa(n,r,t,e){for(var i=0,o=0,a=t.length;o<a;++o){var s=t[o];i+=oa(n,r,s,e),r=s}return i}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},r.prototype.getCoordinates=function(t){var e;return void 0!==t?fi(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates,function ia(n,r,t,e,i){for(var o=void 0!==i?i:[],a=0,s=0,u=t.length;s<u;++s){var l=t[s];o[a++]=na(n,r,l,e,o[a]),r=l}return o.length=a,o}(e,0,this.ends_,this.stride)},r.prototype.getEnds=function(){return this.ends_},r.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=Ge(this.getExtent());this.flatInteriorPoint_=function ua(n,r,t,e,i,o,a){for(var s,u,l,c,h,f,d,p=i[o+1],v=[],y=0,R=t.length;y<R;++y){var T=t[y];for(c=n[T-e],f=n[T-e+1],s=r;s<T;s+=e)h=n[s],d=n[s+1],(p<=f&&d<=p||f<=p&&p<=d)&&v.push(l=(p-f)/(d-f)*(h-c)+c),c=h,f=d}var m=NaN,E=-1/0;for(v.sort(jt),c=v[0],s=1,u=v.length;s<u;++s){h=v[s];var w=Math.abs(h-c);w>E&&li(n,r,t,e,l=(c+h)/2,p)&&(m=l,E=w),c=h}return isNaN(m)&&(m=i[o]),a?(a.push(m,p,E),a):[m,p,E]}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},r.prototype.getInteriorPoint=function(){return new ui(this.getFlatInteriorPoint(),"XYM")},r.prototype.getLinearRingCount=function(){return this.ends_.length},r.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new sa(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},r.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.ends_,o=[],a=0,s=0,u=i.length;s<u;++s){var l=i[s],c=new sa(e.slice(a,l),t);o.push(c),a=l}return o},r.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;!function ha(n,r,t,e,i){for(var o=void 0!==i&&i,a=0,s=t.length;a<s;++a){var u=t[a],l=hi(n,r,u,e);if(0===a){if(o&&l||!o&&!l)return!1}else if(o&&!l||!o&&l)return!1;r=u}return!0}(t,0,this.ends_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=fi(this.orientedFlatCoordinates_,0,this.ends_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},r.prototype.getSimplifiedGeometryInternal=function(t){var e=[],i=[];return e.length=function ra(n,r,t,e,i,o,a,s){for(var u=0,l=t.length;u<l;++u){var c=t[u];a=Nl(n,r,c,e,i,o,a),s.push(a),r=c}return a}(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new r(e,"XY",i)},r.prototype.getType=function(){return"Polygon"},r.prototype.intersectsExtent=function(t){return function ca(n,r,t,e,i){if(!la(n,r,t[0],e,i))return!1;if(1===t.length)return!0;for(var o=1,a=t.length;o<a;++o)if(Bl(n,t[o-1],t[o],e,i)&&!ci(n,t[o-1],t[o],e,i))return!1;return!0}(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=function ea(n,r,t,e,i){for(var o=i||[],a=0,s=0,u=t.length;s<u;++s){var l=ta(n,r,t[s],e);o[a++]=l,r=l}return o.length=a,o}(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()},r}(ai);const Yl=ln;function fa(n){var r=n[0],t=n[1],e=n[2],i=n[3],o=[r,t,r,i,e,i,e,t,r,t];return new ln(o,"XY",[o.length])}var Vl=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Kl=function(n){function r(t){var e=n.call(this)||this,i=ot({},t);return e.hints_=[0,0],e.animations_=[],e.projection_=ti(i.projection,"EPSG:3857"),e.viewportSize_=[100,100],e.targetCenter_=null,e.nextCenter_=null,e.cancelAnchor_=void 0,i.projection&&bo(),i.center&&(i.center=oe(i.center)),i.extent&&(i.extent=ge(i.extent)),e.applyOptions_(i),e}return Vl(r,n),r.prototype.applyOptions_=function(t){var e=ot({},t);for(var i in Wt)delete e[i];this.setProperties(e,!0);var o=function Hl(n){var r,t,e,a=void 0!==n.minZoom?n.minZoom:0,s=void 0!==n.maxZoom?n.maxZoom:28,u=void 0!==n.zoomFactor?n.zoomFactor:2,l=void 0!==n.multiWorld&&n.multiWorld,c=void 0===n.smoothResolutionConstraint||n.smoothResolutionConstraint,h=void 0!==n.showFullExtent&&n.showFullExtent,f=ti(n.projection,"EPSG:3857"),d=f.getExtent(),p=n.constrainOnlyCenter,v=n.extent;if(!l&&!v&&f.isGlobal()&&(p=!1,v=d),void 0!==n.resolutions){var y=n.resolutions;t=y[a],e=void 0!==y[s]?y[s]:y[y.length-1],r=n.constrainResolution?function gl(n,r,t,e){return function(i,o,a,s){if(void 0!==i){var u=n[0],l=n[n.length-1],c=t?ri(u,t,a,e):u;if(s)return void 0===r||r?ni(i,c,l):ht(i,l,c);var f=Math.min(c,i),d=Math.floor(or(n,f,o));return n[d]>c&&d<n.length-1?n[d+1]:n[d]}}}(y,c,!p&&v,h):Yo(t,e,c,!p&&v,h)}else{var T=(d?Math.max(et(d),Pt(d)):360*Jt[_e.DEGREES]/f.getMetersPerUnit())/256/Math.pow(2,0),m=T/Math.pow(2,28);void 0!==(t=n.maxResolution)?a=0:t=T/Math.pow(u,a),void 0===(e=n.minResolution)&&(e=void 0!==n.maxZoom?void 0!==n.maxResolution?t/Math.pow(u,s):T/Math.pow(u,s):m),s=a+Math.floor(Math.log(t/e)/Math.log(u)),e=t/Math.pow(u,s-a),r=n.constrainResolution?function yl(n,r,t,e,i,o){return function(a,s,u,l){if(void 0!==a){var c=i?ri(r,i,u,o):r,h=void 0!==t?t:0;if(l)return void 0===e||e?ni(a,c,h):ht(a,h,c);var p=Math.ceil(Math.log(r/c)/Math.log(n)-1e-9),v=-s*(.5-1e-9)+.5,y=Math.min(c,a),R=Math.floor(Math.log(r/y)/Math.log(n)+v),T=Math.max(p,R);return ht(r/Math.pow(n,T),h,c)}}}(u,t,e,c,!p&&v,h):Yo(t,e,c,!p&&v,h)}return{constraint:r,maxResolution:t,minResolution:e,minZoom:a,zoomFactor:u}}(t);this.maxResolution_=o.maxResolution,this.minResolution_=o.minResolution,this.zoomFactor_=o.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=o.minZoom;var a=function Zl(n){if(void 0!==n.extent)return Wo(n.extent,n.constrainOnlyCenter,void 0===n.smoothExtentConstraint||n.smoothExtentConstraint);var t=ti(n.projection,"EPSG:3857");if(!0!==n.multiWorld&&t.isGlobal()){var e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Wo(e,!1,!1)}return _l}(t),s=o.constraint,u=function ql(n){if(void 0===n.enableRotation||n.enableRotation){var t=n.constrainRotation;return void 0===t||!0===t?function El(n){var r=n||Ur(5);return function(t,e){return e?t:void 0!==t?Math.abs(t)<=r?0:t:void 0}}():!1===t?ko:"number"==typeof t?function ml(n){var r=2*Math.PI/n;return function(t,e){return e?t:void 0!==t?t=Math.floor(t/r+.5)*r:void 0}}(t):ko}return ii}(t);this.constraints_={center:a,resolution:s,rotation:u},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)},Object.defineProperty(r.prototype,"padding",{get:function(){return this.padding_},set:function(t){var e=this.padding_;this.padding_=t;var i=this.getCenter();if(i){var o=t||[0,0,0,0];e=e||[0,0,0,0];var a=this.getResolution();this.setCenterInternal([i[0]+a/2*(o[3]-e[3]+e[1]-o[1]),i[1]-a/2*(o[0]-e[0]+e[2]-o[2])])}},enumerable:!1,configurable:!0}),r.prototype.getUpdatedOptions_=function(t){var e=this.getProperties();return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),ot({},e,t)},r.prototype.animate=function(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var e=new Array(arguments.length),i=0;i<e.length;++i){var o=arguments[i];o.center&&((o=ot({},o)).center=oe(o.center,this.getProjection())),o.anchor&&((o=ot({},o)).anchor=oe(o.anchor,this.getProjection())),e[i]=o}this.animateInternal.apply(this,e)},r.prototype.animateInternal=function(t){var i,e=arguments.length;e>1&&"function"==typeof arguments[e-1]&&(i=arguments[e-1],--e);for(var o=0;o<e&&!this.isDef();++o){var a=arguments[o];a.center&&this.setCenterInternal(a.center),void 0!==a.zoom?this.setZoom(a.zoom):a.resolution&&this.setResolution(a.resolution),void 0!==a.rotation&&this.setRotation(a.rotation)}if(o!==e){for(var s=Date.now(),u=this.targetCenter_.slice(),l=this.targetResolution_,c=this.targetRotation_,h=[];o<e;++o){var f=arguments[o],d={start:s,complete:!1,anchor:f.anchor,duration:void 0!==f.duration?f.duration:1e3,easing:f.easing||oi,callback:i};if(f.center&&(d.sourceCenter=u,d.targetCenter=f.center.slice(),u=d.targetCenter),void 0!==f.zoom?(d.sourceResolution=l,d.targetResolution=this.getResolutionForZoom(f.zoom),l=d.targetResolution):f.resolution&&(d.sourceResolution=l,d.targetResolution=f.resolution,l=d.targetResolution),void 0!==f.rotation){d.sourceRotation=c;var p=Xe(f.rotation-c+Math.PI,2*Math.PI)-Math.PI;d.targetRotation=c+p,c=d.targetRotation}Jl(d)?d.complete=!0:s+=d.duration,h.push(d)}this.animations_.push(h),this.setHint(0,1),this.updateAnimations_()}else i&&cn(i,!0)},r.prototype.getAnimating=function(){return this.hints_[0]>0},r.prototype.getInteracting=function(){return this.hints_[1]>0},r.prototype.cancelAnimations=function(){this.setHint(0,-this.hints_[0]);for(var t,e=0,i=this.animations_.length;e<i;++e){var o=this.animations_[e];if(o[0].callback&&cn(o[0].callback,!1),!t)for(var a=0,s=o.length;a<s;++a){var u=o[a];if(!u.complete){t=u.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN},r.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var t=Date.now(),e=!1,i=this.animations_.length-1;i>=0;--i){for(var o=this.animations_[i],a=!0,s=0,u=o.length;s<u;++s){var l=o[s];if(!l.complete){var h=l.duration>0?(t-l.start)/l.duration:1;h>=1?(l.complete=!0,h=1):a=!1;var f=l.easing(h);if(l.sourceCenter){var d=l.sourceCenter[0],p=l.sourceCenter[1],v=l.targetCenter[0],y=l.targetCenter[1];this.nextCenter_=l.targetCenter,this.targetCenter_=[d+f*(v-d),p+f*(y-p)]}if(l.sourceResolution&&l.targetResolution){var m=1===f?l.targetResolution:l.sourceResolution+f*(l.targetResolution-l.sourceResolution);if(l.anchor){var E=this.getViewportSize_(this.getRotation()),w=this.constraints_.resolution(m,0,E,!0);this.targetCenter_=this.calculateCenterZoom(w,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=m,this.applyTargetState_(!0)}if(void 0!==l.sourceRotation&&void 0!==l.targetRotation){var I=1===f?Xe(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+f*(l.targetRotation-l.sourceRotation);if(l.anchor){var C=this.constraints_.rotation(I,!0);this.targetCenter_=this.calculateCenterRotate(C,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=I}if(this.applyTargetState_(!0),e=!0,!l.complete)break}}if(a){this.animations_[i]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;var N=o[0].callback;N&&cn(N,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},r.prototype.calculateCenterRotate=function(t,e){var i,o=this.getCenterInternal();return void 0!==o&&(Bn(i=[o[0]-e[0],o[1]-e[1]],t-this.getRotation()),function uu(n,r){n[0]+=+r[0],n[1]+=+r[1]}(i,e)),i},r.prototype.calculateCenterZoom=function(t,e){var i,o=this.getCenterInternal(),a=this.getResolution();return void 0!==o&&void 0!==a&&(i=[e[0]-t*(e[0]-o[0])/a,e[1]-t*(e[1]-o[1])/a]),i},r.prototype.getViewportSize_=function(t){var e=this.viewportSize_;if(t){var i=e[0],o=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(o*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(o*Math.cos(t))]}return e},r.prototype.setViewportSize=function(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)},r.prototype.getCenter=function(){var t=this.getCenterInternal();return t&&ei(t,this.getProjection())},r.prototype.getCenterInternal=function(){return this.get(Wt.CENTER)},r.prototype.getConstraints=function(){return this.constraints_},r.prototype.getConstrainResolution=function(){return this.get("constrainResolution")},r.prototype.getHints=function(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()},r.prototype.calculateExtent=function(t){return function pl(n,r){return n}(this.calculateExtentInternal(t),this.getProjection())},r.prototype.calculateExtentInternal=function(t){var e=t||this.getViewportSizeMinusPadding_(),i=this.getCenterInternal();W(i,1);var o=this.getResolution();W(void 0!==o,2);var a=this.getRotation();return W(void 0!==a,3),Gn(i,o,a,e)},r.prototype.getMaxResolution=function(){return this.maxResolution_},r.prototype.getMinResolution=function(){return this.minResolution_},r.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},r.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))},r.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},r.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))},r.prototype.setConstrainResolution=function(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))},r.prototype.getProjection=function(){return this.projection_},r.prototype.getResolution=function(){return this.get(Wt.RESOLUTION)},r.prototype.getResolutions=function(){return this.resolutions_},r.prototype.getResolutionForExtent=function(t,e){return this.getResolutionForExtentInternal(ge(t,this.getProjection()),e)},r.prototype.getResolutionForExtentInternal=function(t,e){var i=e||this.getViewportSizeMinusPadding_(),o=et(t)/i[0],a=Pt(t)/i[1];return Math.max(o,a)},r.prototype.getResolutionForValueFunction=function(t){var e=t||2,i=this.getConstrainedResolution(this.maxResolution_),a=Math.log(i/this.minResolution_)/Math.log(e);return function(s){return i/Math.pow(e,s*a)}},r.prototype.getRotation=function(){return this.get(Wt.ROTATION)},r.prototype.getValueForResolutionFunction=function(t){var e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),a=Math.log(i/this.minResolution_)/e;return function(s){return Math.log(i/s)/e/a}},r.prototype.getViewportSizeMinusPadding_=function(t){var e=this.getViewportSize_(t),i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e},r.prototype.getState=function(){var t=this.getProjection(),e=this.getResolution(),i=this.getRotation(),o=this.getCenterInternal(),a=this.padding_;if(a){var s=this.getViewportSizeMinusPadding_();o=pi(o,this.getViewportSize_(),[s[0]/2+a[3],s[1]/2+a[0]],e,i)}return{center:o.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}},r.prototype.getZoom=function(){var t,e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t},r.prototype.getZoomForResolution=function(t){var i,o,e=this.minZoom_||0;if(this.resolutions_){var a=or(this.resolutions_,t,1);e=a,i=this.resolutions_[a],o=a==this.resolutions_.length-1?2:i/this.resolutions_[a+1]}else i=this.maxResolution_,o=this.zoomFactor_;return e+Math.log(i/t)/Math.log(o)},r.prototype.getResolutionForZoom=function(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var e=ht(Math.floor(t),0,this.resolutions_.length-2);return this.resolutions_[e]/Math.pow(this.resolutions_[e]/this.resolutions_[e+1],ht(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)},r.prototype.fit=function(t,e){var i;if(W(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t))W(!Gr(t),25),i=fa(o=ge(t,this.getProjection()));else if("Circle"===t.getType()){var o;(i=fa(o=ge(t.getExtent(),this.getProjection()))).rotate(this.getRotation(),Ge(o))}else{var a=zo();i=a?t.clone().transform(a,this.getProjection()):t}this.fitInternal(i,e)},r.prototype.rotatedExtentForGeometry=function(t){for(var e=this.getRotation(),i=Math.cos(e),o=Math.sin(-e),a=t.getFlatCoordinates(),s=t.getStride(),u=1/0,l=1/0,c=-1/0,h=-1/0,f=0,d=a.length;f<d;f+=s){var p=a[f]*i-a[f+1]*o,v=a[f]*o+a[f+1]*i;u=Math.min(u,p),l=Math.min(l,v),c=Math.max(c,p),h=Math.max(h,v)}return[u,l,c,h]},r.prototype.fitInternal=function(t,e){var i=e||{},o=i.size;o||(o=this.getViewportSizeMinusPadding_());var u,a=void 0!==i.padding?i.padding:[0,0,0,0],s=void 0!==i.nearest&&i.nearest;u=void 0!==i.minResolution?i.minResolution:void 0!==i.maxZoom?this.getResolutionForZoom(i.maxZoom):0;var l=this.rotatedExtentForGeometry(t),c=this.getResolutionForExtentInternal(l,[o[0]-a[1]-a[3],o[1]-a[0]-a[2]]);c=isNaN(c)?u:Math.max(c,u),c=this.getConstrainedResolution(c,s?0:1);var h=this.getRotation(),f=Math.sin(h),d=Math.cos(h),p=Ge(l);p[0]+=(a[1]-a[3])/2*c,p[1]+=(a[0]-a[2])/2*c;var R=this.getConstrainedCenter([p[0]*d-p[1]*f,p[1]*d+p[0]*f],c),T=i.callback?i.callback:O;void 0!==i.duration?this.animateInternal({resolution:c,center:R,duration:i.duration,easing:i.easing},T):(this.targetResolution_=c,this.targetCenter_=R,this.applyTargetState_(!1,!0),cn(T,!0))},r.prototype.centerOn=function(t,e,i){this.centerOnInternal(oe(t,this.getProjection()),e,i)},r.prototype.centerOnInternal=function(t,e,i){this.setCenterInternal(pi(t,e,i,this.getResolution(),this.getRotation()))},r.prototype.calculateCenterShift=function(t,e,i,o){var a,s=this.padding_;if(s&&t){var u=this.getViewportSizeMinusPadding_(-i),l=pi(t,o,[u[0]/2+s[3],u[1]/2+s[0]],e,i);a=[t[0]-l[0],t[1]-l[1]]}return a},r.prototype.isDef=function(){return!!this.getCenterInternal()&&void 0!==this.getResolution()},r.prototype.adjustCenter=function(t){var e=ei(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])},r.prototype.adjustCenterInternal=function(t){var e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])},r.prototype.adjustResolution=function(t,e){var i=e&&oe(e,this.getProjection());this.adjustResolutionInternal(t,i)},r.prototype.adjustResolutionInternal=function(t,e){var i=this.getAnimating()||this.getInteracting(),o=this.getViewportSize_(this.getRotation()),a=this.constraints_.resolution(this.targetResolution_*t,0,o,i);e&&(this.targetCenter_=this.calculateCenterZoom(a,e)),this.targetResolution_*=t,this.applyTargetState_()},r.prototype.adjustZoom=function(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)},r.prototype.adjustRotation=function(t,e){e&&(e=oe(e,this.getProjection())),this.adjustRotationInternal(t,e)},r.prototype.adjustRotationInternal=function(t,e){var i=this.getAnimating()||this.getInteracting(),o=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(o,e)),this.targetRotation_+=t,this.applyTargetState_()},r.prototype.setCenter=function(t){this.setCenterInternal(t&&oe(t,this.getProjection()))},r.prototype.setCenterInternal=function(t){this.targetCenter_=t,this.applyTargetState_()},r.prototype.setHint=function(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]},r.prototype.setResolution=function(t){this.targetResolution_=t,this.applyTargetState_()},r.prototype.setRotation=function(t){this.targetRotation_=t,this.applyTargetState_()},r.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))},r.prototype.applyTargetState_=function(t,e){var i=this.getAnimating()||this.getInteracting()||e,o=this.constraints_.rotation(this.targetRotation_,i),a=this.getViewportSize_(o),s=this.constraints_.resolution(this.targetResolution_,0,a,i),u=this.constraints_.center(this.targetCenter_,s,a,i,this.calculateCenterShift(this.targetCenter_,s,o,a));this.get(Wt.ROTATION)!==o&&this.set(Wt.ROTATION,o),this.get(Wt.RESOLUTION)!==s&&(this.set(Wt.RESOLUTION,s),this.set("zoom",this.getZoom(),!0)),(!u||!this.get(Wt.CENTER)||!Vr(this.get(Wt.CENTER),u))&&this.set(Wt.CENTER,u),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0},r.prototype.resolveConstraints=function(t,e,i){var o=void 0!==t?t:200,a=e||0,s=this.constraints_.rotation(this.targetRotation_),u=this.getViewportSize_(s),l=this.constraints_.resolution(this.targetResolution_,a,u),c=this.constraints_.center(this.targetCenter_,l,u,!1,this.calculateCenterShift(this.targetCenter_,l,s,u));if(0===o&&!this.cancelAnchor_)return this.targetResolution_=l,this.targetRotation_=s,this.targetCenter_=c,void this.applyTargetState_();var h=i||(0===o?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,(this.getResolution()!==l||this.getRotation()!==s||!this.getCenterInternal()||!Vr(this.getCenterInternal(),c))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:c,resolution:l,duration:o,easing:ye,anchor:h}))},r.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(1,1)},r.prototype.endInteraction=function(t,e,i){var o=i&&oe(i,this.getProjection());this.endInteractionInternal(t,e,o)},r.prototype.endInteractionInternal=function(t,e,i){this.setHint(1,-1),this.resolveConstraints(t,e,i)},r.prototype.getConstrainedCenter=function(t,e){var i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)},r.prototype.getConstrainedZoom=function(t,e){var i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))},r.prototype.getConstrainedResolution=function(t,e){var i=e||0,o=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,i,o)},r}(qt);function cn(n,r){setTimeout(function(){n(r)},0)}function Jl(n){return!(n.sourceCenter&&n.targetCenter&&!Vr(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function pi(n,r,t,e,i){var o=Math.cos(-i),a=Math.sin(-i),s=n[0]*o-n[1]*a,u=n[1]*o+n[0]*a;return[(s+=(r[0]/2-t[0])*e)*o-(u+=(t[1]-r[1]/2)*e)*(a=-a),u*o+s*a]}const me=Kl;function da(n){return n[0]>0&&n[1]>0}function Ot(n,r){return Array.isArray(n)?n:(void 0===r?r=[n,n]:(r[0]=n,r[1]=n),r)}var $l=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}();function pa(n){n instanceof lr?n.setMapInternal(null):n instanceof tn&&n.getLayers().forEach(pa)}function va(n,r){if(n instanceof lr)n.setMapInternal(r);else if(n instanceof tn)for(var t=n.getLayers().getArray(),e=0,i=t.length;e<i;++e)va(t[e],r)}var tc=function(n){function r(t){var e=n.call(this)||this,i=function ec(n){var r=null;void 0!==n.keyboardEventTarget&&(r="string"==typeof n.keyboardEventTarget?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);var i,o,a,t={},e=n.layers&&"function"==typeof n.layers.getLayers?n.layers:new tn({layers:n.layers});return t.layergroup=e,t.target=n.target,t.view=n.view instanceof me?n.view:new me,void 0!==n.controls&&(Array.isArray(n.controls)?i=new Nt(n.controls.slice()):(W("function"==typeof n.controls.getArray,47),i=n.controls)),void 0!==n.interactions&&(Array.isArray(n.interactions)?o=new Nt(n.interactions.slice()):(W("function"==typeof n.interactions.getArray,48),o=n.interactions)),void 0!==n.overlays?Array.isArray(n.overlays)?a=new Nt(n.overlays.slice()):(W("function"==typeof n.overlays.getArray,49),a=n.overlays):a=new Nt,{controls:i,interactions:o,keyboardEventTarget:r,overlays:a,values:t}}(t);e.loaded_=!0,e.boundHandleBrowserEvent_=e.handleBrowserEvent.bind(e),e.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,e.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:Lr,e.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(e),e.coordinateToPixelTransform_=[1,0,0,1,0,0],e.pixelToCoordinateTransform_=[1,0,0,1,0,0],e.frameIndex_=0,e.frameState_=null,e.previousExtent_=null,e.viewPropertyListenerKey_=null,e.viewChangeListenerKey_=null,e.layerGroupPropertyListenerKeys_=null,e.viewport_=document.createElement("div"),e.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),e.viewport_.style.position="relative",e.viewport_.style.overflow="hidden",e.viewport_.style.width="100%",e.viewport_.style.height="100%",e.overlayContainer_=document.createElement("div"),e.overlayContainer_.style.position="absolute",e.overlayContainer_.style.zIndex="0",e.overlayContainer_.style.width="100%",e.overlayContainer_.style.height="100%",e.overlayContainer_.style.pointerEvents="none",e.overlayContainer_.className="ol-overlaycontainer",e.viewport_.appendChild(e.overlayContainer_),e.overlayContainerStopEvent_=document.createElement("div"),e.overlayContainerStopEvent_.style.position="absolute",e.overlayContainerStopEvent_.style.zIndex="0",e.overlayContainerStopEvent_.style.width="100%",e.overlayContainerStopEvent_.style.height="100%",e.overlayContainerStopEvent_.style.pointerEvents="none",e.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",e.viewport_.appendChild(e.overlayContainerStopEvent_),e.mapBrowserEventHandler_=null,e.moveTolerance_=t.moveTolerance,e.keyboardEventTarget_=i.keyboardEventTarget,e.targetChangeHandlerKeys_=null,e.controls=i.controls||new Nt,e.interactions=i.interactions||new Nt,e.overlays_=i.overlays,e.overlayIdIndex_={},e.renderer_=null,e.postRenderFunctions_=[],e.tileQueue_=new Vu(e.getTilePriority.bind(e),e.handleTileChange_.bind(e)),e.addChangeListener("layergroup",e.handleLayerGroupChanged_),e.addChangeListener("view",e.handleViewChanged_),e.addChangeListener("size",e.handleSizeChanged_),e.addChangeListener("target",e.handleTargetChanged_),e.setProperties(i.values);var o=e;return t.view&&!(t.view instanceof me)&&t.view.then(function(a){o.setView(new me(a))}),e.controls.addEventListener("add",function(a){a.element.setMap(this)}.bind(e)),e.controls.addEventListener("remove",function(a){a.element.setMap(null)}.bind(e)),e.interactions.addEventListener("add",function(a){a.element.setMap(this)}.bind(e)),e.interactions.addEventListener("remove",function(a){a.element.setMap(null)}.bind(e)),e.overlays_.addEventListener("add",function(a){this.addOverlayInternal_(a.element)}.bind(e)),e.overlays_.addEventListener("remove",function(a){var u=a.element.getId();void 0!==u&&delete this.overlayIdIndex_[u.toString()],a.element.setMap(null)}.bind(e)),e.controls.forEach(function(a){a.setMap(this)}.bind(e)),e.interactions.forEach(function(a){a.setMap(this)}.bind(e)),e.overlays_.forEach(e.addOverlayInternal_.bind(e)),e}return $l(r,n),r.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},r.prototype.addControl=function(t){this.getControls().push(t)},r.prototype.addInteraction=function(t){this.getInteractions().push(t)},r.prototype.addLayer=function(t){this.getLayerGroup().getLayers().push(t)},r.prototype.handleLayerAdd_=function(t){va(t.layer,this)},r.prototype.addOverlay=function(t){this.getOverlays().push(t)},r.prototype.addOverlayInternal_=function(t){var e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)},r.prototype.disposeInternal=function(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.setTarget(null),n.prototype.disposeInternal.call(this)},r.prototype.forEachFeatureAtPixel=function(t,e,i){if(this.frameState_&&this.renderer_){var o=this.getCoordinateFromPixelInternal(t);return this.renderer_.forEachFeatureAtCoordinate(o,this.frameState_,void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance:0,!1!==i.checkWrapped,e,null,void 0!==i.layerFilter?i.layerFilter:x,null)}},r.prototype.getFeaturesAtPixel=function(t,e){var i=[];return this.forEachFeatureAtPixel(t,function(o){i.push(o)},e),i},r.prototype.getAllLayers=function(){var t=[];return function e(i){i.forEach(function(o){o instanceof tn?e(o.getLayers()):t.push(o)})}(this.getLayers()),t},r.prototype.forEachLayerAtPixel=function(t,e,i){if(this.frameState_&&this.renderer_){var o=i||{};return this.renderer_.forEachLayerAtPixel(t,this.frameState_,void 0!==o.hitTolerance?o.hitTolerance:0,e,o.layerFilter||x)}},r.prototype.hasFeatureAtPixel=function(t,e){if(!this.frameState_||!this.renderer_)return!1;var i=this.getCoordinateFromPixelInternal(t);return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,void 0!==(e=void 0!==e?e:{}).hitTolerance?e.hitTolerance:0,!1!==e.checkWrapped,void 0!==e.layerFilter?e.layerFilter:x,null)},r.prototype.getEventCoordinate=function(t){return this.getCoordinateFromPixel(this.getEventPixel(t))},r.prototype.getEventCoordinateInternal=function(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))},r.prototype.getEventPixel=function(t){var e=this.viewport_.getBoundingClientRect(),i="changedTouches"in t?t.changedTouches[0]:t;return[i.clientX-e.left,i.clientY-e.top]},r.prototype.getTarget=function(){return this.get("target")},r.prototype.getTargetElement=function(){var t=this.getTarget();return void 0!==t?"string"==typeof t?document.getElementById(t):t:null},r.prototype.getCoordinateFromPixel=function(t){return ei(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())},r.prototype.getCoordinateFromPixelInternal=function(t){var e=this.frameState_;return e?ut(e.pixelToCoordinateTransform,t.slice()):null},r.prototype.getControls=function(){return this.controls},r.prototype.getOverlays=function(){return this.overlays_},r.prototype.getOverlayById=function(t){var e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null},r.prototype.getInteractions=function(){return this.interactions},r.prototype.getLayerGroup=function(){return this.get("layergroup")},r.prototype.setLayers=function(t){var e=this.getLayerGroup();if(t instanceof Nt)e.setLayers(t);else{var i=e.getLayers();i.clear(),i.extend(t)}},r.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},r.prototype.getLoadingOrNotReady=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),e=0,i=t.length;e<i;++e){var o=t[e];if(o.visible){var a=o.layer.getRenderer();if(a&&!a.ready)return!0;var s=o.layer.getSource();if(s&&s.loading)return!0}}return!1},r.prototype.getPixelFromCoordinate=function(t){var e=oe(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)},r.prototype.getPixelFromCoordinateInternal=function(t){var e=this.frameState_;return e?ut(e.coordinateToPixelTransform,t.slice(0,2)):null},r.prototype.getRenderer=function(){return this.renderer_},r.prototype.getSize=function(){return this.get("size")},r.prototype.getView=function(){return this.get("view")},r.prototype.getViewport=function(){return this.viewport_},r.prototype.getOverlayContainer=function(){return this.overlayContainer_},r.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},r.prototype.getOwnerDocument=function(){var t=this.getTargetElement();return t?t.ownerDocument:document},r.prototype.getTilePriority=function(t,e,i,o){return function Ku(n,r,t,e,i){if(!n||!(t in n.wantedTiles)||!n.wantedTiles[t][r.getKey()])return en;var o=n.viewState.center,a=e[0]-o[0],s=e[1]-o[1];return 65536*Math.log(i)+Math.sqrt(a*a+s*s)/i}(this.frameState_,t,e,i,o)},r.prototype.handleBrowserEvent=function(t,e){var o=new pe(e||t.type,this,t);this.handleMapBrowserEvent(o)},r.prototype.handleMapBrowserEvent=function(t){if(this.frameState_){var e=t.originalEvent,i=e.type;if("pointerdown"===i||"wheel"===i||"keydown"===i){var o=this.getOwnerDocument(),a=this.viewport_.getRootNode?this.viewport_.getRootNode():o,s=e.target;if(this.overlayContainerStopEvent_.contains(s)||!(a===o?o.documentElement:a).contains(s))return}if(t.frameState=this.frameState_,!1!==this.dispatchEvent(t))for(var u=this.getInteractions().getArray().slice(),l=u.length-1;l>=0;l--){var c=u[l];if(c.getMap()===this&&c.getActive()&&this.getTargetElement()&&(!c.handleEvent(t)||t.propagationStopped))break}}},r.prototype.handlePostRender=function(){var t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){var i=this.maxTilesLoading_,o=i;if(t){var a=t.viewHints;if(a[0]||a[1]){var s=Date.now()-t.time>8;i=s?0:8,o=s?0:2}}e.getTilesLoading()<i&&(e.reprioritize(),e.loadMoreTiles(i,o))}t&&this.renderer_&&!t.animate&&(!0===this.renderComplete_?(this.hasListener("rendercomplete")&&this.renderer_.dispatchRenderEvent("rendercomplete",t),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new Ye("loadend",this,t)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new Ye("loadstart",this,t))));for(var u=this.postRenderFunctions_,l=0,c=u.length;l<c;++l)u[l](this,t);u.length=0},r.prototype.handleSizeChanged_=function(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()},r.prototype.handleTargetChanged_=function(){if(this.mapBrowserEventHandler_){for(var t=0,e=this.targetChangeHandlerKeys_.length;t<e;++t)Q(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener("contextmenu",this.boundHandleBrowserEvent_),this.viewport_.removeEventListener("wheel",this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,jn(this.viewport_)}var i=this.getTargetElement();if(i){for(var o in i.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer()),this.mapBrowserEventHandler_=new ju(this,this.moveTolerance_),nt)this.mapBrowserEventHandler_.addEventListener(nt[o],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener("contextmenu",this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener("wheel",this.boundHandleBrowserEvent_,!!Ct&&{passive:!1});var a=this.getOwnerDocument().defaultView,s=this.keyboardEventTarget_?this.keyboardEventTarget_:i;this.targetChangeHandlerKeys_=[j(s,"keydown",this.handleBrowserEvent,this),j(s,"keypress",this.handleBrowserEvent,this),j(a,"resize",this.updateSize,this)]}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()},r.prototype.handleTileChange_=function(){this.render()},r.prototype.handleViewPropertyChanged_=function(){this.render()},r.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(Q(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Q(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=j(t,"propertychange",this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=j(t,"change",this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()},r.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Q),this.layerGroupPropertyListenerKeys_=null);var t=this.getLayerGroup();t&&(this.handleLayerAdd_(new de("addlayer",t)),this.layerGroupPropertyListenerKeys_=[j(t,"propertychange",this.render,this),j(t,"change",this.render,this),j(t,"addlayer",this.handleLayerAdd_,this),j(t,"removelayer",this.handleLayerRemove_,this)]),this.render()},r.prototype.isRendered=function(){return!!this.frameState_},r.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},r.prototype.redrawText=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),e=0,i=t.length;e<i;++e){var o=t[e].layer;o.hasRenderer()&&o.getRenderer().handleFontsChanged()}},r.prototype.render=function(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},r.prototype.removeControl=function(t){return this.getControls().remove(t)},r.prototype.removeInteraction=function(t){return this.getInteractions().remove(t)},r.prototype.removeLayer=function(t){return this.getLayerGroup().getLayers().remove(t)},r.prototype.handleLayerRemove_=function(t){pa(t.layer)},r.prototype.removeOverlay=function(t){return this.getOverlays().remove(t)},r.prototype.renderFrame_=function(t){var e=this,i=this.getSize(),o=this.getView(),a=this.frameState_,s=null;if(void 0!==i&&da(i)&&o&&o.isDef()){var u=o.getHints(this.frameState_?this.frameState_.viewHints:void 0),l=o.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Gn(l.center,l.resolution,l.rotation,i),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:i,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:l,viewHints:u,wantedTiles:{},mapId:P(this),renderTargets:{}},l.nextCenter&&l.nextResolution){var c=isNaN(l.nextRotation)?l.rotation:l.nextRotation;s.nextExtent=Gn(l.nextCenter,l.nextResolution,c,i)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),a&&(!this.previousExtent_||!Gr(this.previousExtent_)&&!be(s.extent,this.previousExtent_))&&(this.dispatchEvent(new Ye("movestart",this,a)),this.previousExtent_=Ne(this.previousExtent_)),this.previousExtent_&&!s.viewHints[0]&&!s.viewHints[1]&&!be(s.extent,this.previousExtent_)&&(this.dispatchEvent(new Ye("moveend",this,s)),function Fs(n,r){r?(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3]):n.slice()}(s.extent,this.previousExtent_))),this.dispatchEvent(new Ye("postrender",this,s)),this.renderComplete_=this.hasListener("loadstart")||this.hasListener("loadend")||this.hasListener("rendercomplete")?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(function(){e.postRenderTimeoutHandle_=void 0,e.handlePostRender()},0))},r.prototype.setLayerGroup=function(t){var e=this.getLayerGroup();e&&this.handleLayerRemove_(new de("removelayer",e)),this.set("layergroup",t)},r.prototype.setSize=function(t){this.set("size",t)},r.prototype.setTarget=function(t){this.set("target",t)},r.prototype.setView=function(t){if(!t||t instanceof me)this.set("view",t);else{this.set("view",new me);var e=this;t.then(function(i){e.setView(new me(i))})}},r.prototype.updateSize=function(){var t=this.getTargetElement(),e=void 0;if(t){var i=getComputedStyle(t),o=t.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),a=t.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(o)&&!isNaN(a)&&!da(e=[o,a])&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0.")}this.setSize(e),this.updateViewportSize_()},r.prototype.updateViewportSize_=function(){var t=this.getView();if(t){var e=void 0,i=getComputedStyle(this.viewport_);i.width&&i.height&&(e=[parseInt(i.width,10),parseInt(i.height,10)]),t.setViewportSize(e)}},r}(qt);const rc=tc;var nc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),ic=function(n){function r(t){var e=n.call(this)||this,i=t.element;return i&&!t.target&&!i.style.pointerEvents&&(i.style.pointerEvents="auto"),e.element=i||null,e.target_=null,e.map_=null,e.listenerKeys=[],t.render&&(e.render=t.render),t.target&&e.setTarget(t.target),e}return nc(r,n),r.prototype.disposeInternal=function(){jn(this.element),n.prototype.disposeInternal.call(this)},r.prototype.getMap=function(){return this.map_},r.prototype.setMap=function(t){this.map_&&jn(this.element);for(var e=0,i=this.listenerKeys.length;e<i;++e)Q(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==O&&this.listenerKeys.push(j(t,"postrender",this.render,this)),t.render())},r.prototype.render=function(t){},r.prototype.setTarget=function(t){this.target_="string"==typeof t?document.getElementById(t):t},r}(qt);const hn=ic;var oc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),ac=function(n){function r(t){var e=this,i=t||{};(e=n.call(this,{element:document.createElement("div"),render:i.render,target:i.target})||this).ulElement_=document.createElement("ul"),e.collapsed_=void 0===i.collapsed||i.collapsed,e.userCollapsed_=e.collapsed_,e.overrideCollapsible_=void 0!==i.collapsible,e.collapsible_=void 0===i.collapsible||i.collapsible,e.collapsible_||(e.collapsed_=!1);var o=void 0!==i.className?i.className:"ol-attribution",a=void 0!==i.tipLabel?i.tipLabel:"Attributions",s=void 0!==i.expandClassName?i.expandClassName:o+"-expand",u=void 0!==i.collapseLabel?i.collapseLabel:"\u203a",l=void 0!==i.collapseClassName?i.collapseClassName:o+"-collapse";"string"==typeof u?(e.collapseLabel_=document.createElement("span"),e.collapseLabel_.textContent=u,e.collapseLabel_.className=l):e.collapseLabel_=u;var c=void 0!==i.label?i.label:"i";"string"==typeof c?(e.label_=document.createElement("span"),e.label_.textContent=c,e.label_.className=s):e.label_=c;var h=e.collapsible_&&!e.collapsed_?e.collapseLabel_:e.label_;e.toggleButton_=document.createElement("button"),e.toggleButton_.setAttribute("type","button"),e.toggleButton_.setAttribute("aria-expanded",String(!e.collapsed_)),e.toggleButton_.title=a,e.toggleButton_.appendChild(h),e.toggleButton_.addEventListener("click",e.handleClick_.bind(e),!1);var d=e.element;return d.className=o+" "+hr+" "+Zr+(e.collapsed_&&e.collapsible_?" "+To:"")+(e.collapsible_?"":" ol-uncollapsible"),d.appendChild(e.toggleButton_),d.appendChild(e.ulElement_),e.renderedAttributions_=[],e.renderedVisible_=!0,e}return oc(r,n),r.prototype.collectSourceAttributions_=function(t){for(var e={},i=[],o=!0,a=t.layerStatesArray,s=0,u=a.length;s<u;++s){var l=a[s];if(kr(l,t.viewState)){var c=l.layer.getSource();if(c){var h=c.getAttributions();if(h){var f=h(t);if(f)if(o=o&&!1!==c.getAttributionsCollapsible(),Array.isArray(f))for(var d=0,p=f.length;d<p;++d)f[d]in e||(i.push(f[d]),e[f[d]]=!0);else f in e||(i.push(f),e[f]=!0)}}}}return this.overrideCollapsible_||this.setCollapsible(o),i},r.prototype.updateElement_=function(t){if(t){var e=this.collectSourceAttributions_(t),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!Dt(e,this.renderedAttributions_)){!function xu(n){for(;n.lastChild;)n.removeChild(n.lastChild)}(this.ulElement_);for(var o=0,a=e.length;o<a;++o){var s=document.createElement("li");s.innerHTML=e[o],this.ulElement_.appendChild(s)}this.renderedAttributions_=e}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},r.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_},r.prototype.handleToggle_=function(){this.element.classList.toggle(To),this.collapsed_?Hr(this.collapseLabel_,this.label_):Hr(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))},r.prototype.getCollapsible=function(){return this.collapsible_},r.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())},r.prototype.setCollapsed=function(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()},r.prototype.getCollapsed=function(){return this.collapsed_},r.prototype.render=function(t){this.updateElement_(t.frameState)},r}(hn);const sc=ac;var uc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),lc=function(n){function r(t){var e=this,i=t||{};e=n.call(this,{element:document.createElement("div"),render:i.render,target:i.target})||this;var o=void 0!==i.className?i.className:"ol-rotate",a=void 0!==i.label?i.label:"\u21e7",s=void 0!==i.compassClassName?i.compassClassName:"ol-compass";e.label_=null,"string"==typeof a?(e.label_=document.createElement("span"),e.label_.className=s,e.label_.textContent=a):(e.label_=a,e.label_.classList.add(s));var u=i.tipLabel?i.tipLabel:"Reset rotation",l=document.createElement("button");l.className=o+"-reset",l.setAttribute("type","button"),l.title=u,l.appendChild(e.label_),l.addEventListener("click",e.handleClick_.bind(e),!1);var h=e.element;return h.className=o+" "+hr+" "+Zr,h.appendChild(l),e.callResetNorth_=i.resetNorth?i.resetNorth:void 0,e.duration_=void 0!==i.duration?i.duration:250,e.autoHide_=void 0===i.autoHide||i.autoHide,e.rotation_=void 0,e.autoHide_&&e.element.classList.add(Kr),e}return uc(r,n),r.prototype.handleClick_=function(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},r.prototype.resetNorth_=function(){var e=this.getMap().getView();if(e){var i=e.getRotation();void 0!==i&&(this.duration_>0&&i%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:ye}):e.setRotation(0))}},r.prototype.render=function(t){var e=t.frameState;if(e){var i=e.viewState.rotation;if(i!=this.rotation_){var o="rotate("+i+"rad)";if(this.autoHide_){var a=this.element.classList.contains(Kr);a||0!==i?a&&0!==i&&this.element.classList.remove(Kr):this.element.classList.add(Kr)}this.label_.style.transform=o}this.rotation_=i}},r}(hn);const cc=lc;var hc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),fc=function(n){function r(t){var e=this,i=t||{};e=n.call(this,{element:document.createElement("div"),target:i.target})||this;var o=void 0!==i.className?i.className:"ol-zoom",a=void 0!==i.delta?i.delta:1,s=void 0!==i.zoomInClassName?i.zoomInClassName:o+"-in",u=void 0!==i.zoomOutClassName?i.zoomOutClassName:o+"-out",l=void 0!==i.zoomInLabel?i.zoomInLabel:"+",c=void 0!==i.zoomOutLabel?i.zoomOutLabel:"\u2013",h=void 0!==i.zoomInTipLabel?i.zoomInTipLabel:"Zoom in",f=void 0!==i.zoomOutTipLabel?i.zoomOutTipLabel:"Zoom out",d=document.createElement("button");d.className=s,d.setAttribute("type","button"),d.title=h,d.appendChild("string"==typeof l?document.createTextNode(l):l),d.addEventListener("click",e.handleClick_.bind(e,a),!1);var p=document.createElement("button");p.className=u,p.setAttribute("type","button"),p.title=f,p.appendChild("string"==typeof c?document.createTextNode(c):c),p.addEventListener("click",e.handleClick_.bind(e,-a),!1);var y=e.element;return y.className=o+" "+hr+" "+Zr,y.appendChild(d),y.appendChild(p),e.duration_=void 0!==i.duration?i.duration:250,e}return hc(r,n),r.prototype.handleClick_=function(t,e){e.preventDefault(),this.zoomByDelta_(t)},r.prototype.zoomByDelta_=function(t){var i=this.getMap().getView();if(i){var o=i.getZoom();if(void 0!==o){var a=i.getConstrainedZoom(o+t);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:a,duration:this.duration_,easing:ye})):i.setZoom(a)}}},r}(hn);const dc=fc;function _a(n){var r=n||{},t=new Nt;return(void 0===r.zoom||r.zoom)&&t.push(new dc(r.zoomOptions)),(void 0===r.rotate||r.rotate)&&t.push(new cc(r.rotateOptions)),(void 0===r.attribution||r.attribution)&&t.push(new sc(r.attributionOptions)),t}var pc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),vc=function(n){function r(t){var e=n.call(this)||this;return t&&t.handleEvent&&(e.handleEvent=t.handleEvent),e.map_=null,e.setActive(!0),e}return pc(r,n),r.prototype.getActive=function(){return this.get("active")},r.prototype.getMap=function(){return this.map_},r.prototype.handleEvent=function(t){return!0},r.prototype.setActive=function(t){this.set("active",t)},r.prototype.setMap=function(t){this.map_=t},r}(qt);function vi(n,r,t,e){var i=n.getZoom();if(void 0!==i){var o=n.getConstrainedZoom(i+r),a=n.getResolutionForZoom(o);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:a,anchor:t,duration:void 0!==e?e:250,easing:ye})}}const gr=vc;var gc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),yc=function(n){function r(t){var e=n.call(this)||this,i=t||{};return e.delta_=i.delta?i.delta:1,e.duration_=void 0!==i.duration?i.duration:250,e}return gc(r,n),r.prototype.handleEvent=function(t){var e=!1;if(t.type==nt.DBLCLICK){var i=t.originalEvent,a=t.coordinate,s=i.shiftKey?-this.delta_:this.delta_;vi(t.map.getView(),s,a,this.duration_),i.preventDefault(),e=!0}return!e},r}(gr);const mc=yc;var Ec=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Tc=function(n){function r(t){var e=this,i=t||{};return e=n.call(this,i)||this,i.handleDownEvent&&(e.handleDownEvent=i.handleDownEvent),i.handleDragEvent&&(e.handleDragEvent=i.handleDragEvent),i.handleMoveEvent&&(e.handleMoveEvent=i.handleMoveEvent),i.handleUpEvent&&(e.handleUpEvent=i.handleUpEvent),i.stopDown&&(e.stopDown=i.stopDown),e.handlingDownUpSequence=!1,e.targetPointers=[],e}return Ec(r,n),r.prototype.getPointerCount=function(){return this.targetPointers.length},r.prototype.handleDownEvent=function(t){return!1},r.prototype.handleDragEvent=function(t){},r.prototype.handleEvent=function(t){if(!t.originalEvent)return!0;var e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==nt.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==nt.POINTERUP){var i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==nt.POINTERDOWN){var o=this.handleDownEvent(t);this.handlingDownUpSequence=o,e=this.stopDown(o)}else t.type==nt.POINTERMOVE&&this.handleMoveEvent(t);return!e},r.prototype.handleMoveEvent=function(t){},r.prototype.handleUpEvent=function(t){return!1},r.prototype.stopDown=function(t){return t},r.prototype.updateTrackedPointers_=function(t){t.activePointers&&(this.targetPointers=t.activePointers)},r}(gr);function _i(n){for(var r=n.length,t=0,e=0,i=0;i<r;i++)t+=n[i].clientX,e+=n[i].clientY;return[t/r,e/r]}const yr=Tc;function gi(n){var r=arguments;return function(t){for(var e=!0,i=0,o=r.length;i<o&&(e=e&&r[i](t));++i);return e}}var Rc=function(n){var r=n.originalEvent;return r.altKey&&!(r.metaKey||r.ctrlKey)&&r.shiftKey},ya=function(n){return!n.map.getTargetElement().hasAttribute("tabindex")||function(n){var r=n.map.getTargetElement(),t=n.map.getOwnerDocument().activeElement;return r.contains(t)}(n)},Cc=x,ma=function(n){var r=n.originalEvent;return 0==r.button&&!(ue&&le&&r.ctrlKey)},Ea=function(n){var r=n.originalEvent;return!r.altKey&&!(r.metaKey||r.ctrlKey)&&!r.shiftKey},wc=function(n){var r=n.originalEvent;return!r.altKey&&!(r.metaKey||r.ctrlKey)&&r.shiftKey},Ta=function(n){var r=n.originalEvent,t=r.target.tagName;return"INPUT"!==t&&"SELECT"!==t&&"TEXTAREA"!==t&&!r.target.isContentEditable},yi=function(n){var r=n.originalEvent;return W(void 0!==r,56),"mouse"==r.pointerType},Ac=function(n){var r=n.originalEvent;return W(void 0!==r,56),r.isPrimary&&0===r.button},Sc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Oc=function(n){function r(t){var e=n.call(this,{stopDown:M})||this,i=t||{};e.kinetic_=i.kinetic,e.lastCentroid=null,e.panning_=!1;var o=i.condition?i.condition:gi(Ea,Ac);return e.condition_=i.onFocusOnly?gi(ya,o):o,e.noKinetic_=!1,e}return Sc(r,n),r.prototype.handleDragEvent=function(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var e=this.targetPointers,i=_i(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){var o=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],s=t.map.getView();(function hu(n,r){n[0]*=r,n[1]*=r})(o,s.getResolution()),Bn(o,s.getRotation()),s.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()},r.prototype.handleUpEvent=function(t){var e=t.map,i=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var o=this.kinetic_.getDistance(),a=this.kinetic_.getAngle(),s=i.getCenterInternal(),u=e.getPixelFromCoordinateInternal(s),l=e.getCoordinateFromPixelInternal([u[0]-o*Math.cos(a),u[1]-o*Math.sin(a)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:ye})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},r.prototype.handleDownEvent=function(t){if(this.targetPointers.length>0&&this.condition_(t)){var i=t.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1},r}(yr);const Pc=Oc;var Lc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Ic=function(n){function r(t){var e=this,i=t||{};return(e=n.call(this,{stopDown:M})||this).condition_=i.condition?i.condition:Rc,e.lastAngle_=void 0,e.duration_=void 0!==i.duration?i.duration:250,e}return Lc(r,n),r.prototype.handleDragEvent=function(t){if(yi(t)){var e=t.map,i=e.getView();if(i.getConstraints().rotation!==ii){var o=e.getSize(),a=t.pixel,s=Math.atan2(o[1]/2-a[1],a[0]-o[0]/2);void 0!==this.lastAngle_&&i.adjustRotationInternal(-(s-this.lastAngle_)),this.lastAngle_=s}}},r.prototype.handleUpEvent=function(t){return!yi(t)||(t.map.getView().endInteraction(this.duration_),!1)},r.prototype.handleDownEvent=function(t){return!(!yi(t)||!ma(t)||!this.condition_(t)||(t.map.getView().beginInteraction(),this.lastAngle_=void 0,0))},r}(yr);const Mc=Ic;var Fc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Dc=function(n){function r(t){var e=n.call(this)||this;return e.geometry_=null,e.element_=document.createElement("div"),e.element_.style.position="absolute",e.element_.style.pointerEvents="auto",e.element_.className="ol-box "+t,e.map_=null,e.startPixel_=null,e.endPixel_=null,e}return Fc(r,n),r.prototype.disposeInternal=function(){this.setMap(null)},r.prototype.render_=function(){var t=this.startPixel_,e=this.endPixel_,i="px",o=this.element_.style;o.left=Math.min(t[0],e[0])+i,o.top=Math.min(t[1],e[1])+i,o.width=Math.abs(e[0]-t[0])+i,o.height=Math.abs(e[1]-t[1])+i},r.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},r.prototype.setPixels=function(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()},r.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,e=this.endPixel_,o=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);o[4]=o[0].slice(),this.geometry_?this.geometry_.setCoordinates([o]):this.geometry_=new Yl([o])},r.prototype.getGeometry=function(){return this.geometry_},r}(Bt);const Nc=Dc;var Ra=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),mi=function(n){function r(t,e,i){var o=n.call(this,t)||this;return o.coordinate=e,o.mapBrowserEvent=i,o}return Ra(r,n),r}(ne),bc=function(n){function r(t){var e=n.call(this)||this,i=t||{};return e.box_=new Nc(i.className||"ol-dragbox"),e.minArea_=void 0!==i.minArea?i.minArea:64,i.onBoxEnd&&(e.onBoxEnd=i.onBoxEnd),e.startPixel_=null,e.condition_=i.condition?i.condition:ma,e.boxEndCondition_=i.boxEndCondition?i.boxEndCondition:e.defaultBoxEndCondition,e}return Ra(r,n),r.prototype.defaultBoxEndCondition=function(t,e,i){var o=i[0]-e[0],a=i[1]-e[1];return o*o+a*a>=this.minArea_},r.prototype.getGeometry=function(){return this.box_.getGeometry()},r.prototype.handleDragEvent=function(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new mi("boxdrag",t.coordinate,t))},r.prototype.handleUpEvent=function(t){this.box_.setMap(null);var e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new mi(e?"boxend":"boxcancel",t.coordinate,t)),!1},r.prototype.handleDownEvent=function(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new mi("boxstart",t.coordinate,t)),!0)},r.prototype.onBoxEnd=function(t){},r}(yr);const Gc=bc;var Uc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Xc=function(n){function r(t){var e=this,i=t||{};return(e=n.call(this,{condition:i.condition?i.condition:wc,className:i.className||"ol-dragzoom",minArea:i.minArea})||this).duration_=void 0!==i.duration?i.duration:200,e.out_=void 0!==i.out&&i.out,e}return Uc(r,n),r.prototype.onBoxEnd=function(t){var i=this.getMap().getView(),o=this.getGeometry();if(this.out_){var a=i.rotatedExtentForGeometry(o),s=i.getResolutionForExtentInternal(a),u=i.getResolution()/s;(o=o.clone()).scale(u*u)}i.fitInternal(o,{duration:this.duration_,easing:ye})},r}(Gc);const Bc=Xc;var jc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),zc=function(n){function r(t){var e=n.call(this)||this,i=t||{};return e.defaultCondition_=function(o){return Ea(o)&&Ta(o)},e.condition_=void 0!==i.condition?i.condition:e.defaultCondition_,e.duration_=void 0!==i.duration?i.duration:100,e.pixelDelta_=void 0!==i.pixelDelta?i.pixelDelta:128,e}return jc(r,n),r.prototype.handleEvent=function(t){var e=!1;if("keydown"==t.type){var i=t.originalEvent,o=i.keyCode;if(this.condition_(t)&&(40==o||37==o||39==o||38==o)){var s=t.map.getView(),u=s.getResolution()*this.pixelDelta_,l=0,c=0;40==o?c=-u:37==o?l=-u:39==o?l=u:c=u;var h=[l,c];Bn(h,s.getRotation()),function _c(n,r,t){var e=n.getCenterInternal();e&&n.animateInternal({duration:void 0!==t?t:250,easing:Tl,center:n.getConstrainedCenter([e[0]+r[0],e[1]+r[1]])})}(s,h,this.duration_),i.preventDefault(),e=!0}}return!e},r}(gr);const Wc=zc;var Yc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),kc=function(n){function r(t){var e=n.call(this)||this,i=t||{};return e.condition_=i.condition?i.condition:Ta,e.delta_=i.delta?i.delta:1,e.duration_=void 0!==i.duration?i.duration:100,e}return Yc(r,n),r.prototype.handleEvent=function(t){var e=!1;if("keydown"==t.type||"keypress"==t.type){var i=t.originalEvent,o=i.charCode;if(this.condition_(t)&&(o=="+".charCodeAt(0)||o=="-".charCodeAt(0))){var a=t.map,s=o=="+".charCodeAt(0)?this.delta_:-this.delta_;vi(a.getView(),s,void 0,this.duration_),i.preventDefault(),e=!0}}return!e},r}(gr);const Vc=kc;var Kc=function(){function n(r,t,e){this.decay_=r,this.minVelocity_=t,this.delay_=e,this.points_=[],this.angle_=0,this.initialVelocity_=0}return n.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},n.prototype.update=function(r,t){this.points_.push(r,t,Date.now())},n.prototype.end=function(){if(this.points_.length<6)return!1;var r=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<r)return!1;for(var e=t-3;e>0&&this.points_[e+2]>r;)e-=3;var i=this.points_[t+2]-this.points_[e+2];if(i<1e3/60)return!1;var o=this.points_[t]-this.points_[e],a=this.points_[t+1]-this.points_[e+1];return this.angle_=Math.atan2(a,o),this.initialVelocity_=Math.sqrt(o*o+a*a)/i,this.initialVelocity_>this.minVelocity_},n.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},n.prototype.getAngle=function(){return this.angle_},n}();const Zc=Kc;var Hc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),qc=function(n){function r(t){var e=this,i=t||{};(e=n.call(this,i)||this).totalDelta_=0,e.lastDelta_=0,e.maxDelta_=void 0!==i.maxDelta?i.maxDelta:1,e.duration_=void 0!==i.duration?i.duration:250,e.timeout_=void 0!==i.timeout?i.timeout:80,e.useAnchor_=void 0===i.useAnchor||i.useAnchor,e.constrainResolution_=void 0!==i.constrainResolution&&i.constrainResolution;var o=i.condition?i.condition:Cc;return e.condition_=i.onFocusOnly?gi(ya,o):o,e.lastAnchor_=null,e.startTime_=void 0,e.mode_=void 0,e.trackpadEventGap_=400,e.deltaPerZoom_=300,e}return Hc(r,n),r.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0;var t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)},r.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;if("wheel"!==t.type)return!0;var a,i=t.map,o=t.originalEvent;if(o.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),"wheel"==t.type&&(a=o.deltaY,st&&o.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(a/=Lr),o.deltaMode===WheelEvent.DOM_DELTA_LINE&&(a*=40)),0===a)return!1;this.lastDelta_=a;var s=Date.now();void 0===this.startTime_&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(a)<4?"trackpad":"wheel");var u=i.getView();if("trackpad"===this.mode_&&!u.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(u.getAnimating()&&u.cancelAnimations(),u.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),u.adjustZoom(-a/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=s,!1;this.totalDelta_+=a;var l=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1},r.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations();var i=-ht(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),vi(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},r.prototype.setMouseAnchor=function(t){this.useAnchor_=t,t||(this.lastAnchor_=null)},r}(gr);const Jc=qc;var Qc=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),$c=function(n){function r(t){var e=this,i=t||{},o=i;return o.stopDown||(o.stopDown=M),(e=n.call(this,o)||this).anchor_=null,e.lastAngle_=void 0,e.rotating_=!1,e.rotationDelta_=0,e.threshold_=void 0!==i.threshold?i.threshold:.3,e.duration_=void 0!==i.duration?i.duration:250,e}return Qc(r,n),r.prototype.handleDragEvent=function(t){var e=0,i=this.targetPointers[0],o=this.targetPointers[1],a=Math.atan2(o.clientY-i.clientY,o.clientX-i.clientX);if(void 0!==this.lastAngle_){var s=a-this.lastAngle_;this.rotationDelta_+=s,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=s}this.lastAngle_=a;var u=t.map,l=u.getView();if(l.getConstraints().rotation!==ii){var c=u.getViewport().getBoundingClientRect(),h=_i(this.targetPointers);h[0]-=c.left,h[1]-=c.top,this.anchor_=u.getCoordinateFromPixelInternal(h),this.rotating_&&(u.render(),l.adjustRotationInternal(e,this.anchor_))}},r.prototype.handleUpEvent=function(t){return!(this.targetPointers.length<2&&(t.map.getView().endInteraction(this.duration_),1))},r.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1},r}(yr);const th=$c;var eh=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),rh=function(n){function r(t){var e=this,i=t||{},o=i;return o.stopDown||(o.stopDown=M),(e=n.call(this,o)||this).anchor_=null,e.duration_=void 0!==i.duration?i.duration:400,e.lastDistance_=void 0,e.lastScaleDelta_=1,e}return eh(r,n),r.prototype.handleDragEvent=function(t){var e=1,i=this.targetPointers[0],o=this.targetPointers[1],a=i.clientX-o.clientX,s=i.clientY-o.clientY,u=Math.sqrt(a*a+s*s);void 0!==this.lastDistance_&&(e=this.lastDistance_/u),this.lastDistance_=u;var l=t.map,c=l.getView();1!=e&&(this.lastScaleDelta_=e);var h=l.getViewport().getBoundingClientRect(),f=_i(this.targetPointers);f[0]-=h.left,f[1]-=h.top,this.anchor_=l.getCoordinateFromPixelInternal(f),l.render(),c.adjustResolutionInternal(e,this.anchor_)},r.prototype.handleUpEvent=function(t){return!(this.targetPointers.length<2&&(t.map.getView().endInteraction(this.duration_,this.lastScaleDelta_>1?1:-1),1))},r.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1},r}(yr);const xa=rh;function Ca(n){var r=n||{},t=new Nt,e=new Zc(-.005,.05,100);return(void 0===r.altShiftDragRotate||r.altShiftDragRotate)&&t.push(new Mc),(void 0===r.doubleClickZoom||r.doubleClickZoom)&&t.push(new mc({delta:r.zoomDelta,duration:r.zoomDuration})),(void 0===r.dragPan||r.dragPan)&&t.push(new Pc({onFocusOnly:r.onFocusOnly,kinetic:e})),(void 0===r.pinchRotate||r.pinchRotate)&&t.push(new th),(void 0===r.pinchZoom||r.pinchZoom)&&t.push(new xa({duration:r.zoomDuration})),(void 0===r.keyboard||r.keyboard)&&(t.push(new Wc),t.push(new Vc({delta:r.zoomDelta,duration:r.zoomDuration}))),(void 0===r.mouseWheelZoom||r.mouseWheelZoom)&&t.push(new Jc({onFocusOnly:r.onFocusOnly,duration:r.zoomDuration})),(void 0===r.shiftDragZoom||r.shiftDragZoom)&&t.push(new Bc({duration:r.zoomDuration})),t}var nh=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),ih=function(n){function r(t){return(t=ot({},t)).controls||(t.controls=_a()),t.interactions||(t.interactions=Ca({onFocusOnly:!0})),n.call(this,t)||this}return nh(r,n),r.prototype.createRenderer=function(){return new Mu(this)},r}(rc);const oh=ih;var ah=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),sh=function(n){function r(t){var e=n.call(this)||this;return e.id_=void 0,e.geometryName_="geometry",e.style_=null,e.styleFunction_=void 0,e.geometryChangeKey_=null,e.addChangeListener(e.geometryName_,e.handleGeometryChanged_),t&&("function"==typeof t.getSimplifiedGeometry?e.setGeometry(t):e.setProperties(t)),e}return ah(r,n),r.prototype.clone=function(){var t=new r(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());var e=this.getGeometry();e&&t.setGeometry(e.clone());var i=this.getStyle();return i&&t.setStyle(i),t},r.prototype.getGeometry=function(){return this.get(this.geometryName_)},r.prototype.getId=function(){return this.id_},r.prototype.getGeometryName=function(){return this.geometryName_},r.prototype.getStyle=function(){return this.style_},r.prototype.getStyleFunction=function(){return this.styleFunction_},r.prototype.handleGeometryChange_=function(){this.changed()},r.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(Q(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=j(t,"change",this.handleGeometryChange_,this)),this.changed()},r.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},r.prototype.setStyle=function(t){this.style_=t,this.styleFunction_=t?function uh(n){return"function"==typeof n?n:(Array.isArray(n)?r=n:(W("function"==typeof n.getZIndex,41),r=[n]),function(){return r});var r}(t):void 0,this.changed()},r.prototype.setId=function(t){this.id_=t,this.changed()},r.prototype.setGeometryName=function(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},r}(qt);const wa=sh;var lh=it(4404),ch=it(2982);function Aa(n,r,t){let e,i=!1;return n&&"object"==typeof n?({bufferSize:e=1/0,windowTime:r=1/0,refCount:i=!1,scheduler:t}=n):e=n??1/0,(0,ch.B)({connector:()=>new lh.t(e,r,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}var hh=it(4925),Sa=it(1322),fh=it(6141),dh=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),ph=function(n){function r(t,e,i){var o=n.call(this)||this,a=i||{};return o.tileCoord=t,o.state=e,o.interimTile=null,o.key="",o.transition_=void 0===a.transition?250:a.transition,o.transitionStarts_={},o.interpolate=!!a.interpolate,o}return dh(r,n),r.prototype.changed=function(){this.dispatchEvent("change")},r.prototype.release=function(){},r.prototype.getKey=function(){return this.key+"/"+this.tileCoord},r.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(2==t.getState())return this.transition_=0,t;t=t.interimTile}while(t);return this},r.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(2==t.getState()){t.interimTile=null;break}1==t.getState()?e=t:0==t.getState()?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}},r.prototype.getTileCoord=function(){return this.tileCoord},r.prototype.getState=function(){return this.state},r.prototype.setState=function(t){if(3!==this.state&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},r.prototype.load=function(){A()},r.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else this.transitionStarts_[t]=i=e;var o=e-i+1e3/60;return o>=this.transition_?1:Vo(o/this.transition_)},r.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]},r.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},r}(ze);const Ti=ph;var vh=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),_h=function(n){function r(t,e,i,o){var a=n.call(this)||this;return a.extent=t,a.pixelRatio_=i,a.resolution=e,a.state=o,a}return vh(r,n),r.prototype.changed=function(){this.dispatchEvent("change")},r.prototype.getExtent=function(){return this.extent},r.prototype.getImage=function(){return A()},r.prototype.getPixelRatio=function(){return this.pixelRatio_},r.prototype.getResolution=function(){return this.resolution},r.prototype.getState=function(){return this.state},r.prototype.load=function(){A()},r}(ze);const gh=_h;var yh=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}();function Oa(n,r,t){var e=n,i=!0,o=!1,a=!1,s=[Wr(e,"load",function(){a=!0,o||r()})];return e.src&&we?(o=!0,e.decode().then(function(){i&&r()}).catch(function(u){i&&(a?r():t())})):s.push(Wr(e,"error",t)),function(){i=!1,s.forEach(Q)}}!function(n){function r(t,e,i,o,a,s){var u=n.call(this,t,e,i,0)||this;return u.src_=o,u.image_=new Image,null!==a&&(u.image_.crossOrigin=a),u.unlisten_=null,u.state=0,u.imageLoadFunction_=s,u}yh(r,n),r.prototype.getImage=function(){return this.image_},r.prototype.handleImageError_=function(){this.state=3,this.unlistenImage_(),this.changed()},r.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=Pt(this.extent)/this.image_.height),this.state=2,this.unlistenImage_(),this.changed()},r.prototype.load=function(){(0==this.state||3==this.state)&&(this.state=1,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=Oa(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},r.prototype.setImage=function(t){this.image_=t,this.resolution=Pt(this.extent)/this.image_.height},r.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}(gh);var mh=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Eh=function(n){function r(t,e,i,o,a,s){var u=n.call(this,t,e,s)||this;return u.crossOrigin_=o,u.src_=i,u.key=i,u.image_=new Image,null!==o&&(u.image_.crossOrigin=o),u.unlisten_=null,u.tileLoadFunction_=a,u}return mh(r,n),r.prototype.getImage=function(){return this.image_},r.prototype.setImage=function(t){this.image_=t,this.state=2,this.unlistenImage_(),this.changed()},r.prototype.handleImageError_=function(){this.state=3,this.unlistenImage_(),this.image_=function Th(){var n=Oe(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}(),this.changed()},r.prototype.handleImageLoad_=function(){var t=this.image_;this.state=t.naturalWidth&&t.naturalHeight?2:4,this.unlistenImage_(),this.changed()},r.prototype.load=function(){3==this.state&&(this.state=0,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),0==this.state&&(this.state=1,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Oa(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},r.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},r}(Ti);const dn=Eh;var Ch=function(){function n(r,t,e,i,o,a){this.sourceProj_=r,this.targetProj_=t;var s={},u=pr(this.targetProj_,this.sourceProj_);this.transformInv_=function(m){var E=m[0]+"/"+m[1];return s[E]||(s[E]=u(m)),s[E]},this.maxSourceExtent_=i,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&et(i)==et(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?et(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?et(this.targetProj_.getExtent()):null;var l=Se(e),c=br(e),h=Nr(e),f=Dr(e),d=this.transformInv_(l),p=this.transformInv_(c),v=this.transformInv_(h),y=this.transformInv_(f),R=10+(a?Math.max(0,Math.ceil(ro(Fr(e)/(a*a*256*256)))):0);if(this.addQuad_(l,c,h,f,d,p,v,y,R),this.wrapsXInSource_){var T=1/0;this.triangles_.forEach(function(m,E,w){T=Math.min(T,m.source[0][0],m.source[1][0],m.source[2][0])}),this.triangles_.forEach(function(m){if(Math.max(m.source[0][0],m.source[1][0],m.source[2][0])-T>this.sourceWorldWidth_/2){var E=[[m.source[0][0],m.source[0][1]],[m.source[1][0],m.source[1][1]],[m.source[2][0],m.source[2][1]]];E[0][0]-T>this.sourceWorldWidth_/2&&(E[0][0]-=this.sourceWorldWidth_),E[1][0]-T>this.sourceWorldWidth_/2&&(E[1][0]-=this.sourceWorldWidth_),E[2][0]-T>this.sourceWorldWidth_/2&&(E[2][0]-=this.sourceWorldWidth_);var w=Math.min(E[0][0],E[1][0],E[2][0]);Math.max(E[0][0],E[1][0],E[2][0])-w<this.sourceWorldWidth_/2&&(m.source=E)}}.bind(this))}s={}}return n.prototype.addTriangle_=function(r,t,e,i,o,a){this.triangles_.push({source:[i,o,a],target:[r,t,e]})},n.prototype.addQuad_=function(r,t,e,i,o,a,s,u,l){var c=Nn([o,a,s,u]),h=this.sourceWorldWidth_?et(c)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&h>.5&&h<1,p=!1;if(l>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(p=et(Nn([r,t,e,i]))/this.targetWorldWidth_>.25||p),!d&&this.sourceProj_.isGlobal()&&h&&(p=h>.25||p)),!(!p&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3]))||Ht(c,this.maxSourceExtent_)){var R=0;if(!(p||isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(u[0])&&isFinite(u[1])))if(l>0)p=!0;else if(1!=(R=(isFinite(o[0])&&isFinite(o[1])?0:8)+(isFinite(a[0])&&isFinite(a[1])?0:4)+(isFinite(s[0])&&isFinite(s[1])?0:2)+(isFinite(u[0])&&isFinite(u[1])?0:1))&&2!=R&&4!=R&&8!=R)return;if(l>0){if(!p){var m=this.transformInv_([(r[0]+e[0])/2,(r[1]+e[1])/2]),E=void 0;E=d?(Xe(o[0],f)+Xe(s[0],f))/2-Xe(m[0],f):(o[0]+s[0])/2-m[0];var I=(o[1]+s[1])/2-m[1];p=E*E+I*I>this.errorThresholdSquared_}if(p){if(Math.abs(r[0]-e[0])<=Math.abs(r[1]-e[1])){var N=[(t[0]+e[0])/2,(t[1]+e[1])/2],X=this.transformInv_(N),B=[(i[0]+r[0])/2,(i[1]+r[1])/2],k=this.transformInv_(B);this.addQuad_(r,t,N,B,o,a,X,k,l-1),this.addQuad_(B,N,e,i,k,X,s,u,l-1)}else{var lt=[(r[0]+t[0])/2,(r[1]+t[1])/2],Tt=this.transformInv_(lt),Rt=[(e[0]+i[0])/2,(e[1]+i[1])/2],rt=this.transformInv_(Rt);this.addQuad_(r,lt,Rt,i,o,Tt,rt,u,l-1),this.addQuad_(lt,t,e,Rt,Tt,a,s,rt,l-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&R)&&this.addTriangle_(r,e,i,o,s,u),0==(14&R)&&this.addTriangle_(r,e,t,o,s,a),R&&(0==(13&R)&&this.addTriangle_(t,i,r,a,u,o),0==(7&R)&&this.addTriangle_(t,i,e,a,u,s))}},n.prototype.calculateSourceExtent=function(){var r=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(t,e,i){var o=t.source;ur(r,o[0]),ur(r,o[1]),ur(r,o[2])}),r},n.prototype.getTriangles=function(){return this.triangles_},n}();const wh=Ch;var xi,Ri={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1},Ah={imageSmoothingEnabled:!0,msImageSmoothingEnabled:!0},La=[];function Ia(n,r,t,e,i){n.beginPath(),n.moveTo(0,0),n.lineTo(r,t),n.lineTo(e,i),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(r,e)+1,Math.max(t,i)),n.restore()}function Ci(n,r){return Math.abs(n[4*r]-210)>2||Math.abs(n[4*r+3]-191.25)>2}function Ma(n,r,t,e){var i=vr(t,r,n),o=Uo(r,e,t),a=r.getMetersPerUnit();void 0!==a&&(o*=a);var s=n.getMetersPerUnit();void 0!==s&&(o/=s);var u=n.getExtent();if(!u||Ae(u,i)){var l=Uo(n,o,i)/o;isFinite(l)&&l>0&&(o/=l)}return o}var Lh=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Ih=function(n){function r(t,e,i,o,a,s,u,l,c,h,f,d){var p=n.call(this,a,0,{interpolate:!!d})||this;p.renderEdges_=void 0!==f&&f,p.pixelRatio_=u,p.gutter_=l,p.canvas_=null,p.sourceTileGrid_=e,p.targetTileGrid_=o,p.wrappedTileCoord_=s||a,p.sourceTiles_=[],p.sourcesListenerKeys_=null,p.sourceZ_=0;var v=o.getTileCoordExtent(p.wrappedTileCoord_),y=p.targetTileGrid_.getExtent(),R=p.sourceTileGrid_.getExtent(),T=y?re(v,y):v;if(0===Fr(T))return p.state=4,p;var m=t.getExtent();m&&(R=R?re(R,m):m);var E=o.getResolution(p.wrappedTileCoord_[0]),w=function Oh(n,r,t,e){var i=Ge(t),o=Ma(n,r,i,e);return(!isFinite(o)||o<=0)&&eo(t,function(a){return o=Ma(n,r,a,e),isFinite(o)&&o>0}),o}(t,i,T,E);if(!isFinite(w)||w<=0)return p.state=4,p;if(p.triangulation_=new wh(t,i,T,R,w*(void 0!==h?h:.5),E),0===p.triangulation_.getTriangles().length)return p.state=4,p;p.sourceZ_=e.getZForResolution(w);var C=p.triangulation_.calculateSourceExtent();if(R&&(t.canWrapX()?(C[1]=ht(C[1],R[1],R[3]),C[3]=ht(C[3],R[1],R[3])):C=re(C,R)),Fr(C)){for(var N=e.getTileRangeForExtentAndZ(C,p.sourceZ_),X=N.minX;X<=N.maxX;X++)for(var B=N.minY;B<=N.maxY;B++){var k=c(p.sourceZ_,X,B,u);k&&p.sourceTiles_.push(k)}0===p.sourceTiles_.length&&(p.state=4)}else p.state=4;return p}return Lh(r,n),r.prototype.getImage=function(){return this.canvas_},r.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(c,h,f){c&&2==c.getState()&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(c.tileCoord),image:c.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=3;else{var e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),o="number"==typeof i?i:i[0],a="number"==typeof i?i:i[1],s=this.targetTileGrid_.getResolution(e),u=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=function Ph(n,r,t,e,i,o,a,s,u,l,c,h){var f=Oe(Math.round(t*n),Math.round(t*r),La);if(h||ot(f,Ri),0===u.length)return f.canvas;function d(E){return Math.round(E*t)/t}f.scale(t,t),f.globalCompositeOperation="lighter";var p=[1/0,1/0,-1/0,-1/0];u.forEach(function(E,w,I){!function bs(n,r){r[0]<n[0]&&(n[0]=r[0]),r[2]>n[2]&&(n[2]=r[2]),r[1]<n[1]&&(n[1]=r[1]),r[3]>n[3]&&(n[3]=r[3])}(p,E.extent)});var v=et(p),y=Pt(p),R=Oe(Math.round(t*v/e),Math.round(t*y/e));h||ot(R,Ri);var T=t/e;u.forEach(function(E,w,I){var C=E.extent[0]-p[0],N=-(E.extent[3]-p[3]),X=et(E.extent),B=Pt(E.extent);E.image.width>0&&E.image.height>0&&R.drawImage(E.image,l,l,E.image.width-2*l,E.image.height-2*l,C*T,N*T,X*T,B*T)});var m=Se(a);return s.getTriangles().forEach(function(E,w,I){var C=E.source,N=E.target,X=C[0][0],B=C[0][1],k=C[1][0],lt=C[1][1],Tt=C[2][0],Rt=C[2][1],rt=d((N[0][0]-m[0])/o),Z=d(-(N[0][1]-m[1])/o),J=d((N[1][0]-m[0])/o),H=d(-(N[1][1]-m[1])/o),It=d((N[2][0]-m[0])/o),ct=d(-(N[2][1]-m[1])/o),xt=X,kt=B;X=0,B=0;var Mt=function Ks(n){for(var r=n.length,t=0;t<r;t++){for(var e=t,i=Math.abs(n[t][t]),o=t+1;o<r;o++){var a=Math.abs(n[o][t]);a>i&&(i=a,e=o)}if(0===i)return null;var s=n[e];n[e]=n[t],n[t]=s;for(var u=t+1;u<r;u++)for(var l=-n[u][t]/n[t][t],c=t;c<r+1;c++)t==c?n[u][c]=0:n[u][c]+=l*n[t][c]}for(var h=new Array(r),f=r-1;f>=0;f--){h[f]=n[f][r]/n[f][f];for(var d=f-1;d>=0;d--)n[d][r]-=n[d][f]*h[f]}return h}([[k-=xt,lt-=kt,0,0,J-rt],[Tt-=xt,Rt-=kt,0,0,It-rt],[0,0,k,lt,H-Z],[0,0,Tt,Rt,ct-Z]]);if(Mt){if(f.save(),f.beginPath(),function Sh(){if(void 0===xi){var n=document.createElement("canvas").getContext("2d");n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",Ia(n,4,5,4,0),Ia(n,4,5,0,5);var r=n.getImageData(0,0,3,3).data;xi=Ci(r,0)||Ci(r,4)||Ci(r,8)}return xi}()||!h){f.moveTo(J,H);for(var Vt=rt-J,te=Z-H,pt=0;pt<4;pt++)f.lineTo(J+d((pt+1)*Vt/4),H+d(pt*te/3)),3!=pt&&f.lineTo(J+d((pt+1)*Vt/4),H+d((pt+1)*te/3));f.lineTo(It,ct)}else f.moveTo(J,H),f.lineTo(rt,Z),f.lineTo(It,ct);f.clip(),f.transform(Mt[0],Mt[2],Mt[1],Mt[3],rt,Z),f.translate(p[0]-xt,p[3]-kt),f.scale(e/t,-e/t),f.drawImage(R.canvas,0,0),f.restore()}}),c&&(f.save(),f.globalCompositeOperation="source-over",f.strokeStyle="black",f.lineWidth=1,s.getTriangles().forEach(function(E,w,I){var C=E.target,N=(C[0][0]-m[0])/o,X=-(C[0][1]-m[1])/o,B=(C[1][0]-m[0])/o,k=-(C[1][1]-m[1])/o,lt=(C[2][0]-m[0])/o,Tt=-(C[2][1]-m[1])/o;f.beginPath(),f.moveTo(B,k),f.lineTo(N,X),f.lineTo(lt,Tt),f.closePath(),f.stroke()}),f.restore()),f.canvas}(o,a,this.pixelRatio_,u,this.sourceTileGrid_.getExtent(),s,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=2}this.changed()},r.prototype.load=function(){if(0==this.state){this.state=1,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,i,o){var a=e.getState();if(0==a||1==a){t++;var s=j(e,"change",function(u){var l=e.getState();(2==l||3==l||4==l)&&(Q(s),0==--t&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(s)}}.bind(this)),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,i,o){0==e.getState()&&e.load()})}},r.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(Q),this.sourcesListenerKeys_=null},r.prototype.release=function(){this.canvas_&&(function Ru(n){var r=n.canvas;r.width=1,r.height=1,n.clearRect(0,0,1,1)}(this.canvas_.getContext("2d")),La.push(this.canvas_),this.canvas_=null),n.prototype.release.call(this)},r}(Ti);const wi=Ih;var Mh=function(){function n(r){this.highWaterMark=void 0!==r?r:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return n.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},n.prototype.expireCache=function(r){for(;this.canExpireCache();)this.pop()},n.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},n.prototype.containsKey=function(r){return this.entries_.hasOwnProperty(r)},n.prototype.forEach=function(r){for(var t=this.oldest_;t;)r(t.value_,t.key_,this),t=t.newer},n.prototype.get=function(r,t){var e=this.entries_[r];return W(void 0!==e,15),e===this.newest_||(e===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(e.newer.older=e.older,e.older.newer=e.newer),e.newer=null,e.older=this.newest_,this.newest_.newer=e,this.newest_=e),e.value_},n.prototype.remove=function(r){var t=this.entries_[r];return W(void 0!==t,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[r],--this.count_,t.value_},n.prototype.getCount=function(){return this.count_},n.prototype.getKeys=function(){var e,r=new Array(this.count_),t=0;for(e=this.newest_;e;e=e.older)r[t++]=e.key_;return r},n.prototype.getValues=function(){var e,r=new Array(this.count_),t=0;for(e=this.newest_;e;e=e.older)r[t++]=e.value_;return r},n.prototype.peekLast=function(){return this.oldest_.value_},n.prototype.peekLastKey=function(){return this.oldest_.key_},n.prototype.peekFirstKey=function(){return this.newest_.key_},n.prototype.peek=function(r){if(this.containsKey(r))return this.entries_[r].value_},n.prototype.pop=function(){var r=this.oldest_;return delete this.entries_[r.key_],r.newer&&(r.newer.older=null),this.oldest_=r.newer,this.oldest_||(this.newest_=null),--this.count_,r.value_},n.prototype.replace=function(r,t){this.get(r),this.entries_[r].value_=t},n.prototype.set=function(r,t){W(!(r in this.entries_),16);var e={key_:r,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=e:this.oldest_=e,this.newest_=e,this.entries_[r]=e,++this.count_},n.prototype.setSize=function(r){this.highWaterMark=r},n}();const Fa=Mh;function pn(n,r,t,e){return void 0!==e?(e[0]=n,e[1]=r,e[2]=t,e):[n,r,t]}function mr(n,r,t){return n+"/"+r+"/"+t}function Er(n){return mr(n[0],n[1],n[2])}var bh=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Gh=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return bh(r,n),r.prototype.expireCache=function(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()},r.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var e=function Fh(n){return n.split("/").map(Number)}(this.peekFirstKey()),i=e[0];this.forEach(function(o){o.tileCoord[0]!==i&&(this.remove(Er(o.tileCoord)),o.release())}.bind(this))}},r}(Fa);const Da=Gh;var Uh=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Xh=function(n){function r(t){var e=n.call(this)||this;e.projection=_t(t.projection),e.attributions_=Na(t.attributions),e.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,e.loading=!1,e.state_=void 0!==t.state?t.state:"ready",e.wrapX_=void 0!==t.wrapX&&t.wrapX,e.interpolate_=!!t.interpolate,e.viewResolver=null,e.viewRejector=null;var i=e;return e.viewPromise_=new Promise(function(o,a){i.viewResolver=o,i.viewRejector=a}),e}return Uh(r,n),r.prototype.getAttributions=function(){return this.attributions_},r.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},r.prototype.getProjection=function(){return this.projection},r.prototype.getResolutions=function(){return A()},r.prototype.getView=function(){return this.viewPromise_},r.prototype.getState=function(){return this.state_},r.prototype.getWrapX=function(){return this.wrapX_},r.prototype.getInterpolate=function(){return this.interpolate_},r.prototype.refresh=function(){this.changed()},r.prototype.setAttributions=function(t){this.attributions_=Na(t),this.changed()},r.prototype.setState=function(t){this.state_=t,this.changed()},r}(qt);function Na(n){return n?Array.isArray(n)?function(r){return n}:"function"==typeof n?n:function(r){return[n]}:null}const ba=Xh;var Ga=function(){function n(r,t,e,i){this.minX=r,this.maxX=t,this.minY=e,this.maxY=i}return n.prototype.contains=function(r){return this.containsXY(r[1],r[2])},n.prototype.containsTileRange=function(r){return this.minX<=r.minX&&r.maxX<=this.maxX&&this.minY<=r.minY&&r.maxY<=this.maxY},n.prototype.containsXY=function(r,t){return this.minX<=r&&r<=this.maxX&&this.minY<=t&&t<=this.maxY},n.prototype.equals=function(r){return this.minX==r.minX&&this.minY==r.minY&&this.maxX==r.maxX&&this.maxY==r.maxY},n.prototype.extend=function(r){r.minX<this.minX&&(this.minX=r.minX),r.maxX>this.maxX&&(this.maxX=r.maxX),r.minY<this.minY&&(this.minY=r.minY),r.maxY>this.maxY&&(this.maxY=r.maxY)},n.prototype.getHeight=function(){return this.maxY-this.minY+1},n.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},n.prototype.getWidth=function(){return this.maxX-this.minX+1},n.prototype.intersects=function(r){return this.minX<=r.maxX&&this.maxX>=r.minX&&this.minY<=r.maxY&&this.maxY>=r.minY},n}();function He(n,r,t,e,i){return void 0!==i?(i.minX=n,i.maxX=r,i.minY=t,i.maxY=e,i):new Ga(n,r,t,e)}const Si=Ga;var Bh=[0,0,0],jh=function(){function n(r){var t;if(this.minZoom=void 0!==r.minZoom?r.minZoom:0,this.resolutions_=r.resolutions,W(function g(n,r,t){var e=r||jt;return n.every(function(i,o){if(0===o)return!0;var a=e(n[o-1],i);return!(a>0||t&&0===a)})}(this.resolutions_,function(a,s){return s-a},!0),17),!r.origins)for(var e=0,i=this.resolutions_.length-1;e<i;++e)if(t){if(this.resolutions_[e]/this.resolutions_[e+1]!==t){t=void 0;break}}else t=this.resolutions_[e]/this.resolutions_[e+1];this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==r.origin?r.origin:null,this.origins_=null,void 0!==r.origins&&(this.origins_=r.origins,W(this.origins_.length==this.resolutions_.length,20));var o=r.extent;void 0!==o&&!this.origin_&&!this.origins_&&(this.origin_=Se(o)),W(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==r.tileSizes&&(this.tileSizes_=r.tileSizes,W(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==r.tileSize?r.tileSize:this.tileSizes_?null:256,W(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==o?o:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==r.sizes?this.fullTileRanges_=r.sizes.map(function(a,s){var u=new Si(Math.min(0,a[0]),Math.max(a[0]-1,-1),Math.min(0,a[1]),Math.max(a[1]-1,-1));if(o){var l=this.getTileRangeForExtentAndZ(o,s);u.minX=Math.max(l.minX,u.minX),u.maxX=Math.min(l.maxX,u.maxX),u.minY=Math.max(l.minY,u.minY),u.maxY=Math.min(l.maxY,u.maxY)}return u},this):o&&this.calculateTileRanges_(o)}return n.prototype.forEachTileCoord=function(r,t,e){for(var i=this.getTileRangeForExtentAndZ(r,t),o=i.minX,a=i.maxX;o<=a;++o)for(var s=i.minY,u=i.maxY;s<=u;++s)e([t,o,s])},n.prototype.forEachTileCoordParentTileRange=function(r,t,e,i){var a,s,u=null,l=r[0]-1;for(2===this.zoomFactor_?(a=r[1],s=r[2]):u=this.getTileCoordExtent(r,i);l>=this.minZoom;){if(t(l,2===this.zoomFactor_?He(a=Math.floor(a/2),a,s=Math.floor(s/2),s,e):this.getTileRangeForExtentAndZ(u,l,e)))return!0;--l}return!1},n.prototype.getExtent=function(){return this.extent_},n.prototype.getMaxZoom=function(){return this.maxZoom},n.prototype.getMinZoom=function(){return this.minZoom},n.prototype.getOrigin=function(r){return this.origin_?this.origin_:this.origins_[r]},n.prototype.getResolution=function(r){return this.resolutions_[r]},n.prototype.getResolutions=function(){return this.resolutions_},n.prototype.getTileCoordChildTileRange=function(r,t,e){if(r[0]<this.maxZoom){if(2===this.zoomFactor_){var i=2*r[1],o=2*r[2];return He(i,i+1,o,o+1,t)}var a=this.getTileCoordExtent(r,e||this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,r[0]+1,t)}return null},n.prototype.getTileRangeForTileCoordAndZ=function(r,t,e){if(t>this.maxZoom||t<this.minZoom)return null;var i=r[0],o=r[1],a=r[2];if(t===i)return He(o,a,o,a,e);if(this.zoomFactor_){var s=Math.pow(this.zoomFactor_,t-i),u=Math.floor(o*s),l=Math.floor(a*s);return t<i?He(u,u,l,l,e):He(u,Math.floor(s*(o+1))-1,l,Math.floor(s*(a+1))-1,e)}var f=this.getTileCoordExtent(r,this.tmpExtent_);return this.getTileRangeForExtentAndZ(f,t,e)},n.prototype.getTileRangeExtent=function(r,t,e){var i=this.getOrigin(r),o=this.getResolution(r),a=Ot(this.getTileSize(r),this.tmpSize_);return fe(i[0]+t.minX*a[0]*o,i[1]+t.minY*a[1]*o,i[0]+(t.maxX+1)*a[0]*o,i[1]+(t.maxY+1)*a[1]*o,e)},n.prototype.getTileRangeForExtentAndZ=function(r,t,e){var i=Bh;this.getTileCoordForXYAndZ_(r[0],r[3],t,!1,i);var o=i[1],a=i[2];return this.getTileCoordForXYAndZ_(r[2],r[1],t,!0,i),He(o,i[1],a,i[2],e)},n.prototype.getTileCoordCenter=function(r){var t=this.getOrigin(r[0]),e=this.getResolution(r[0]),i=Ot(this.getTileSize(r[0]),this.tmpSize_);return[t[0]+(r[1]+.5)*i[0]*e,t[1]-(r[2]+.5)*i[1]*e]},n.prototype.getTileCoordExtent=function(r,t){var e=this.getOrigin(r[0]),i=this.getResolution(r[0]),o=Ot(this.getTileSize(r[0]),this.tmpSize_),a=e[0]+r[1]*o[0]*i,s=e[1]-(r[2]+1)*o[1]*i;return fe(a,s,a+o[0]*i,s+o[1]*i,t)},n.prototype.getTileCoordForCoordAndResolution=function(r,t,e){return this.getTileCoordForXYAndResolution_(r[0],r[1],t,!1,e)},n.prototype.getTileCoordForXYAndResolution_=function(r,t,e,i,o){var a=this.getZForResolution(e),s=e/this.getResolution(a),u=this.getOrigin(a),l=Ot(this.getTileSize(a),this.tmpSize_),c=s*(r-u[0])/e/l[0],h=s*(u[1]-t)/e/l[1];return i?(c=Br(c,5)-1,h=Br(h,5)-1):(c=Xr(c,5),h=Xr(h,5)),pn(a,c,h,o)},n.prototype.getTileCoordForXYAndZ_=function(r,t,e,i,o){var a=this.getOrigin(e),s=this.getResolution(e),u=Ot(this.getTileSize(e),this.tmpSize_),l=(r-a[0])/s/u[0],c=(a[1]-t)/s/u[1];return i?(l=Br(l,5)-1,c=Br(c,5)-1):(l=Xr(l,5),c=Xr(c,5)),pn(e,l,c,o)},n.prototype.getTileCoordForCoordAndZ=function(r,t,e){return this.getTileCoordForXYAndZ_(r[0],r[1],t,!1,e)},n.prototype.getTileCoordResolution=function(r){return this.resolutions_[r[0]]},n.prototype.getTileSize=function(r){return this.tileSize_?this.tileSize_:this.tileSizes_[r]},n.prototype.getFullTileRange=function(r){return this.fullTileRanges_?this.fullTileRanges_[r]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,r):null},n.prototype.getZForResolution=function(r,t){return ht(or(this.resolutions_,r,t||0),this.minZoom,this.maxZoom)},n.prototype.tileCoordIntersectsViewport=function(r,t){return la(t,0,t.length,2,this.getTileCoordExtent(r))},n.prototype.calculateTileRanges_=function(r){for(var t=this.resolutions_.length,e=new Array(t),i=this.minZoom;i<t;++i)e[i]=this.getTileRangeForExtentAndZ(r,i);this.fullTileRanges_=e},n}();const Ua=jh;function Xa(n){var r=n.getDefaultTileGrid();return r||(r=function kh(n,r,t,e){return function Wh(n,r,t,e){var i=void 0!==e?e:"top-left",o=Ba(n,r,t);return new Ua({extent:n,origin:Xs(n,i),resolutions:o,tileSize:t})}(Oi(n),r,t,e)}(n),n.setDefaultTileGrid(r)),r}function Ba(n,r,t,e){for(var i=void 0!==r?r:42,o=Pt(n),a=et(n),s=Ot(void 0!==t?t:256),u=e>0?e:Math.max(a/s[0],o/s[1]),l=i+1,c=new Array(l),h=0;h<l;++h)c[h]=u/Math.pow(2,h);return c}function Oi(n){var r=(n=_t(n)).getExtent();if(!r){var t=180*Jt[_e.DEGREES]/n.getMetersPerUnit();r=fe(-t,-t,t,t)}return r}var ja=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Vh=function(n){function r(t){var e=n.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate})||this;return e.opaque_=void 0!==t.opaque&&t.opaque,e.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,e.tileGrid=void 0!==t.tileGrid?t.tileGrid:null,e.tileGrid&&Ot(e.tileGrid.getTileSize(e.tileGrid.getMinZoom()),[256,256]),e.tileCache=new Da(t.cacheSize||0),e.tmpSize=[0,0],e.key_=t.key||"",e.tileOptions={transition:t.transition,interpolate:t.interpolate},e.zDirection=t.zDirection?t.zDirection:0,e}return ja(r,n),r.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},r.prototype.expireCache=function(t,e){var i=this.getTileCacheForProjection(t);i&&i.expireCache(e)},r.prototype.forEachLoadedTile=function(t,e,i,o){var a=this.getTileCacheForProjection(t);if(!a)return!1;for(var u,l,c,s=!0,h=i.minX;h<=i.maxX;++h)for(var f=i.minY;f<=i.maxY;++f)l=mr(e,h,f),c=!1,a.containsKey(l)&&(c=2===(u=a.get(l)).getState())&&(c=!1!==o(u)),c||(s=!1);return s},r.prototype.getGutterForProjection=function(t){return 0},r.prototype.getKey=function(){return this.key_},r.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},r.prototype.getOpaque=function(t){return this.opaque_},r.prototype.getResolutions=function(){return this.tileGrid?this.tileGrid.getResolutions():null},r.prototype.getTile=function(t,e,i,o,a){return A()},r.prototype.getTileGrid=function(){return this.tileGrid},r.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:Xa(t)},r.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();return W(null===e||Ke(e,t),68),this.tileCache},r.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},r.prototype.getTilePixelSize=function(t,e,i){var o=this.getTileGridForProjection(i),a=this.getTilePixelRatio(e),s=Ot(o.getTileSize(t),this.tmpSize);return 1==a?s:function Ql(n,r,t){return void 0===t&&(t=[0,0]),t[0]=n[0]*r+.5|0,t[1]=n[1]*r+.5|0,t}(s,a,this.tmpSize)},r.prototype.getTileCoordForTileUrlFunction=function(t,e){var i=void 0!==e?e:this.getProjection(),o=this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(t=function zh(n,r,t){var e=r[0],i=n.getTileCoordCenter(r),o=Oi(t);if(Ae(o,i))return r;var a=et(o),s=Math.ceil((o[0]-i[0])/a);return i[0]+=a*s,n.getTileCoordForCoordAndZ(i,e)}(o,t,i)),function Nh(n,r){var t=n[0],e=n[1],i=n[2];if(r.getMinZoom()>t||t>r.getMaxZoom())return!1;var o=r.getFullTileRange(t);return!o||o.containsXY(e,i)}(t,o)?t:null},r.prototype.clear=function(){this.tileCache.clear()},r.prototype.refresh=function(){this.clear(),n.prototype.refresh.call(this)},r.prototype.updateCacheSize=function(t,e){var i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)},r.prototype.useTile=function(t,e,i,o){},r}(ba),Kh=function(n){function r(t,e){var i=n.call(this,t)||this;return i.tile=e,i}return ja(r,n),r}(ne);const Zh=Vh;function Hh(n,r){var t=/\{z\}/g,e=/\{x\}/g,i=/\{y\}/g,o=/\{-y\}/g;return function(a,s,u){if(a)return n.replace(t,a[0].toString()).replace(e,a[1].toString()).replace(i,a[2].toString()).replace(o,function(){var c=r.getFullTileRange(a[0]);return W(c,55),(c.getHeight()-a[2]-1).toString()})}}var $h=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),tf=function(n){function r(t){var e=n.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this;return e.generateTileUrlFunction_=e.tileUrlFunction===r.prototype.tileUrlFunction,e.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(e.tileUrlFunction=t.tileUrlFunction),e.urls=null,t.urls?e.setUrls(t.urls):t.url&&e.setUrl(t.url),e.tileLoadingKeys_={},e}return $h(r,n),r.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},r.prototype.getTileUrlFunction=function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction},r.prototype.getUrls=function(){return this.urls},r.prototype.handleTileChange=function(t){var a,e=t.target,i=P(e),o=e.getState();1==o?(this.tileLoadingKeys_[i]=!0,a="tileloadstart"):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],a=3==o?"tileloaderror":2==o?"tileloadend":void 0),null!=a&&this.dispatchEvent(new Kh(a,e))},r.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},r.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()},r.prototype.setUrl=function(t){var e=function Qh(n){var r=[],t=/\{([a-z])-([a-z])\}/.exec(n);if(t){var e=t[1].charCodeAt(0),i=t[2].charCodeAt(0),o=void 0;for(o=e;o<=i;++o)r.push(n.replace(t[0],String.fromCharCode(o)));return r}if(t=/\{(\d+)-(\d+)\}/.exec(n)){for(var a=parseInt(t[2],10),s=parseInt(t[1],10);s<=a;s++)r.push(n.replace(t[0],s.toString()));return r}return r.push(n),r}(t);this.urls=e,this.setUrls(e)},r.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function qh(n,r){for(var t=n.length,e=new Array(t),i=0;i<t;++i)e[i]=Hh(n[i],r);return function Jh(n){return 1===n.length?n[0]:function(r,t,e){if(r){var i=function Dh(n){return(n[1]<<n[0])+n[2]}(r),o=Xe(i,n.length);return n[o](r,t,e)}}}(e)}(t,this.tileGrid),e):this.setKey(e)},r.prototype.tileUrlFunction=function(t,e,i){},r.prototype.useTile=function(t,e,i){var o=mr(t,e,i);this.tileCache.containsKey(o)&&this.tileCache.get(o)},r}(Zh);const ef=tf;var rf=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),nf=function(n){function r(t){var e=this,i=void 0===t.imageSmoothing||t.imageSmoothing;return void 0!==t.interpolate&&(i=t.interpolate),(e=n.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:of,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:i,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this).crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,e.tileClass=void 0!==t.tileClass?t.tileClass:dn,e.tileCacheForProjection={},e.tileGridForProjection={},e.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,e.renderReprojectionEdges_=!1,e}return rf(r,n),r.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},r.prototype.expireCache=function(t,e){var i=this.getTileCacheForProjection(t);for(var o in this.tileCache.expireCache(this.tileCache==i?e:{}),this.tileCacheForProjection){var a=this.tileCacheForProjection[o];a.expireCache(a==i?e:{})}},r.prototype.getGutterForProjection=function(t){return this.getProjection()&&t&&!Ke(this.getProjection(),t)?0:this.getGutter()},r.prototype.getGutter=function(){return 0},r.prototype.getKey=function(){var t=n.prototype.getKey.call(this);return this.getInterpolate()||(t+=":disable-interpolation"),t},r.prototype.getOpaque=function(t){return!(this.getProjection()&&t&&!Ke(this.getProjection(),t))&&n.prototype.getOpaque.call(this,t)},r.prototype.getTileGridForProjection=function(t){var e=this.getProjection();if(this.tileGrid&&(!e||Ke(e,t)))return this.tileGrid;var i=P(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Xa(t)),this.tileGridForProjection[i]},r.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();if(!e||Ke(e,t))return this.tileCache;var i=P(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Da(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]},r.prototype.createTile_=function(t,e,i,o,a,s){var u=[t,e,i],l=this.getTileCoordForTileUrlFunction(u,a),c=l?this.tileUrlFunction(l,o,a):void 0,h=new this.tileClass(u,void 0!==c?0:4,void 0!==c?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=s,h.addEventListener("change",this.handleTileChange.bind(this)),h},r.prototype.getTile=function(t,e,i,o,a){var s=this.getProjection();if(!s||!a||Ke(s,a))return this.getTileInternal(t,e,i,o,s||a);var u=this.getTileCacheForProjection(a),l=[t,e,i],c=void 0,h=Er(l);u.containsKey(h)&&(c=u.get(h));var f=this.getKey();if(c&&c.key==f)return c;var d=this.getTileGridForProjection(s),p=this.getTileGridForProjection(a),v=this.getTileCoordForTileUrlFunction(l,a),y=new wi(s,d,a,p,l,v,this.getTilePixelRatio(o),this.getGutter(),function(R,T,m,E){return this.getTileInternal(R,T,m,E,s)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return y.key=f,c?(y.interimTile=c,y.refreshInterimChain(),u.replace(h,y)):u.set(h,y),y},r.prototype.getTileInternal=function(t,e,i,o,a){var s=null,u=mr(t,e,i),l=this.getKey();if(this.tileCache.containsKey(u)){if((s=this.tileCache.get(u)).key!=l){var c=s;(s=this.createTile_(t,e,i,o,a,l)).interimTile=0==c.getState()?c.interimTile:c,s.refreshInterimChain(),this.tileCache.replace(u,s)}}else s=this.createTile_(t,e,i,o,a,l),this.tileCache.set(u,s);return s},r.prototype.setRenderReprojectionEdges=function(t){if(this.renderReprojectionEdges_!=t){for(var e in this.renderReprojectionEdges_=t,this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}},r.prototype.setTileGridForProjection=function(t,e){var i=_t(t);if(i){var o=P(i);o in this.tileGridForProjection||(this.tileGridForProjection[o]=e)}},r}(ef);function of(n,r){n.getImage().src=r}const af=nf;var sf=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),uf=function(n){function r(t){var e=this,i=t||{},o=void 0===i.imageSmoothing||i.imageSmoothing;void 0!==i.interpolate&&(o=i.interpolate);var a=void 0!==i.projection?i.projection:"EPSG:3857",s=void 0!==i.tileGrid?i.tileGrid:function Yh(n){var r=n||{},t=r.extent||_t("EPSG:3857").getExtent(),e={extent:t,minZoom:r.minZoom,tileSize:r.tileSize,resolutions:Ba(t,r.maxZoom,r.tileSize,r.maxResolution)};return new Ua(e)}({extent:Oi(a),maxResolution:i.maxResolution,maxZoom:i.maxZoom,minZoom:i.minZoom,tileSize:i.tileSize});return(e=n.call(this,{attributions:i.attributions,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,interpolate:o,opaque:i.opaque,projection:a,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileGrid:s,tileLoadFunction:i.tileLoadFunction,tilePixelRatio:i.tilePixelRatio,tileUrlFunction:i.tileUrlFunction,url:i.url,urls:i.urls,wrapX:void 0===i.wrapX||i.wrapX,transition:i.transition,attributionsCollapsible:i.attributionsCollapsible,zDirection:i.zDirection})||this).gutter_=void 0!==i.gutter?i.gutter:0,e}return sf(r,n),r.prototype.getGutter=function(){return this.gutter_},r}(af);const lf=uf;var cf=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),ff=function(n){function r(t){var e=t||{},i=void 0===e.imageSmoothing||e.imageSmoothing;return void 0!==e.interpolate&&(i=e.interpolate),n.call(this,{attributions:void 0!==e.attributions?e.attributions:['&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.'],attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:void 0!==e.crossOrigin?e.crossOrigin:"anonymous",interpolate:i,maxZoom:void 0!==e.maxZoom?e.maxZoom:19,opaque:void 0===e.opaque||e.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:void 0!==e.url?e.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",wrapX:e.wrapX,zDirection:e.zDirection})||this}return cf(r,n),r}(lf);const df=ff;var pf=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),vf=function(n){function r(t){var e=this,i=t||{},o=ot({},i);return delete o.preload,delete o.useInterimTilesOnError,(e=n.call(this,o)||this).setPreload(void 0!==i.preload?i.preload:0),e.setUseInterimTilesOnError(void 0===i.useInterimTilesOnError||i.useInterimTilesOnError),e}return pf(r,n),r.prototype.getPreload=function(){return this.get("preload")},r.prototype.setPreload=function(t){this.set("preload",t)},r.prototype.getUseInterimTilesOnError=function(){return this.get("useInterimTilesOnError")},r.prototype.setUseInterimTilesOnError=function(t){this.set("useInterimTilesOnError",t)},r.prototype.getData=function(t){return n.prototype.getData.call(this,t)},r}(lr);const _f=vf;var gf=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),yf=function(n){function r(t){var e=n.call(this)||this;return e.ready=!0,e.boundHandleImageChange_=e.handleImageChange_.bind(e),e.layer_=t,e.declutterExecutorGroup=null,e}return gf(r,n),r.prototype.getFeatures=function(t){return A()},r.prototype.getData=function(t){return null},r.prototype.prepareFrame=function(t){return A()},r.prototype.renderFrame=function(t,e){return A()},r.prototype.loadedTileCallback=function(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i},r.prototype.createLoadedTileFinder=function(t,e,i){return function(o,a){var s=this.loadedTileCallback.bind(this,i,o);return t.forEachLoadedTile(e,o,a,s)}.bind(this)},r.prototype.forEachFeatureAtCoordinate=function(t,e,i,o,a){},r.prototype.getDataAtPixel=function(t,e,i){return null},r.prototype.getLayer=function(){return this.layer_},r.prototype.handleFontsChanged=function(){},r.prototype.handleImageChange_=function(t){2===t.target.getState()&&this.renderIfReadyAndVisible()},r.prototype.loadImage=function(t){var e=t.getState();return 2!=e&&3!=e&&t.addEventListener("change",this.boundHandleImageChange_),0==e&&(t.load(),e=t.getState()),2==e},r.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t&&t.getVisible()&&"ready"===t.getSourceState()&&t.changed()},r.prototype.disposeInternal=function(){delete this.layer_,n.prototype.disposeInternal.call(this)},r}(po);const za=yf;var mf=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),qe=null,Tf=function(n){function r(t){var e=n.call(this,t)||this;return e.container=null,e.tempTransform=[1,0,0,1,0,0],e.pixelTransform=[1,0,0,1,0,0],e.inversePixelTransform=[1,0,0,1,0,0],e.context=null,e.containerReused=!1,e.pixelContext_=null,e.frameState=null,e}return mf(r,n),r.prototype.getImageData=function(t,e,i){var o;qe||function Ef(){var n=document.createElement("canvas");n.width=1,n.height=1,qe=n.getContext("2d")}(),qe.clearRect(0,0,1,1);try{qe.drawImage(t,e,i,1,1,0,0,1,1),o=qe.getImageData(0,0,1,1).data}catch{return qe=null,null}return o},r.prototype.getBackground=function(t){var i=this.getLayer().getBackground();return"function"==typeof i&&(i=i(t.viewState.resolution)),i||void 0},r.prototype.useContainer=function(t,e,i){var a,s,o=this.getLayer().getClassName();if(t&&t.className===o&&(!i||t&&t.style.backgroundColor&&Dt(jr(t.style.backgroundColor),jr(i)))&&(u=t.firstElementChild)instanceof HTMLCanvasElement&&(s=u.getContext("2d")),s&&s.canvas.style.transform===e?(this.container=t,this.context=s,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(a=document.createElement("div")).className=o;var u,l=a.style;l.position="absolute",l.width="100%",l.height="100%",s=Oe(),a.appendChild(u=s.canvas),(l=u.style).position="absolute",l.left="0",l.transformOrigin="top left",this.container=a,this.context=s}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)},r.prototype.clipUnrotated=function(t,e,i){var o=Se(i),a=br(i),s=Nr(i),u=Dr(i);ut(e.coordinateToPixelTransform,o),ut(e.coordinateToPixelTransform,a),ut(e.coordinateToPixelTransform,s),ut(e.coordinateToPixelTransform,u);var l=this.inversePixelTransform;ut(l,o),ut(l,a),ut(l,s),ut(l,u),t.save(),t.beginPath(),t.moveTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(u[0]),Math.round(u[1])),t.clip()},r.prototype.dispatchRenderEvent_=function(t,e,i){var o=this.getLayer();if(o.hasListener(t)){var a=new cr(t,this.inversePixelTransform,i,e);o.dispatchEvent(a)}},r.prototype.preRender=function(t,e){this.frameState=e,this.dispatchRenderEvent_("prerender",t,e)},r.prototype.postRender=function(t,e){this.dispatchRenderEvent_("postrender",t,e)},r.prototype.getRenderTransform=function(t,e,i,o,a,s,u){var h=o/e;return Zt(this.tempTransform,a/2,s/2,h,-h,-i,-t[0]+u,-t[1])},r.prototype.getDataAtPixel=function(t,e,i){var o=ut(this.inversePixelTransform,t.slice()),a=this.context,u=this.getLayer().getExtent();if(u&&!Ae(u,ut(e.pixelToCoordinateTransform,t.slice())))return null;var p,c=Math.round(o[0]),h=Math.round(o[1]),f=this.pixelContext_;if(!f){var d=document.createElement("canvas");d.width=1,d.height=1,f=d.getContext("2d"),this.pixelContext_=f}f.clearRect(0,0,1,1);try{f.drawImage(a.canvas,c,h,1,1,0,0,1,1),p=f.getImageData(0,0,1,1).data}catch(v){return"SecurityError"===v.name?(this.pixelContext_=null,new Uint8Array):p}return 0===p[3]?null:p},r.prototype.disposeInternal=function(){delete this.frameState,n.prototype.disposeInternal.call(this)},r}(za);const Rf=Tf;var xf=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Cf=function(n){function r(t){var e=n.call(this,t)||this;return e.extentChanged=!0,e.renderedExtent_=null,e.renderedProjection=null,e.renderedTiles=[],e.newTiles_=!1,e.tmpExtent=[1/0,1/0,-1/0,-1/0],e.tmpTileRange_=new Si(0,0,0,0),e}return xf(r,n),r.prototype.isDrawableTile=function(t){var e=this.getLayer(),i=t.getState(),o=e.getUseInterimTilesOnError();return 2==i||4==i||3==i&&!o},r.prototype.getTile=function(t,e,i,o){var a=o.pixelRatio,s=o.viewState.projection,u=this.getLayer(),c=u.getSource().getTile(t,e,i,a,s);return 3==c.getState()&&(u.getUseInterimTilesOnError()?u.getPreload()>0&&(this.newTiles_=!0):c.setState(2)),this.isDrawableTile(c)||(c=c.getInterimTile()),c},r.prototype.getData=function(t){var e=this.frameState;if(!e)return null;var i=this.getLayer(),o=ut(e.pixelToCoordinateTransform,t.slice()),a=i.getExtent();if(a&&!Ae(a,o))return null;for(var s=e.pixelRatio,u=e.viewState.projection,l=e.viewState,c=i.getRenderSource(),h=c.getTileGridForProjection(l.projection),f=c.getTilePixelRatio(e.pixelRatio),d=h.getZForResolution(l.resolution);d>=h.getMinZoom();--d){var p=h.getTileCoordForCoordAndZ(o,d),v=c.getTile(d,p[1],p[2],s,u);if(!(v instanceof dn||v instanceof wi))return null;if(2===v.getState()){var y=h.getOrigin(d),R=Ot(h.getTileSize(d)),T=h.getResolution(d),m=Math.floor(f*((o[0]-y[0])/T-p[1]*R[0])),E=Math.floor(f*((y[1]-o[1])/T-p[2]*R[1])),w=Math.round(f*c.getGutterForProjection(l.projection));return this.getImageData(v.getImage(),m+w,E+w)}}return null},r.prototype.loadedTileCallback=function(t,e,i){return!!this.isDrawableTile(i)&&n.prototype.loadedTileCallback.call(this,t,e,i)},r.prototype.prepareFrame=function(t){return!!this.getLayer().getSource()},r.prototype.renderFrame=function(t,e){var i=t.layerStatesArray[t.layerIndex],o=t.viewState,a=o.projection,s=o.resolution,u=o.center,l=o.rotation,c=t.pixelRatio,h=this.getLayer(),f=h.getSource(),d=f.getRevision(),p=f.getTileGridForProjection(a),v=p.getZForResolution(s,f.zDirection),y=p.getResolution(v),R=t.extent,T=t.viewState.resolution,m=f.getTilePixelRatio(c),E=Math.round(et(R)/T*c),w=Math.round(Pt(R)/T*c),I=i.extent&&ge(i.extent);I&&(R=re(R,ge(i.extent)));var C=y*E/2/m,N=y*w/2/m,X=[u[0]-C,u[1]-N,u[0]+C,u[1]+N],B=p.getTileRangeForExtentAndZ(R,v),k={};k[v]={};var lt=this.createLoadedTileFinder(f,a,k),Tt=this.tmpExtent,Rt=this.tmpTileRange_;this.newTiles_=!1;for(var rt=l?Un(o.center,T,l,t.size):void 0,Z=B.minX;Z<=B.maxX;++Z)for(var J=B.minY;J<=B.maxY;++J)if(!l||p.tileCoordIntersectsViewport([v,Z,J],rt)){var H=this.getTile(v,Z,J,t);if(this.isDrawableTile(H)){var It=P(this);if(2==H.getState()&&(k[v][H.tileCoord.toString()]=H,(ct=H.inTransition(It))&&1!==i.opacity&&(H.endTransition(It),ct=!1),!this.newTiles_&&(ct||-1===this.renderedTiles.indexOf(H))&&(this.newTiles_=!0)),1===H.getAlpha(It,t.time))continue}var xt=p.getTileCoordChildTileRange(H.tileCoord,Rt,Tt),kt=!1;xt&&(kt=lt(v+1,xt)),kt||p.forEachTileCoordParentTileRange(H.tileCoord,lt,Rt,Tt)}var Gt=y/s*c/m;Zt(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/c,1/c,l,-E/2,-w/2);var Mt=function Hi(n){var r="matrix("+n.join(", ")+")";if(ce)return r;var t=Zi||(Zi=document.createElement("div"));return t.style.transform=r,t.style.transform}(this.pixelTransform);this.useContainer(e,Mt,this.getBackground(t));var K=this.context,Vt=K.canvas;Mr(this.inversePixelTransform,this.pixelTransform),Zt(this.tempTransform,E/2,w/2,Gt,Gt,0,-E/2,-w/2),Vt.width!=E||Vt.height!=w?(Vt.width=E,Vt.height=w):this.containerReused||K.clearRect(0,0,E,w),I&&this.clipUnrotated(K,t,I),f.getInterpolate()||ot(K,Ri),this.preRender(K,t),this.renderedTiles.length=0;var pt,xr,Ft,te=Object.keys(k).map(Number);te.sort(jt),1!==i.opacity||this.containerReused&&!f.getOpaque(t.viewState.projection)?(pt=[],xr=[]):te=te.reverse();for(var er=te.length-1;er>=0;--er){var Kt=te[er],Ut=f.getTilePixelSize(Kt,c,a),Cn=p.getResolution(Kt)/y,rr=Ut[0]*Cn*Gt,Cr=Ut[1]*Cn*Gt,wr=p.getTileCoordForCoordAndZ(Se(X),Kt),Me=p.getTileCoordExtent(wr),nr=ut(this.tempTransform,[m*(Me[0]-X[0])/y,m*(X[3]-Me[3])/y]),wn=m*f.getGutterForProjection(a),An=k[Kt];for(var Cs in An){var ct,Sn=(H=An[Cs]).tileCoord,ws=wr[1]-Sn[1],xp=Math.round(nr[0]-(ws-1)*rr),As=wr[2]-Sn[2],Cp=Math.round(nr[1]-(As-1)*Cr),Ar=xp-(Z=Math.round(nr[0]-ws*rr)),Sr=Cp-(J=Math.round(nr[1]-As*Cr)),Ss=v===Kt,Wi=!1;if(!(ct=Ss&&1!==H.getAlpha(P(this),t.time)))if(pt){Ft=[Z,J,Z+Ar,J,Z+Ar,J+Sr,Z,J+Sr];for(var On=0,wp=pt.length;On<wp;++On)if(v!==Kt&&Kt<xr[On]){var Xt=pt[On];Ht([Z,J,Z+Ar,J+Sr],[Xt[0],Xt[3],Xt[4],Xt[7]])&&(Wi||(K.save(),Wi=!0),K.beginPath(),K.moveTo(Ft[0],Ft[1]),K.lineTo(Ft[2],Ft[3]),K.lineTo(Ft[4],Ft[5]),K.lineTo(Ft[6],Ft[7]),K.moveTo(Xt[6],Xt[7]),K.lineTo(Xt[4],Xt[5]),K.lineTo(Xt[2],Xt[3]),K.lineTo(Xt[0],Xt[1]),K.clip())}pt.push(Ft),xr.push(Kt)}else K.clearRect(Z,J,Ar,Sr);this.drawTileImage(H,t,Z,J,Ar,Sr,wn,Ss),pt&&!ct?(Wi&&K.restore(),this.renderedTiles.unshift(H)):this.renderedTiles.push(H),this.updateUsedTiles(t.usedTiles,f,H)}}return this.renderedRevision=d,this.renderedResolution=y,this.extentChanged=!this.renderedExtent_||!be(this.renderedExtent_,X),this.renderedExtent_=X,this.renderedPixelRatio=c,this.renderedProjection=a,this.manageTilePyramid(t,f,p,c,a,R,v,h.getPreload()),this.scheduleExpireCache(t,f),this.postRender(K,t),i.extent&&K.restore(),ot(K,Ah),Mt!==Vt.style.transform&&(Vt.style.transform=Mt),this.container},r.prototype.drawTileImage=function(t,e,i,o,a,s,u,l){var c=this.getTileImage(t);if(c){var h=P(this),f=e.layerStatesArray[e.layerIndex],d=f.opacity*(l?t.getAlpha(h,e.time):1),p=d!==this.context.globalAlpha;p&&(this.context.save(),this.context.globalAlpha=d),this.context.drawImage(c,u,u,c.width-2*u,c.height-2*u,i,o,a,s),p&&this.context.restore(),d!==f.opacity?e.animate=!0:l&&t.endTransition(h)}},r.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},r.prototype.getTileImage=function(t){return t.getImage()},r.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var i=function(o,a,s){var u=P(o);u in s.usedTiles&&o.expireCache(s.viewState.projection,s.usedTiles[u])}.bind(null,e);t.postRenderFunctions.push(i)}},r.prototype.updateUsedTiles=function(t,e,i){var o=P(e);o in t||(t[o]={}),t[o][i.getKey()]=!0},r.prototype.manageTilePyramid=function(t,e,i,o,a,s,u,l,c){var h=P(e);h in t.wantedTiles||(t.wantedTiles[h]={});var T,m,E,w,I,C,f=t.wantedTiles[h],d=t.tileQueue,p=i.getMinZoom(),v=t.viewState.rotation,y=v?Un(t.viewState.center,t.viewState.resolution,v,t.size):void 0,R=0;for(C=p;C<=u;++C)for(m=i.getTileRangeForExtentAndZ(s,C,m),E=i.getResolution(C),w=m.minX;w<=m.maxX;++w)for(I=m.minY;I<=m.maxY;++I)v&&!i.tileCoordIntersectsViewport([C,w,I],y)||(u-C<=l?(++R,0==(T=e.getTile(C,w,I,o,a)).getState()&&(f[T.getKey()]=!0,d.isKeyQueued(T.getKey())||d.enqueue([T,h,i.getTileCoordCenter(T.tileCoord),E])),void 0!==c&&c(T)):e.useTile(C,w,I,a));e.updateCacheSize(R,a)},r}(Rf);const wf=Cf;var Af=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Sf=function(n){function r(t){return n.call(this,t)||this}return Af(r,n),r.prototype.createRenderer=function(){return new wf(this)},r}(_f);const Of=Sf;var Wa=it(6465),Pf=function(){function n(r){this.rbush_=new Wa(r),this.items_={}}return n.prototype.insert=function(r,t){var e={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],value:t};this.rbush_.insert(e),this.items_[P(t)]=e},n.prototype.load=function(r,t){for(var e=new Array(t.length),i=0,o=t.length;i<o;i++){var a=r[i],s=t[i],u={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:s};e[i]=u,this.items_[P(s)]=u}this.rbush_.load(e)},n.prototype.remove=function(r){var t=P(r),e=this.items_[t];return delete this.items_[t],null!==this.rbush_.remove(e)},n.prototype.update=function(r,t){var e=this.items_[P(t)];be([e.minX,e.minY,e.maxX,e.maxY],r)||(this.remove(t),this.insert(r,t))},n.prototype.getAll=function(){return this.rbush_.all().map(function(t){return t.value})},n.prototype.getInExtent=function(r){return this.rbush_.search({minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}).map(function(i){return i.value})},n.prototype.forEach=function(r){return this.forEach_(this.getAll(),r)},n.prototype.forEachInExtent=function(r,t){return this.forEach_(this.getInExtent(r),t)},n.prototype.forEach_=function(r,t){for(var e,i=0,o=r.length;i<o;i++)if(e=t(r[i]))return e;return e},n.prototype.isEmpty=function(){return zr(this.items_)},n.prototype.clear=function(){this.rbush_.clear(),this.items_={}},n.prototype.getExtent=function(r){var t=this.rbush_.toJSON();return fe(t.minX,t.minY,t.maxX,t.maxY,r)},n.prototype.concat=function(r){for(var t in this.rbush_.load(r.rbush_.all()),r.items_)this.items_[t]=r.items_[t]},n}();const Ya=Pf;function Lf(n,r){return[[-1/0,-1/0,1/0,1/0]]}function Va(n,r){return function(t,e,i,o,a){var s=this;!function If(n,r,t,e,i,o,a){var s=new XMLHttpRequest;s.open("GET","function"==typeof n?n(t,e,i):n,!0),"arraybuffer"==r.getType()&&(s.responseType="arraybuffer"),s.withCredentials=false,s.onload=function(u){if(!s.status||s.status>=200&&s.status<300){var l=r.getType(),c=void 0;"json"==l||"text"==l?c=s.responseText:"xml"==l?(c=s.responseXML)||(c=(new DOMParser).parseFromString(s.responseText,"application/xml")):"arraybuffer"==l&&(c=s.response),c?o(r.readFeatures(c,{extent:t,featureProjection:i}),r.readProjection(c)):a()}else a()},s.onerror=a,s.send()}(n,r,t,e,i,function(u,l){s.addFeatures(u),void 0!==o&&o(u)},a||O)}}var Ka=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Te=function(n){function r(t,e,i){var o=n.call(this,t)||this;return o.feature=e,o.features=i,o}return Ka(r,n),r}(ne),Mf=function(n){function r(t){var e=this,i=t||{};(e=n.call(this,{attributions:i.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===i.wrapX||i.wrapX})||this).loader_=O,e.format_=i.format,e.overlaps_=void 0===i.overlaps||i.overlaps,e.url_=i.url,void 0!==i.loader?e.loader_=i.loader:void 0!==e.url_&&(W(e.format_,7),e.loader_=Va(e.url_,e.format_)),e.strategy_=void 0!==i.strategy?i.strategy:Lf;var a,s,o=void 0===i.useSpatialIndex||i.useSpatialIndex;return e.featuresRtree_=o?new Ya:null,e.loadedExtentsRtree_=new Ya,e.loadingExtentsCount_=0,e.nullGeometryFeatures_={},e.idIndex_={},e.uidIndex_={},e.featureChangeKeys_={},e.featuresCollection_=null,Array.isArray(i.features)?s=i.features:i.features&&(s=(a=i.features).getArray()),!o&&void 0===a&&(a=new Nt(s)),void 0!==s&&e.addFeaturesInternal(s),void 0!==a&&e.bindFeaturesCollection_(a),e}return Ka(r,n),r.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},r.prototype.addFeatureInternal=function(t){var e=P(t);if(this.addToIndex_(e,t)){this.setupChangeEvents_(e,t);var i=t.getGeometry();if(i){var o=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(o,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Te("addfeature",t))}else this.featuresCollection_&&this.featuresCollection_.remove(t)},r.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[j(e,"change",this.handleFeatureChange_,this),j(e,"propertychange",this.handleFeatureChange_,this)]},r.prototype.addToIndex_=function(t,e){var i=!0,o=e.getId();return void 0!==o&&(o.toString()in this.idIndex_?i=!1:this.idIndex_[o.toString()]=e),i&&(W(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),i},r.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},r.prototype.addFeaturesInternal=function(t){for(var e=[],i=[],o=[],a=0,s=t.length;a<s;a++){var l=P(u=t[a]);this.addToIndex_(l,u)&&i.push(u)}a=0;for(var c=i.length;a<c;a++){var u;l=P(u=i[a]),this.setupChangeEvents_(l,u);var h=u.getGeometry();if(h){var f=h.getExtent();e.push(f),o.push(u)}else this.nullGeometryFeatures_[l]=u}if(this.featuresRtree_&&this.featuresRtree_.load(e,o),this.hasListener("addfeature")){a=0;for(var d=i.length;a<d;a++)this.dispatchEvent(new Te("addfeature",i[a]))}},r.prototype.bindFeaturesCollection_=function(t){var e=!1;this.addEventListener("addfeature",function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener("removefeature",function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener("add",function(i){e||(e=!0,this.addFeature(i.element),e=!1)}.bind(this)),t.addEventListener("remove",function(i){e||(e=!0,this.removeFeature(i.element),e=!1)}.bind(this)),this.featuresCollection_=t},r.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_)this.featureChangeKeys_[e].forEach(Q);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var o=function(u){this.removeFeatureInternal(u)}.bind(this);for(var a in this.featuresRtree_.forEach(o),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[a])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var s=new Te("clear");this.dispatchEvent(s),this.changed()},r.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},r.prototype.forEachFeatureAtCoordinateDirect=function(t,e){return this.forEachFeatureInExtent([t[0],t[1],t[0],t[1]],function(o){if(o.getGeometry().intersectsCoordinate(t))return e(o)})},r.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},r.prototype.forEachFeatureIntersectingExtent=function(t,e){return this.forEachFeatureInExtent(t,function(i){if(i.getGeometry().intersectsExtent(t)){var a=e(i);if(a)return a}})},r.prototype.getFeaturesCollection=function(){return this.featuresCollection_},r.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),zr(this.nullGeometryFeatures_)||xe(t,ho(this.nullGeometryFeatures_))),t},r.prototype.getFeaturesAtCoordinate=function(t){var e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e},r.prototype.getFeaturesInExtent=function(t,e){var i=this;if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);var a=function Ys(n,r){if(r.canWrapX()){var t=r.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[t[0],n[1],t[2],n[3]]];!function Ws(n,r){var t=r.getExtent(),e=Ge(n);if(r.canWrapX()&&(e[0]<t[0]||e[0]>=t[2])){var i=et(t),a=Math.floor((e[0]-t[0])/i)*i;n[0]-=a,n[2]-=a}}(n,r);var e=et(t);if(et(n)>e)return[[t[0],n[1],t[2],n[3]]];if(n[0]<t[0])return[[n[0]+e,n[1],t[2],n[3]],[t[0],n[1],n[2],n[3]]];if(n[2]>t[2])return[[n[0],n[1],t[2],n[3]],[t[0],n[1],n[2]-e,n[3]]]}return[n]}(t,e);return[].concat.apply([],a.map(function(s){return i.featuresRtree_.getInExtent(s)}))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},r.prototype.getClosestFeatureToCoordinate=function(t,e){var i=t[0],o=t[1],a=null,s=[NaN,NaN],u=1/0,l=[-1/0,-1/0,1/0,1/0],c=e||x;return this.featuresRtree_.forEachInExtent(l,function(h){if(c(h)){var f=h.getGeometry(),d=u;if((u=f.closestPointXY(i,o,s,u))<d){a=h;var p=Math.sqrt(u);l[0]=i-p,l[1]=o-p,l[2]=i+p,l[3]=o+p}}}),a},r.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},r.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return void 0!==e?e:null},r.prototype.getFeatureByUid=function(t){var e=this.uidIndex_[t];return void 0!==e?e:null},r.prototype.getFormat=function(){return this.format_},r.prototype.getOverlaps=function(){return this.overlaps_},r.prototype.getUrl=function(){return this.url_},r.prototype.handleFeatureChange_=function(t){var e=t.target,i=P(e),o=e.getGeometry();if(o){var a=o.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(a,e)):this.featuresRtree_&&this.featuresRtree_.update(a,e)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);var s=e.getId();if(void 0!==s){var u=s.toString();this.idIndex_[u]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[u]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new Te("changefeature",e))},r.prototype.hasFeature=function(t){var e=t.getId();return void 0!==e?e in this.idIndex_:P(t)in this.uidIndex_},r.prototype.isEmpty=function(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&zr(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()},r.prototype.loadFeatures=function(t,e,i){for(var o=this.loadedExtentsRtree_,a=this.strategy_(t,e,i),s=function(h,f){var d=a[h];o.forEachInExtent(d,function(v){return bn(v.extent,d)})||(++u.loadingExtentsCount_,u.dispatchEvent(new Te("featuresloadstart")),u.loader_.call(u,d,e,i,function(v){--this.loadingExtentsCount_,this.dispatchEvent(new Te("featuresloadend",void 0,v))}.bind(u),function(){--this.loadingExtentsCount_,this.dispatchEvent(new Te("featuresloaderror"))}.bind(u)),o.insert(d,{extent:d.slice()}))},u=this,l=0,c=a.length;l<c;++l)s(l);this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0},r.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),n.prototype.refresh.call(this)},r.prototype.removeLoadedExtent=function(t){var i,e=this.loadedExtentsRtree_;e.forEachInExtent(t,function(o){if(be(o.extent,t))return i=o,!0}),i&&e.remove(i)},r.prototype.removeFeature=function(t){if(t){var e=P(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}},r.prototype.removeFeatureInternal=function(t){var e=P(t),i=this.featureChangeKeys_[e];if(i){i.forEach(Q),delete this.featureChangeKeys_[e];var o=t.getId();return void 0!==o&&delete this.idIndex_[o.toString()],delete this.uidIndex_[e],this.dispatchEvent(new Te("removefeature",t)),t}},r.prototype.removeFromIdIndex_=function(t){var e=!1;for(var i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e},r.prototype.setLoader=function(t){this.loader_=t},r.prototype.setUrl=function(t){W(this.format_,7),this.url_=t,this.setLoader(Va(t,this.format_))},r}(ba);const Ff=Mf;var Df=function(){function n(r){this.opacity_=r.opacity,this.rotateWithView_=r.rotateWithView,this.rotation_=r.rotation,this.scale_=r.scale,this.scaleArray_=Ot(r.scale),this.displacement_=r.displacement,this.declutterMode_=r.declutterMode}return n.prototype.clone=function(){var r=this.getScale();return new n({opacity:this.getOpacity(),scale:Array.isArray(r)?r.slice():r,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})},n.prototype.getOpacity=function(){return this.opacity_},n.prototype.getRotateWithView=function(){return this.rotateWithView_},n.prototype.getRotation=function(){return this.rotation_},n.prototype.getScale=function(){return this.scale_},n.prototype.getScaleArray=function(){return this.scaleArray_},n.prototype.getDisplacement=function(){return this.displacement_},n.prototype.getDeclutterMode=function(){return this.declutterMode_},n.prototype.getAnchor=function(){return A()},n.prototype.getImage=function(r){return A()},n.prototype.getHitDetectionImage=function(){return A()},n.prototype.getPixelRatio=function(r){return 1},n.prototype.getImageState=function(){return A()},n.prototype.getImageSize=function(){return A()},n.prototype.getOrigin=function(){return A()},n.prototype.getSize=function(){return A()},n.prototype.setDisplacement=function(r){this.displacement_=r},n.prototype.setOpacity=function(r){this.opacity_=r},n.prototype.setRotateWithView=function(r){this.rotateWithView_=r},n.prototype.setRotation=function(r){this.rotation_=r},n.prototype.setScale=function(r){this.scale_=r,this.scaleArray_=Ot(r)},n.prototype.listenImageChange=function(r){A()},n.prototype.load=function(){A()},n.prototype.unlistenImageChange=function(r){A()},n}();const Nf=Df;function Je(n){return Array.isArray(n)?uo(n):n}var bf=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Gf=function(n){function r(t){var e=this;return(e=n.call(this,{opacity:1,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode})||this).canvas_=void 0,e.hitDetectionCanvas_=null,e.fill_=void 0!==t.fill?t.fill:null,e.origin_=[0,0],e.points_=t.points,e.radius_=void 0!==t.radius?t.radius:t.radius1,e.radius2_=t.radius2,e.angle_=void 0!==t.angle?t.angle:0,e.stroke_=void 0!==t.stroke?t.stroke:null,e.size_=null,e.renderOptions_=null,e.render(),e}return bf(r,n),r.prototype.clone=function(){var t=this.getScale(),e=new r({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e},r.prototype.getAnchor=function(){var t=this.size_;if(!t)return null;var e=this.getDisplacement();return[t[0]/2-e[0],t[1]/2+e[1]]},r.prototype.getAngle=function(){return this.angle_},r.prototype.getFill=function(){return this.fill_},r.prototype.setFill=function(t){this.fill_=t,this.render()},r.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},r.prototype.getImage=function(t){var e=this.canvas_[t];if(!e){var i=this.renderOptions_,o=Oe(i.size*t,i.size*t);this.draw_(i,o,t),this.canvas_[t]=e=o.canvas}return e},r.prototype.getPixelRatio=function(t){return t},r.prototype.getImageSize=function(){return this.size_},r.prototype.getImageState=function(){return 2},r.prototype.getOrigin=function(){return this.origin_},r.prototype.getPoints=function(){return this.points_},r.prototype.getRadius=function(){return this.radius_},r.prototype.getRadius2=function(){return this.radius2_},r.prototype.getSize=function(){return this.size_},r.prototype.getStroke=function(){return this.stroke_},r.prototype.setStroke=function(t){this.stroke_=t,this.render()},r.prototype.listenImageChange=function(t){},r.prototype.load=function(){},r.prototype.unlistenImageChange=function(t){},r.prototype.calculateLineJoinSize_=function(t,e,i){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;var o=this.radius_,a=void 0===this.radius2_?o:this.radius2_;if(o<a){var s=o;o=a,a=s}var l=2*Math.PI/(void 0===this.radius2_?this.points_:2*this.points_),c=a*Math.sin(l),f=o-Math.sqrt(a*a-c*c),d=Math.sqrt(c*c+f*f),p=d/c;if("miter"===t&&p<=i)return p*e;var v=e/2/p,y=e/2*(f/d),T=Math.sqrt((o+v)*(o+v)+y*y)-o;if(void 0===this.radius2_||"bevel"===t)return 2*T;var m=o*Math.sin(l),w=a-Math.sqrt(o*o-m*m),C=Math.sqrt(m*m+w*w)/m;return C<=i?2*Math.max(T,C*e/2-a-o):2*T},r.prototype.createRenderOptions=function(){var a,t=Jr,e=0,i=null,o=0,s=0;this.stroke_&&(null===(a=this.stroke_.getColor())&&(a=Wn),a=Je(a),void 0===(s=this.stroke_.getWidth())&&(s=1),i=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset(),void 0===(t=this.stroke_.getLineJoin())&&(t=Jr),void 0===(e=this.stroke_.getMiterLimit())&&(e=10));var u=this.calculateLineJoinSize_(t,s,e),l=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:a,strokeWidth:s,size:Math.ceil(2*l+u),lineDash:i,lineDashOffset:o,lineJoin:t,miterLimit:e}},r.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]},r.prototype.draw_=function(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){var o=this.fill_.getColor();null===o&&(o=qr),e.fillStyle=Je(o),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},r.prototype.createHitDetectionCanvas_=function(t){if(this.fill_){var e=this.fill_.getColor(),i=0;if("string"==typeof e&&(e=jr(e)),null===e?i=1:Array.isArray(e)&&(i=4===e.length?e[3]:1),0===i){var o=Oe(t.size,t.size);this.hitDetectionCanvas_=o.canvas,this.drawHitDetectionCanvas_(t,o)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},r.prototype.createPath_=function(t){var e=this.points_,i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{var o=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(e*=2);for(var a=this.angle_-Math.PI/2,s=2*Math.PI/e,u=0;u<e;u++){var l=a+u*s,c=u%2==0?i:o;t.lineTo(c*Math.cos(l),c*Math.sin(l))}t.closePath()}},r.prototype.drawHitDetectionCanvas_=function(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=qr,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},r}(Nf);const Uf=Gf;var Xf=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Bf=function(n){function r(t){var e=t||{};return n.call(this,{points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:void 0!==e.scale?e.scale:1,rotation:void 0!==e.rotation?e.rotation:0,rotateWithView:void 0!==e.rotateWithView&&e.rotateWithView,displacement:void 0!==e.displacement?e.displacement:[0,0],declutterMode:e.declutterMode})||this}return Xf(r,n),r.prototype.clone=function(){var t=this.getScale(),e=new r({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e},r.prototype.setRadius=function(t){this.radius_=t,this.render()},r}(Uf);const Za=Bf;var jf=function(){function n(r){var t=r||{};this.color_=void 0!==t.color?t.color:null}return n.prototype.clone=function(){var r=this.getColor();return new n({color:Array.isArray(r)?r.slice():r||void 0})},n.prototype.getColor=function(){return this.color_},n.prototype.setColor=function(r){this.color_=r},n}();const zf=jf;var Wf=function(){function n(r){var t=r||{};this.color_=void 0!==t.color?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=void 0!==t.lineDash?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}return n.prototype.clone=function(){var r=this.getColor();return new n({color:Array.isArray(r)?r.slice():r||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},n.prototype.getColor=function(){return this.color_},n.prototype.getLineCap=function(){return this.lineCap_},n.prototype.getLineDash=function(){return this.lineDash_},n.prototype.getLineDashOffset=function(){return this.lineDashOffset_},n.prototype.getLineJoin=function(){return this.lineJoin_},n.prototype.getMiterLimit=function(){return this.miterLimit_},n.prototype.getWidth=function(){return this.width_},n.prototype.setColor=function(r){this.color_=r},n.prototype.setLineCap=function(r){this.lineCap_=r},n.prototype.setLineDash=function(r){this.lineDash_=r},n.prototype.setLineDashOffset=function(r){this.lineDashOffset_=r},n.prototype.setLineJoin=function(r){this.lineJoin_=r},n.prototype.setMiterLimit=function(r){this.miterLimit_=r},n.prototype.setWidth=function(r){this.width_=r},n}();const Ha=Wf;var Qe=function(){function n(r){var t=r||{};this.geometry_=null,this.geometryFunction_=qa,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.hitDetectionRenderer_=void 0!==t.hitDetectionRenderer?t.hitDetectionRenderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex}return n.prototype.clone=function(){var r=this.getGeometry();return r&&"object"==typeof r&&(r=r.clone()),new n({geometry:r,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},n.prototype.getRenderer=function(){return this.renderer_},n.prototype.setRenderer=function(r){this.renderer_=r},n.prototype.setHitDetectionRenderer=function(r){this.hitDetectionRenderer_=r},n.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},n.prototype.getGeometry=function(){return this.geometry_},n.prototype.getGeometryFunction=function(){return this.geometryFunction_},n.prototype.getFill=function(){return this.fill_},n.prototype.setFill=function(r){this.fill_=r},n.prototype.getImage=function(){return this.image_},n.prototype.setImage=function(r){this.image_=r},n.prototype.getStroke=function(){return this.stroke_},n.prototype.setStroke=function(r){this.stroke_=r},n.prototype.getText=function(){return this.text_},n.prototype.setText=function(r){this.text_=r},n.prototype.getZIndex=function(){return this.zIndex_},n.prototype.setGeometry=function(r){"function"==typeof r?this.geometryFunction_=r:"string"==typeof r?this.geometryFunction_=function(t){return t.get(r)}:r?void 0!==r&&(this.geometryFunction_=function(){return r}):this.geometryFunction_=qa,this.geometry_=r},n.prototype.setZIndex=function(r){this.zIndex_=r},n}(),Pi=null;function kf(n,r){if(!Pi){var t=new zf({color:"rgba(255,255,255,0.4)"}),e=new Ha({color:"#3399CC",width:1.25});Pi=[new Qe({image:new Za({fill:t,stroke:e,radius:5}),fill:t,stroke:e})]}return Pi}function qa(n){return n.getGeometry()}const Vf=Qe;var Kf=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Zf=function(n){function r(t){var e=this,i=t||{},o=ot({},i);return delete o.style,delete o.renderBuffer,delete o.updateWhileAnimating,delete o.updateWhileInteracting,(e=n.call(this,o)||this).declutter_=void 0!==i.declutter&&i.declutter,e.renderBuffer_=void 0!==i.renderBuffer?i.renderBuffer:100,e.style_=null,e.styleFunction_=void 0,e.setStyle(i.style),e.updateWhileAnimating_=void 0!==i.updateWhileAnimating&&i.updateWhileAnimating,e.updateWhileInteracting_=void 0!==i.updateWhileInteracting&&i.updateWhileInteracting,e}return Kf(r,n),r.prototype.getDeclutter=function(){return this.declutter_},r.prototype.getFeatures=function(t){return n.prototype.getFeatures.call(this,t)},r.prototype.getRenderBuffer=function(){return this.renderBuffer_},r.prototype.getRenderOrder=function(){return this.get("renderOrder")},r.prototype.getStyle=function(){return this.style_},r.prototype.getStyleFunction=function(){return this.styleFunction_},r.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},r.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},r.prototype.renderDeclutter=function(t){t.declutterTree||(t.declutterTree=new Wa(9)),this.getRenderer().renderDeclutter(t)},r.prototype.setRenderOrder=function(t){this.set("renderOrder",t)},r.prototype.setStyle=function(t){this.style_=void 0!==t?t:kf,this.styleFunction_=null===t?void 0:function Yf(n){var r,t;"function"==typeof n?r=n:(Array.isArray(n)?t=n:(W("function"==typeof n.getZIndex,41),t=[n]),r=function(){return t});return r}(this.style_),this.changed()},r}(lr);const Hf=Zf;var Tr=34962,_n=34963,$a=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Ii(n,r){for(var t=ot({preserveDrawingBuffer:!0,antialias:!ee},r),e=$a.length,i=0;i<e;++i)try{var o=n.getContext($a[i],t);if(o)return o}catch{}return null}var ed=function(){function n(r,t){this.array=null,this.type=r,W(r===Tr||r===_n,62),this.usage=void 0!==t?t:35044}return n.prototype.ofSize=function(r){this.array=new(Fi(this.type))(r)},n.prototype.fromArray=function(r){var t=Fi(this.type);this.array=t.from?t.from(r):new t(r)},n.prototype.fromArrayBuffer=function(r){this.array=new(Fi(this.type))(r)},n.prototype.getType=function(){return this.type},n.prototype.getArray=function(){return this.array},n.prototype.getUsage=function(){return this.usage},n.prototype.getSize=function(){return this.array?this.array.length:0},n}();function Fi(n){switch(n){case Tr:return Float32Array;case _n:return Uint32Array;default:return Float32Array}}const Rr=ed;var id=function(){function n(r){this.gl_=r.webGlContext;var t=this.gl_;this.scaleRatio_=r.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer();var e=t.createShader(t.VERTEX_SHADER);t.shaderSource(e,r.vertexShader||"\n  precision mediump float;\n  \n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n  \n  uniform vec2 u_screenSize;\n   \n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n"),t.compileShader(e);var i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,r.fragmentShader||"\n  precision mediump float;\n   \n  uniform sampler2D u_image;\n  uniform float u_opacity;\n   \n  varying vec2 v_texCoord;\n   \n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n  }\n"),t.compileShader(i),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,e),t.attachShader(this.renderTargetProgram_,i),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],r.uniforms&&Object.keys(r.uniforms).forEach(function(a){this.uniforms_.push({value:r.uniforms[a],location:t.getUniformLocation(this.renderTargetProgram_,a)})}.bind(this))}return n.prototype.getGL=function(){return this.gl_},n.prototype.init=function(r){var t=this.getGL(),e=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.viewport(0,0,e[0],e[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==e[0]||this.renderTargetTextureSize_[1]!==e[1]){this.renderTargetTextureSize_=e;var o=t.RGBA,s=t.RGBA,u=t.UNSIGNED_BYTE;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,0,o,e[0],e[1],0,s,u,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0)}},n.prototype.apply=function(r,t,e,i){var o=this.getGL(),a=r.size;if(o.bindFramebuffer(o.FRAMEBUFFER,t?t.getFrameBuffer():null),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.renderTargetTexture_),!t){var s=P(o.canvas);if(!r.renderTargets[s]){var u=o.getContextAttributes();u&&u.preserveDrawingBuffer&&(o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT)),r.renderTargets[s]=!0}}o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.bindBuffer(o.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),o.useProgram(this.renderTargetProgram_),o.enableVertexAttribArray(this.renderTargetAttribLocation_),o.vertexAttribPointer(this.renderTargetAttribLocation_,2,o.FLOAT,!1,0,0),o.uniform2f(this.renderTargetUniformLocation_,a[0],a[1]),o.uniform1i(this.renderTargetTextureLocation_,0),o.uniform1f(this.renderTargetOpacityLocation_,r.layerStatesArray[r.layerIndex].opacity),this.applyUniforms(r),e&&e(o,r),o.drawArrays(o.TRIANGLES,0,6),i&&i(o,r)},n.prototype.getFrameBuffer=function(){return this.frameBuffer_},n.prototype.applyUniforms=function(r){var e,t=this.getGL(),i=1;this.uniforms_.forEach(function(o){if((e="function"==typeof o.value?o.value(r):o.value)instanceof HTMLCanvasElement||e instanceof ImageData)o.texture||(o.texture=t.createTexture()),t.activeTexture(t["TEXTURE".concat(i)]),t.bindTexture(t.TEXTURE_2D,o.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,e.width,e.height,0,t.UNSIGNED_BYTE,new Uint8Array(e.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.uniform1i(o.location,i++);else if(Array.isArray(e))switch(e.length){case 2:return void t.uniform2f(o.location,e[0],e[1]);case 3:return void t.uniform3f(o.location,e[0],e[1],e[2]);case 4:return void t.uniform4f(o.location,e[0],e[1],e[2],e[3]);default:return}else"number"==typeof e&&t.uniform1f(o.location,e)})},n}();const ts=id;function mn(n,r){return n[0]=r[0],n[1]=r[1],n[4]=r[2],n[5]=r[3],n[12]=r[4],n[13]=r[5],n}var od=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),bt={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126},En={};function rs(n){return"shared/"+n}var ns=0,ld=function(n){function r(t){var e=n.call(this)||this,i=t||{};e.boundHandleWebGLContextLost_=e.handleWebGLContextLost.bind(e),e.boundHandleWebGLContextRestored_=e.handleWebGLContextRestored.bind(e),e.canvasCacheKey_=i.canvasCacheKey?rs(i.canvasCacheKey):function ad(){var n="unique/"+ns;return ns+=1,n}(),e.canvas_=function sd(n){var r=En[n];if(!r){var t=document.createElement("canvas");t.style.position="absolute",t.style.left="0",En[n]=r={users:0,canvas:t}}return r.users+=1,r.canvas}(e.canvasCacheKey_),e.gl_=Ii(e.canvas_),e.bufferCache_={},e.extensionCache_={},e.currentProgram_=null,e.canvas_.addEventListener("webglcontextlost",e.boundHandleWebGLContextLost_),e.canvas_.addEventListener("webglcontextrestored",e.boundHandleWebGLContextRestored_),e.offsetRotateMatrix_=[1,0,0,1,0,0],e.offsetScaleMatrix_=[1,0,0,1,0,0],e.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e.uniformLocations_={},e.attribLocations_={},e.uniforms_=[],i.uniforms&&e.setUniforms(i.uniforms);var o=e.getGL();return e.postProcessPasses_=i.postProcesses?i.postProcesses.map(function(a){return new ts({webGlContext:o,scaleRatio:a.scaleRatio,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,uniforms:a.uniforms})}):[new ts({webGlContext:o})],e.shaderCompileErrors_=null,e.startTime_=Date.now(),e}return od(r,n),r.prototype.setUniforms=function(t){for(var e in this.uniforms_=[],t)this.uniforms_.push({name:e,value:t[e]});this.uniformLocations_={}},r.prototype.canvasCacheKeyMatches=function(t){return this.canvasCacheKey_===rs(t)},r.prototype.getExtension=function(t){if(t in this.extensionCache_)return this.extensionCache_[t];var e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e},r.prototype.bindBuffer=function(t){var e=this.getGL(),i=P(t),o=this.bufferCache_[i];if(!o){var a=e.createBuffer();this.bufferCache_[i]=o={buffer:t,webGlBuffer:a}}e.bindBuffer(t.getType(),o.webGlBuffer)},r.prototype.flushBufferData=function(t){var e=this.getGL();this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())},r.prototype.deleteBuffer=function(t){var e=this.getGL(),i=P(t),o=this.bufferCache_[i];o&&!e.isContextLost()&&e.deleteBuffer(o.webGlBuffer),delete this.bufferCache_[i]},r.prototype.disposeInternal=function(){this.canvas_.removeEventListener("webglcontextlost",this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener("webglcontextrestored",this.boundHandleWebGLContextRestored_),function ud(n){var r=En[n];if(r&&(r.users-=1,!(r.users>0))){var i=Ii(r.canvas).getExtension("WEBGL_lose_context");i&&i.loseContext(),delete En[n]}}(this.canvasCacheKey_),delete this.gl_,delete this.canvas_},r.prototype.prepareDraw=function(t,e){var i=this.getGL(),o=this.getCanvas(),a=t.size,s=t.pixelRatio;o.width=a[0]*s,o.height=a[1]*s,o.style.width=a[0]+"px",o.style.height=a[1]+"px",i.useProgram(this.currentProgram_);for(var u=this.postProcessPasses_.length-1;u>=0;u--)this.postProcessPasses_[u].init(t);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,e?i.ZERO:i.ONE_MINUS_SRC_ALPHA),i.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},r.prototype.prepareDrawToRenderTarget=function(t,e,i){var o=this.getGL(),a=e.getSize();o.bindFramebuffer(o.FRAMEBUFFER,e.getFramebuffer()),o.viewport(0,0,a[0],a[1]),o.bindTexture(o.TEXTURE_2D,e.getTexture()),o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT),o.enable(o.BLEND),o.blendFunc(o.ONE,i?o.ZERO:o.ONE_MINUS_SRC_ALPHA),o.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},r.prototype.drawElements=function(t,e){var i=this.getGL();this.getExtension("OES_element_index_uint"),i.drawElements(i.TRIANGLES,e-t,i.UNSIGNED_INT,4*t)},r.prototype.finalizeDraw=function(t,e,i){for(var o=0,a=this.postProcessPasses_.length;o<a;o++)o===a-1?this.postProcessPasses_[o].apply(t,null,e,i):this.postProcessPasses_[o].apply(t,this.postProcessPasses_[o+1])},r.prototype.getCanvas=function(){return this.canvas_},r.prototype.getGL=function(){return this.gl_},r.prototype.applyFrameState=function(t){var e=t.size,i=t.viewState.rotation,o=Ir(this.offsetScaleMatrix_);Fn(o,2/e[0],2/e[1]);var a=Ir(this.offsetRotateMatrix_);0!==i&&Ki(a,-i),this.setUniformMatrixValue("u_offsetScaleMatrix",mn(this.tmpMat4_,o)),this.setUniformMatrixValue("u_offsetRotateMatrix",mn(this.tmpMat4_,a)),this.setUniformFloatValue("u_time",.001*(Date.now()-this.startTime_)),this.setUniformFloatValue("u_zoom",t.viewState.zoom),this.setUniformFloatValue("u_resolution",t.viewState.resolution)},r.prototype.applyUniforms=function(t){var i,e=this.getGL(),o=0;this.uniforms_.forEach(function(a){if((i="function"==typeof a.value?a.value(t):a.value)instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof ImageData)a.texture||(a.prevValue=void 0,a.texture=e.createTexture()),e.activeTexture(e["TEXTURE".concat(o)]),e.bindTexture(e.TEXTURE_2D,a.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(!(i instanceof HTMLImageElement)||i.complete)&&a.prevValue!==i&&(a.prevValue=i,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i)),e.uniform1i(this.getUniformLocation(a.name),o++);else if(Array.isArray(i)&&6===i.length)this.setUniformMatrixValue(a.name,mn(this.tmpMat4_,i));else if(Array.isArray(i)&&i.length<=4)switch(i.length){case 2:return void e.uniform2f(this.getUniformLocation(a.name),i[0],i[1]);case 3:return void e.uniform3f(this.getUniformLocation(a.name),i[0],i[1],i[2]);case 4:return void e.uniform4f(this.getUniformLocation(a.name),i[0],i[1],i[2],i[3]);default:return}else"number"==typeof i&&e.uniform1f(this.getUniformLocation(a.name),i)}.bind(this))},r.prototype.useProgram=function(t){return t!=this.currentProgram_&&(this.getGL().useProgram(t),this.currentProgram_=t,this.uniformLocations_={},this.attribLocations_={},!0)},r.prototype.compileShader=function(t,e){var i=this.getGL(),o=i.createShader(e);return i.shaderSource(o,t),i.compileShader(o),o},r.prototype.getProgram=function(t,e){var i=this.getGL(),o=this.compileShader(t,i.FRAGMENT_SHADER),a=this.compileShader(e,i.VERTEX_SHADER),s=i.createProgram();if(i.attachShader(s,o),i.attachShader(s,a),i.linkProgram(s),!i.getShaderParameter(o,i.COMPILE_STATUS)){var u="Fragment shader compliation failed: ".concat(i.getShaderInfoLog(o));throw new Error(u)}if(i.deleteShader(o),!i.getShaderParameter(a,i.COMPILE_STATUS))throw u="Vertex shader compilation failed: ".concat(i.getShaderInfoLog(a)),new Error(u);if(i.deleteShader(a),!i.getProgramParameter(s,i.LINK_STATUS))throw u="GL program linking failed: ".concat(i.getShaderInfoLog(a)),new Error(u);return s},r.prototype.getUniformLocation=function(t){return void 0===this.uniformLocations_[t]&&(this.uniformLocations_[t]=this.getGL().getUniformLocation(this.currentProgram_,t)),this.uniformLocations_[t]},r.prototype.getAttributeLocation=function(t){return void 0===this.attribLocations_[t]&&(this.attribLocations_[t]=this.getGL().getAttribLocation(this.currentProgram_,t)),this.attribLocations_[t]},r.prototype.makeProjectionTransform=function(t,e){var i=t.size,o=t.viewState.rotation,a=t.viewState.resolution,s=t.viewState.center;return Ir(e),Zt(e,0,0,2/(a*i[0]),2/(a*i[1]),-o,-s[0],-s[1]),e},r.prototype.setUniformFloatValue=function(t,e){this.getGL().uniform1f(this.getUniformLocation(t),e)},r.prototype.setUniformFloatVec4=function(t,e){this.getGL().uniform4fv(this.getUniformLocation(t),e)},r.prototype.setUniformMatrixValue=function(t,e){this.getGL().uniformMatrix4fv(this.getUniformLocation(t),!1,e)},r.prototype.enableAttributeArray_=function(t,e,i,o,a){var s=this.getAttributeLocation(t);s<0||(this.getGL().enableVertexAttribArray(s),this.getGL().vertexAttribPointer(s,e,i,!1,o,a))},r.prototype.enableAttributes=function(t){for(var e=function cd(n){for(var r=0,t=0;t<n.length;t++){var e=n[t];r+=e.size*is(e.type)}return r}(t),i=0,o=0;o<t.length;o++){var a=t[o];this.enableAttributeArray_(a.name,a.size,a.type||5126,e,i),i+=a.size*is(a.type)}},r.prototype.handleWebGLContextLost=function(){je(this.bufferCache_),this.currentProgram_=null},r.prototype.handleWebGLContextRestored=function(){},r.prototype.createTexture=function(t,e,i){var o=this.getGL(),a=i||o.createTexture(),u=o.RGBA,c=o.RGBA,h=o.UNSIGNED_BYTE;return o.bindTexture(o.TEXTURE_2D,a),e?o.texImage2D(o.TEXTURE_2D,0,u,c,h,e):o.texImage2D(o.TEXTURE_2D,0,u,t[0],t[1],0,c,h,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),a},r}(Bt);function is(n){switch(n){case bt.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case bt.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case bt.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;default:return Float32Array.BYTES_PER_ELEMENT}}const hd=ld;var fd=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),dd=function(n){function r(t,e){var i=n.call(this,t)||this,o=e||{};return i.inversePixelTransform_=[1,0,0,1,0,0],i.pixelContext_=null,i.postProcesses_=o.postProcesses,i.uniforms_=o.uniforms,t.addChangeListener("map",i.removeHelper.bind(i)),i.dispatchPreComposeEvent=i.dispatchPreComposeEvent.bind(i),i.dispatchPostComposeEvent=i.dispatchPostComposeEvent.bind(i),i}return fd(r,n),r.prototype.dispatchPreComposeEvent=function(t,e){var i=this.getLayer();if(i.hasListener("precompose")){var o=new cr("precompose",void 0,e,t);i.dispatchEvent(o)}},r.prototype.dispatchPostComposeEvent=function(t,e){var i=this.getLayer();if(i.hasListener("postcompose")){var o=new cr("postcompose",void 0,e,t);i.dispatchEvent(o)}},r.prototype.reset=function(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)},r.prototype.removeHelper=function(){this.helper&&(this.helper.dispose(),delete this.helper)},r.prototype.prepareFrame=function(t){if(this.getLayer().getRenderSource()){for(var e=!0,i=-1,o=void 0,a=0,s=t.layerStatesArray.length;a<s;a++){var u=t.layerStatesArray[a].layer,l=u.getRenderer();if(l instanceof r){var c=u.getClassName();if((e||c!==o)&&(i+=1,e=!1),o=c,l===this)break}else e=!0}var h="map/"+t.mapId+"/group/"+i;(!this.helper||!this.helper.canvasCacheKeyMatches(h))&&(this.removeHelper(),this.helper=new hd({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:h}),o&&(this.helper.getCanvas().className=o),this.afterHelperCreated())}return this.prepareFrameInternal(t)},r.prototype.afterHelperCreated=function(){},r.prototype.prepareFrameInternal=function(t){return!0},r.prototype.disposeInternal=function(){this.removeHelper(),n.prototype.disposeInternal.call(this)},r.prototype.dispatchRenderEvent_=function(t,e,i){var o=this.getLayer();if(o.hasListener(t)){Zt(this.inversePixelTransform_,0,0,i.pixelRatio,-i.pixelRatio,0,0,-i.size[1]);var a=new cr(t,this.inversePixelTransform_,i,e);o.dispatchEvent(a)}},r.prototype.preRender=function(t,e){this.dispatchRenderEvent_("prerender",t,e)},r.prototype.postRender=function(t,e){this.dispatchRenderEvent_("postrender",t,e)},r.prototype.getDataAtPixel=function(t,e,i){var o=ut([e.pixelRatio,0,0,e.pixelRatio,0,0],t.slice()),a=this.helper.getGL();if(!a)return null;var u=this.getLayer().getExtent();if(u&&!Ae(u,ut(e.pixelToCoordinateTransform,t.slice())))return null;var c=a.getContextAttributes();if(!c||!c.preserveDrawingBuffer)return new Uint8Array;var v,h=Math.round(o[0]),f=Math.round(o[1]),d=this.pixelContext_;if(!d){var p=document.createElement("canvas");p.width=1,p.height=1,d=p.getContext("2d"),this.pixelContext_=d}d.clearRect(0,0,1,1);try{d.drawImage(a.canvas,h,f,1,1,0,0,1,1),v=d.getImageData(0,0,1,1).data}catch{return v}return 0===v[3]?null:v},r}(za);function vd(n,r){var t=r||[],e=256,i=255;return t[0]=Math.floor(n/e/e/e)/i,t[1]=Math.floor(n/e/e)%e/i,t[2]=Math.floor(n/e)%e/i,t[3]=n%e/i,t}const os=dd;var Qt=new Uint8Array(4),gd=function(){function n(r,t){this.helper_=r;var e=r.getGL();this.texture_=e.createTexture(),this.framebuffer_=e.createFramebuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}return n.prototype.setSize=function(r){Dt(r,this.size_)||(this.size_[0]=r[0],this.size_[1]=r[1],this.updateSize_())},n.prototype.getSize=function(){return this.size_},n.prototype.clearCachedData=function(){this.dataCacheDirty_=!0},n.prototype.readAll=function(){if(this.dataCacheDirty_){var r=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,r[0],r[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_},n.prototype.readPixel=function(r,t){if(r<0||t<0||r>this.size_[0]||t>=this.size_[1])return Qt[0]=0,Qt[1]=0,Qt[2]=0,Qt[3]=0,Qt;this.readAll();var e=Math.floor(r)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return Qt[0]=this.data_[4*e],Qt[1]=this.data_[4*e+1],Qt[2]=this.data_[4*e+2],Qt[3]=this.data_[4*e+3],Qt},n.prototype.getTexture=function(){return this.texture_},n.prototype.getFramebuffer=function(){return this.framebuffer_},n.prototype.updateSize_=function(){var r=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(r,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,r[0],r[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),this.data_=new Uint8Array(r[0]*r[1]*4)},n}();const yd=gd;var Ed=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Td=function(n){function r(t,e){var i=this,o=e.uniforms||{},a=[1,0,0,1,0,0];o.u_projectionMatrix=a,(i=n.call(this,t,{uniforms:o,postProcesses:e.postProcesses})||this).ready=!1,i.sourceRevision_=-1,i.verticesBuffer_=new Rr(Tr,35048),i.hitVerticesBuffer_=new Rr(Tr,35048),i.indicesBuffer_=new Rr(_n,35048),i.vertexShader_=e.vertexShader,i.fragmentShader_=e.fragmentShader,i.hitDetectionEnabled_=!(!e.hitFragmentShader||!e.hitVertexShader),i.hitVertexShader_=e.hitVertexShader,i.hitFragmentShader_=e.hitFragmentShader;var s=e.attributes?e.attributes.map(function(l){return{name:"a_"+l.name,size:1,type:bt.FLOAT}}):[];i.attributes=[{name:"a_position",size:2,type:bt.FLOAT},{name:"a_index",size:1,type:bt.FLOAT}].concat(s),i.hitDetectionAttributes=[{name:"a_position",size:2,type:bt.FLOAT},{name:"a_index",size:1,type:bt.FLOAT},{name:"a_hitColor",size:4,type:bt.FLOAT},{name:"a_featureUid",size:1,type:bt.FLOAT}].concat(s),i.customAttributes=e.attributes?e.attributes:[],i.previousExtent_=[1/0,1/0,-1/0,-1/0],i.currentTransform_=a,i.renderTransform_=[1,0,0,1,0,0],i.invertRenderTransform_=[1,0,0,1,0,0],i.renderInstructions_=new Float32Array(0),i.hitRenderInstructions_=new Float32Array(0),i.generateBuffersRun_=0,i.worker_=function md(){var n='const e="function"==typeof Object.assign?Object.assign:function(e,n){if(null==e)throw new TypeError("Cannot convert undefined or null to object");const t=Object(e);for(let e=1,n=arguments.length;e<n;++e){const n=arguments[e];if(null!=n)for(const e in n)n.hasOwnProperty(e)&&(t[e]=n[e])}return t},n="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"";n.indexOf("firefox");-1!==n.indexOf("safari")&&-1==n.indexOf("chrom")&&(n.indexOf("version/15.4")>=0||n.match(/cpu (os|iphone os) 15_4 like mac os x/)),-1!==n.indexOf("webkit")&&n.indexOf("edge"),n.indexOf("macintosh"),"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&(self,WorkerGlobalScope),function(){let e=!1;try{const n=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,n),window.removeEventListener("_",null,n)}catch(e){}}(),new Array(6);const t="GENERATE_BUFFERS",o=[],r={vertexPosition:0,indexPosition:0};function i(e,n,t,o,r){e[n+0]=t,e[n+1]=o,e[n+2]=r}function s(e,n,t,s,f,c){const l=3+f,a=e[n+0],u=e[n+1],d=o;d.length=f;for(let t=0;t<d.length;t++)d[t]=e[n+2+t];let g=c?c.vertexPosition:0,x=c?c.indexPosition:0;const h=g/l;return i(t,g,a,u,0),d.length&&t.set(d,g+3),g+=l,i(t,g,a,u,1),d.length&&t.set(d,g+3),g+=l,i(t,g,a,u,2),d.length&&t.set(d,g+3),g+=l,i(t,g,a,u,3),d.length&&t.set(d,g+3),g+=l,s[x++]=h,s[x++]=h+1,s[x++]=h+3,s[x++]=h+1,s[x++]=h+2,s[x++]=h+3,r.vertexPosition=g,r.indexPosition=x,r}const f=self;f.onmessage=n=>{const o=n.data;if(o.type===t){const n=3,t=2,r=o.customAttributesCount,i=t+r,c=new Float32Array(o.renderInstructions),l=c.length/i,a=4*l*(r+n),u=new Uint32Array(6*l),d=new Float32Array(a);let g;for(let e=0;e<c.length;e+=i)g=s(c,e,d,u,r,g);const x=e({vertexBuffer:d.buffer,indexBuffer:u.buffer,renderInstructions:c.buffer},o);f.postMessage(x,[d.buffer,u.buffer,c.buffer])}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(n,"binary").toString("base64"):URL.createObjectURL(new Blob([n],{type:"application/javascript"})))}(),i.worker_.addEventListener("message",function(l){var c=l.data;if("GENERATE_BUFFERS"===c.type){var h=c.projectionTransform;c.hitDetection?(this.hitVerticesBuffer_.fromArrayBuffer(c.vertexBuffer),this.helper.flushBufferData(this.hitVerticesBuffer_)):(this.verticesBuffer_.fromArrayBuffer(c.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_)),this.indicesBuffer_.fromArrayBuffer(c.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=h,Mr(this.invertRenderTransform_,this.renderTransform_),c.hitDetection?this.hitRenderInstructions_=new Float32Array(l.data.renderInstructions):(this.renderInstructions_=new Float32Array(l.data.renderInstructions),c.generateBuffersRun===this.generateBuffersRun_&&(this.ready=!0)),this.getLayer().changed()}}.bind(i)),i.featureCache_={},i.featureCount_=0;var u=i.getLayer().getSource();return i.sourceListenKeys_=[j(u,"addfeature",i.handleSourceFeatureAdded_,i),j(u,"changefeature",i.handleSourceFeatureChanged_,i),j(u,"removefeature",i.handleSourceFeatureDelete_,i),j(u,"clear",i.handleSourceFeatureClear_,i)],u.forEachFeature(function(l){this.featureCache_[P(l)]={feature:l,properties:l.getProperties(),geometry:l.getGeometry()},this.featureCount_++}.bind(i)),i}return Ed(r,n),r.prototype.afterHelperCreated=function(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitProgram_=this.helper.getProgram(this.hitFragmentShader_,this.hitVertexShader_),this.hitRenderTarget_=new yd(this.helper))},r.prototype.handleSourceFeatureAdded_=function(t){var e=t.feature;this.featureCache_[P(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++},r.prototype.handleSourceFeatureChanged_=function(t){var e=t.feature;this.featureCache_[P(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()}},r.prototype.handleSourceFeatureDelete_=function(t){delete this.featureCache_[P(t.feature)],this.featureCount_--},r.prototype.handleSourceFeatureClear_=function(){this.featureCache_={},this.featureCount_=0},r.prototype.renderFrame=function(t){var e=this.helper.getGL();this.preRender(e,t);var i=t.viewState.projection,s=this.getLayer().getSource().getWrapX()&&i.canWrapX(),u=i.getExtent(),l=t.extent,c=s?et(u):null,h=s?Math.ceil((l[2]-u[2])/c)+1:1,f=s?Math.floor((l[0]-u[0])/c):0,d=f,p=this.indicesBuffer_.getSize();do{this.helper.makeProjectionTransform(t,this.currentTransform_),Dn(this.currentTransform_,d*c,0),De(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(t),this.helper.drawElements(0,p)}while(++d<h);this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);var v=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderHitDetection(t,f,h,c),this.hitRenderTarget_.clearCachedData()),this.postRender(e,t),v},r.prototype.prepareFrameInternal=function(t){var e=this.getLayer(),i=e.getSource(),o=t.viewState,a=!t.viewHints[0]&&!t.viewHints[1],s=!be(this.previousExtent_,t.extent),u=this.sourceRevision_<i.getRevision();if(u&&(this.sourceRevision_=i.getRevision()),a&&(s||u)){var l=o.projection,c=o.resolution,h=e instanceof Hf?e.getRenderBuffer():0,f=function Ms(n,r,t){return t?(t[0]=n[0]-r,t[1]=n[1]-r,t[2]=n[2]+r,t[3]=n[3]+r,t):[n[0]-r,n[1]-r,n[2]+r,n[3]+r]}(t.extent,h*c);i.loadFeatures(f,c,l),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()}return this.helper.useProgram(this.program_),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0},r.prototype.rebuildBuffers_=function(t){var e=[1,0,0,1,0,0];this.helper.makeProjectionTransform(t,e);var i=(2+this.customAttributes.length)*this.featureCount_;if((!this.renderInstructions_||this.renderInstructions_.length!==i)&&(this.renderInstructions_=new Float32Array(i)),this.hitDetectionEnabled_){var o=(7+this.customAttributes.length)*this.featureCount_;(!this.hitRenderInstructions_||this.hitRenderInstructions_.length!==o)&&(this.hitRenderInstructions_=new Float32Array(o))}var a,s,f,u=[],l=[],c=0,h=0;for(var d in this.featureCache_)if((s=(a=this.featureCache_[d]).geometry)&&"Point"===s.getType()){u[0]=s.getFlatCoordinates()[0],u[1]=s.getFlatCoordinates()[1],ut(e,u),f=vd(h+6,l),this.renderInstructions_[c++]=u[0],this.renderInstructions_[c++]=u[1],this.hitDetectionEnabled_&&(this.hitRenderInstructions_[h++]=u[0],this.hitRenderInstructions_[h++]=u[1],this.hitRenderInstructions_[h++]=f[0],this.hitRenderInstructions_[h++]=f[1],this.hitRenderInstructions_[h++]=f[2],this.hitRenderInstructions_[h++]=f[3],this.hitRenderInstructions_[h++]=Number(d));for(var p=void 0,v=0;v<this.customAttributes.length;v++)p=this.customAttributes[v].callback(a.feature,a.properties),this.renderInstructions_[c++]=p,this.hitDetectionEnabled_&&(this.hitRenderInstructions_[h++]=p)}var y={type:"GENERATE_BUFFERS",renderInstructions:this.renderInstructions_.buffer,customAttributesCount:this.customAttributes.length};if(y.projectionTransform=e,y.generateBuffersRun=++this.generateBuffersRun_,this.ready=!1,this.worker_.postMessage(y,[this.renderInstructions_.buffer]),this.renderInstructions_=null,this.hitDetectionEnabled_){var R={type:"GENERATE_BUFFERS",renderInstructions:this.hitRenderInstructions_.buffer,customAttributesCount:5+this.customAttributes.length};R.projectionTransform=e,R.hitDetection=!0,this.worker_.postMessage(R,[this.hitRenderInstructions_.buffer]),this.hitRenderInstructions_=null}},r.prototype.forEachFeatureAtCoordinate=function(t,e,i,o,a){if(W(this.hitDetectionEnabled_,66),this.hitRenderInstructions_){var s=ut(e.coordinateToPixelTransform,t.slice()),u=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),c=function _d(n){var r=0,t=256,e=255;return r+=Math.round(n[0]*t*t*t*e),r+=Math.round(n[1]*t*t*e),(r+=Math.round(n[2]*t*e))+Math.round(n[3]*e)}([u[0]/255,u[1]/255,u[2]/255,u[3]/255]),f=Math.floor(this.hitRenderInstructions_[c]).toString(),p=this.getLayer().getSource().getFeatureByUid(f);if(p)return o(p,this.getLayer(),null)}},r.prototype.renderHitDetection=function(t,e,i,o){if(this.hitVerticesBuffer_.getSize()){var a=e;this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.useProgram(this.hitProgram_),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0),this.helper.bindBuffer(this.hitVerticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.hitDetectionAttributes);do{this.helper.makeProjectionTransform(t,this.currentTransform_),Dn(this.currentTransform_,a*o,0),De(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(t);var s=this.indicesBuffer_.getSize();this.helper.drawElements(0,s)}while(++a<i)}},r.prototype.disposeInternal=function(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(t){Q(t)}),this.sourceListenKeys_=null,n.prototype.disposeInternal.call(this)},r}(os);const Rd=Td;var xd=function(){function n(r,t){this.name=r,this.data=t,this.texture_=null}return n.prototype.getTexture=function(r){if(!this.texture_){var t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.data.length/4,1,0,r.RGBA,r.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_},n}();const Cd=xd;var wd=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Ad=function(n){function r(t){var e=this;return(e=n.call(this,t.tileCoord,0,{transition:t.transition,interpolate:t.interpolate})||this).loader_=t.loader,e.data_=null,e.error_=null,e.size_=t.size||[256,256],e}return wd(r,n),r.prototype.getSize=function(){return this.size_},r.prototype.getData=function(){return this.data_},r.prototype.getError=function(){return this.error_},r.prototype.load=function(){if(0===this.state||3===this.state){this.state=1,this.changed();var t=this;this.loader_().then(function(e){t.data_=e,t.state=2,t.changed()}).catch(function(e){t.error_=e,t.state=3,t.changed()})}},r}(Ti);const Sd=Ad;var Od=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}();function as(n,r,t){var e=t?n.LINEAR:n.NEAREST;n.bindTexture(n.TEXTURE_2D,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e)}function ss(n,r,t,e,i,o){var s,u,a=n.getGL();t instanceof Float32Array?(s=a.FLOAT,n.getExtension("OES_texture_float"),u=null!==n.getExtension("OES_texture_float_linear")):(s=a.UNSIGNED_BYTE,u=!0),as(a,r,o&&u);var f,c=t.byteLength/e[1],h=1;switch(c%8==0?h=8:c%4==0?h=4:c%2==0&&(h=2),i){case 1:f=a.LUMINANCE;break;case 2:f=a.LUMINANCE_ALPHA;break;case 3:f=a.RGB;break;case 4:f=a.RGBA;break;default:throw new Error("Unsupported number of bands: ".concat(i))}var d=a.getParameter(a.UNPACK_ALIGNMENT);a.pixelStorei(a.UNPACK_ALIGNMENT,h),a.texImage2D(a.TEXTURE_2D,0,f,e[0],e[1],0,f,s,t),a.pixelStorei(a.UNPACK_ALIGNMENT,d)}var tr=null,Id=function(n){function r(t){var e=n.call(this)||this;e.textures=[],e.handleTileChange_=e.handleTileChange_.bind(e),e.renderSize_=Ot(t.grid.getTileSize(t.tile.tileCoord[0])),e.gutter_=t.gutter||0,e.bandCount=NaN,e.helper_=t.helper;var i=new Rr(Tr,35044);return i.fromArray([0,1,1,1,1,0,0,0]),e.helper_.flushBufferData(i),e.coords=i,e.setTile(t.tile),e}return Od(r,n),r.prototype.setTile=function(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener("change",this.handleTileChange_),this.tile=t,this.textures.length=0,this.loaded=2===t.getState(),this.loaded)this.uploadTile_();else{if(t instanceof dn){var e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener("change",this.handleTileChange_)}},r.prototype.uploadTile_=function(){var t=this.helper_,e=t.getGL(),i=this.tile;if(i instanceof dn||i instanceof wi){var o=e.createTexture();return this.textures.push(o),this.bandCount=4,void function Pd(n,r,t,e){as(n,r,e),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)}(e,o,i.getImage(),i.interpolate)}var a=i.getSize(),s=[a[0]+2*this.gutter_,a[1]+2*this.gutter_],u=i.getData(),l=u instanceof Float32Array,c=s[0]*s[1],h=l?Float32Array:Uint8Array,f=h.BYTES_PER_ELEMENT,d=u.byteLength/s[1];this.bandCount=Math.floor(d/f/s[0]);var p=Math.ceil(this.bandCount/4);if(1===p)return o=e.createTexture(),this.textures.push(o),void ss(t,o,u,s,this.bandCount,i.interpolate);for(var v=new Array(p),y=0;y<p;++y)o=e.createTexture(),this.textures.push(o),v[y]=new h(c*(y<p-1?4:this.bandCount%4));for(var T=0,m=0,E=s[0]*this.bandCount,w=0;w<s[1];++w){for(var I=0;I<E;++I){var C=u[m+I],N=Math.floor(T/this.bandCount),X=I%this.bandCount;(B=v[y=Math.floor(X/4)])[N*(B.length/c)+X%4]=C,++T}m+=d/f}for(y=0;y<p;++y){var B;ss(t,o=this.textures[y],B=v[y],s,B.length/c,i.interpolate)}},r.prototype.handleTileChange_=function(){2===this.tile.getState()&&(this.loaded=!0,this.uploadTile_(),this.dispatchEvent("change"))},r.prototype.disposeInternal=function(){var t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(var e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener("change",this.handleTileChange_)},r.prototype.getPixelData=function(t,e){if(!this.loaded)return null;var i=this.renderSize_[0],o=this.renderSize_[1],a=this.gutter_;if(this.tile instanceof Sd){var s=this.tile.getSize(),u=s[0],l=s[1],c=u+2*a,h=l+2*a,f=a+Math.floor(u*(t/i)),d=a+Math.floor(l*(e/o)),p=this.tile.getData();if(p instanceof DataView){var v=p.byteLength/(c*h),y=v*(d*c+f),R=p.buffer.slice(y,y+v);return new DataView(R)}var T=this.bandCount*(d*c+f);return p.slice(T,T+this.bandCount)}tr||function Ld(){var n=document.createElement("canvas");n.width=1,n.height=1,tr=n.getContext("2d")}(),tr.clearRect(0,0,1,1);var B,m=this.tile.getImage(),C=m.height-2*a,N=a+Math.floor(t/i*(m.width-2*a)),X=a+Math.floor(C*(e/o));try{tr.drawImage(m,N,X,1,1,0,0,1,1),B=tr.getImageData(0,0,1,1).data}catch{return tr=null,null}return B},r}(ze);const Md=Id;var Fd=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Nd=[{name:"a_textureCoord",size:2,type:bt.FLOAT}],bd={};function Gd(n){return 2*(1-1/(n+1))-1}function us(n,r,t){t in n||(n[t]=[]),n[t].push(r)}function bi(n,r){var t=n.layerStatesArray[n.layerIndex];t.extent&&(r=re(r,ge(t.extent)));var e=t.layer.getRenderSource();if(!e.getWrapX()){var i=e.getTileGridForProjection(n.viewState.projection).getExtent();i&&(r=re(r,i))}return r}function Gi(n,r){return"".concat(n.getKey(),",").concat(Er(r))}!function(n){function r(t,e){var i=n.call(this,t,{uniforms:e.uniforms})||this;return i.renderComplete=!1,i.tileTransform_=[1,0,0,1,0,0],i.tempMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i.tempTileRange_=new Si(0,0,0,0),i.tempTileCoord_=pn(0,0,0),i.tempSize_=[0,0],i.vertexShader_=e.vertexShader,i.fragmentShader_=e.fragmentShader,i.indices_=new Rr(_n,35044),i.indices_.fromArray([0,1,3,1,2,3]),i.tileTextureCache_=new Fa(void 0!==e.cacheSize?e.cacheSize:512),i.paletteTextures_=e.paletteTextures||[],i.frameState_=null,i}Fd(r,n),r.prototype.reset=function(t){n.prototype.reset.call(this,{uniforms:t.uniforms}),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))},r.prototype.afterHelperCreated=function(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)},r.prototype.isDrawableTile_=function(t){var e=this.getLayer(),i=t.getState(),o=e.getUseInterimTilesOnError();return 2==i||4==i||3==i&&!o},r.prototype.prepareFrameInternal=function(t){var i=this.getLayer().getRenderSource();return!(!i||Gr(bi(t,t.extent)))&&"ready"===i.getState()},r.prototype.enqueueTiles=function(t,e,i,o){var a=t.viewState,s=this.getLayer(),u=s.getRenderSource(),l=u.getTileGridForProjection(a.projection),c=u.getGutterForProjection(a.projection),h=P(u);h in t.wantedTiles||(t.wantedTiles[h]={});for(var f=t.wantedTiles[h],d=this.tileTextureCache_,p=Math.max(i-s.getPreload(),l.getMinZoom(),s.getMinZoom()),v=i;v>=p;--v)for(var y=l.getTileRangeForExtentAndZ(e,v,this.tempTileRange_),R=l.getResolution(v),T=y.minX;T<=y.maxX;++T)for(var m=y.minY;m<=y.maxY;++m){var E=pn(v,T,m,this.tempTileCoord_),w=Gi(u,E),I=void 0,C=void 0;if(d.containsKey(w)&&(C=(I=d.get(w)).tile),!I||I.tile.key!==u.getKey())if(C=u.getTile(v,T,m,t.pixelRatio,a.projection),I)if(this.isDrawableTile_(C))I.setTile(C);else{var N=C.getInterimTile();I.setTile(N)}else I=new Md({tile:C,grid:l,helper:this.helper,gutter:c}),d.set(w,I);us(o,I,v);var X=C.getKey();f[X]=!0,0===C.getState()&&(t.tileQueue.isKeyQueued(X)||t.tileQueue.enqueue([C,h,l.getTileCoordCenter(E),R]))}},r.prototype.renderFrame=function(t){this.frameState_=t,this.renderComplete=!0;var e=this.helper.getGL();this.preRender(e,t);var i=t.viewState,a=this.getLayer().getRenderSource(),s=a.getTileGridForProjection(i.projection),u=a.getGutterForProjection(i.projection),l=bi(t,t.extent),c=s.getZForResolution(i.resolution,a.zDirection),h={};if(t.nextExtent){var f=s.getZForResolution(i.nextResolution,a.zDirection),d=bi(t,t.nextExtent);this.enqueueTiles(t,d,f,h)}this.enqueueTiles(t,l,c,h);for(var p={},v=P(this),y=t.time,R=!1,T=h[c],m=0,E=T.length;m<E;++m){var C=(I=(w=T[m]).tile).tileCoord;if(w.loaded){if(1===(N=I.getAlpha(v,y))){I.endTransition(v);continue}R=!0,p[X=Er(C)]=N}if(this.renderComplete=!1,!this.findAltTiles_(s,C,c+1,h))for(var k=s.getMinZoom(),lt=c-1;lt>=k&&!this.findAltTiles_(s,C,lt,h);--lt);}this.helper.useProgram(this.program_),this.helper.prepareDraw(t,!R);for(var Rt=Object.keys(h).map(Number).sort(jt),rt=i.center[0],Z=i.center[1],J=0,H=Rt.length;J<H;++J){var It=Rt[J],ct=s.getResolution(It),xt=Ot(s.getTileSize(It),this.tempSize_),kt=s.getOrigin(It),Gt=xt[0]+2*u,Mt=xt[1]+2*u,K=Gt/Mt,Vt=(rt-kt[0])/(xt[0]*ct),te=(kt[1]-Z)/(xt[1]*ct),pt=i.resolution/ct,xr=Gd(It),Ft=h[It];for(m=0,E=Ft.length;m<E;++m)if((w=Ft[m]).loaded){var I,N,X=Er(C=(I=w.tile).tileCoord),er=C[1],Kt=C[2];Ir(this.tileTransform_),Fn(this.tileTransform_,2/(t.size[0]*pt/Gt),-2/(t.size[1]*pt/Gt)),Ki(this.tileTransform_,i.rotation),Fn(this.tileTransform_,1,1/K),Dn(this.tileTransform_,(xt[0]*(er-Vt)-u)/Gt,(xt[1]*(Kt-te)-u)/Mt),this.helper.setUniformMatrixValue("u_tileTransform",mn(this.tempMat4_,this.tileTransform_)),this.helper.bindBuffer(w.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(Nd);for(var Ut=0;Ut<w.textures.length;){var zi="TEXTURE"+Ut,Cn="".concat("u_tileTextures","[").concat(Ut,"]");e.activeTexture(e[zi]),e.bindTexture(e.TEXTURE_2D,w.textures[Ut]),e.uniform1i(this.helper.getUniformLocation(Cn),Ut),++Ut}for(var rr=0;rr<this.paletteTextures_.length;++rr){var Cr=this.paletteTextures_[rr];e.activeTexture(e["TEXTURE"+Ut]);var wr=Cr.getTexture(e);e.bindTexture(e.TEXTURE_2D,wr),e.uniform1i(this.helper.getUniformLocation(Cr.name),Ut),++Ut}(N=X in p?p[X]:1)<1&&(t.animate=!0),this.helper.setUniformFloatValue("u_transitionAlpha",N),this.helper.setUniformFloatValue("u_depth",xr),this.helper.setUniformFloatValue("u_texturePixelWidth",Gt),this.helper.setUniformFloatValue("u_texturePixelHeight",Mt),this.helper.setUniformFloatValue("u_textureResolution",ct),this.helper.setUniformFloatValue("u_textureOriginX",kt[0]+er*xt[0]*ct-u*ct),this.helper.setUniformFloatValue("u_textureOriginY",kt[1]-Kt*xt[1]*ct+u*ct);var Me=l;u>0&&re(Me=s.getTileCoordExtent(C),l,Me),this.helper.setUniformFloatVec4("u_renderExtent",Me),this.helper.setUniformFloatValue("u_resolution",i.resolution),this.helper.setUniformFloatValue("u_zoom",i.zoom),this.helper.drawElements(0,this.indices_.getSize())}}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);for(var nr=this.helper.getCanvas(),wn=this.tileTextureCache_;wn.canExpireCache();){var w;(w=wn.pop()).dispose()}return t.postRenderFunctions.push(function(Cs,Sn){a.expireCache(Sn.viewState.projection,bd)}),this.postRender(e,t),nr},r.prototype.getData=function(t){if(!this.helper.getGL())return null;var i=this.frameState_;if(!i)return null;var o=this.getLayer(),a=ut(i.pixelToCoordinateTransform,t.slice()),s=i.viewState,u=o.getExtent();if(u&&!Ae(ge(u),a))return null;var c,h,f,l=o.getSources(Nn([a]),s.resolution);for(c=l.length-1;c>=0;--c)if("ready"===(h=l[c]).getState()){if(f=h.getTileGridForProjection(s.projection),h.getWrapX())break;var d=f.getExtent();if(!d||Ae(d,a))break}if(c<0)return null;for(var p=this.tileTextureCache_,v=f.getZForResolution(s.resolution);v>=f.getMinZoom();--v){var y=f.getTileCoordForCoordAndZ(a,v),R=Gi(h,y);if(p.containsKey(R)){var T=p.get(R);if(T.loaded){var m=f.getOrigin(v),E=Ot(f.getTileSize(v)),w=f.getResolution(v);return T.getPixelData((a[0]-m[0])/w-y[1]*E[0],(m[1]-a[1])/w-y[2]*E[1])}}}return null},r.prototype.findAltTiles_=function(t,e,i,o){var a=t.getTileRangeForTileCoordAndZ(e,i,this.tempTileRange_);if(!a)return!1;for(var s=!0,u=this.tileTextureCache_,l=this.getLayer().getRenderSource(),c=a.minX;c<=a.maxX;++c)for(var h=a.minY;h<=a.maxY;++h){var f=Gi(l,[i,c,h]),d=!1;if(u.containsKey(f)){var p=u.get(f);p.loaded&&(us(o,p,i),d=!0)}d||(s=!1)}return s},r.prototype.removeHelper=function(){if(this.helper){var t=this.tileTextureCache_;t.forEach(function(e){return e.dispose()}),t.clear()}n.prototype.removeHelper.call(this)},r.prototype.disposeInternal=function(){var t=this.helper;t&&(t.getGL().deleteProgram(this.program_),delete this.program_,t.deleteBuffer(this.indices_)),n.prototype.disposeInternal.call(this),delete this.indices_,delete this.tileTextureCache_,delete this.frameState_}}(os);var U={};function $t(n){if("number"==typeof n)return 1;if("boolean"==typeof n)return 8;if("string"==typeof n)return function Js(n){return io.test(n)&&(n=oo(n)),no.test(n)||0===n.indexOf("rgba(")||0===n.indexOf("rgb(")}(n)?6:2;if(!Array.isArray(n))throw new Error("Unhandled value type: ".concat(JSON.stringify(n)));var r=n;if(r.every(function(i){return"number"==typeof i}))return 3===r.length||4===r.length?20:16;if("string"!=typeof r[0])throw new Error("Expected an expression operator but received: ".concat(JSON.stringify(r)));var e=U[r[0]];if(void 0===e)throw new Error("Unrecognized expression operator: ".concat(JSON.stringify(r)));return e.getReturnType(r.slice(1))}function Rn(n){var r=n.toString();return-1===r.indexOf(".")?r+".0":r}function ls(n){if(n.length<2||n.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return"vec".concat(n.length,"(").concat(n.map(Rn).join(", "),")")}function Ui(n,r){return void 0===n.stringLiteralsMap[r]&&(n.stringLiteralsMap[r]=Object.keys(n.stringLiteralsMap).length),n.stringLiteralsMap[r]}function L(n,r,t){if(Array.isArray(r)&&"string"==typeof r[0]){var e=U[r[0]];if(void 0===e)throw new Error("Unrecognized expression operator: ".concat(JSON.stringify(r)));return e.toGlsl(n,r.slice(1),t)}var i=$t(r);if((1&i)>0)return Rn(r);if((8&i)>0)return r.toString();if((2&i)>0&&(void 0===t||2==t))return function Bd(n,r){return Rn(Ui(n,r))}(n,r.toString());if((4&i)>0&&(void 0===t||4==t))return function Xd(n){var r=jr(n).slice();return r.length<4&&r.push(1),ls(r.map(function(t,e){return e<3?t/255:t}))}(r);if((16&i)>0)return ls(r);throw new Error("Unexpected expression ".concat(r," (expected type ").concat(t,")"))}function cs(n){if(!(1&$t(n)))throw new Error("A numeric value was expected, got ".concat(JSON.stringify(n)," instead"))}function at(n){for(var r=0;r<n.length;r++)cs(n[r])}function hs(n){if(!(2&$t(n)))throw new Error("A string value was expected, got ".concat(JSON.stringify(n)," instead"))}function Xi(n){if(!(8&$t(n)))throw new Error("A boolean value was expected, got ".concat(JSON.stringify(n)," instead"))}function $(n,r){if(n.length!==r)throw new Error("Exactly ".concat(r," arguments were expected, got ").concat(n.length," instead"))}function Re(n,r){if(n.length<r)throw new Error("At least ".concat(r," arguments were expected, got ").concat(n.length," instead"))}function xn(n,r){if(n.length>r)throw new Error("At most ".concat(r," arguments were expected, got ").concat(n.length," instead"))}function fs(n){if(n.length%2!=0)throw new Error("An even amount of arguments was expected, got ".concat(n," instead"))}function Bi(n,r){if(!function Ud(n){return ro(n)%1==0}(r))throw new Error("Could not infer only one type from the following expression: ".concat(JSON.stringify(n)))}function ds(n){return"u_var_"+n}U.get={getReturnType:function(n){return 31},toGlsl:function(n,r){$(r,1),hs(r[0]);var t=r[0].toString();return-1===n.attributes.indexOf(t)&&n.attributes.push(t),(n.inFragmentShader?"v_":"a_")+t}},U.var={getReturnType:function(n){return 31},toGlsl:function(n,r){$(r,1),hs(r[0]);var t=r[0].toString();return-1===n.variables.indexOf(t)&&n.variables.push(t),ds(t)}},U.palette={getReturnType:function(n){return 4},toGlsl:function(n,r){$(r,2),cs(r[0]);var t=L(n,r[0]),e=r[1];if(!Array.isArray(e))throw new Error("The second argument of palette must be an array");for(var i=e.length,o=new Uint8Array(4*i),a=0;a<i;a++){var s=e[a],u=void 0;if("string"==typeof s)u=ao(s);else{if(!Array.isArray(s))throw new Error("The second argument of palette must be an array of strings or colors");var l=s.length;if(4===l)u=s;else{if(3!==l)throw new Error("Expected palette color to have 3 or 4 values, got ".concat(l));u=[s[0],s[1],s[2],1]}}var c=4*a;o[c]=u[0],o[c+1]=u[1],o[c+2]=u[2],o[c+3]=255*u[3]}n.paletteTextures||(n.paletteTextures=[]);var h="".concat("u_paletteTextures","[").concat(n.paletteTextures.length,"]"),f=new Cd(h,o);return n.paletteTextures.push(f),"texture2D(".concat(h,", vec2((").concat(t," + 0.5) / ").concat(i,".0, 0.5))")}};var ji="getBandValue";function ps(n){return{getReturnType:function(r){return 8},toGlsl:function(r,t){$(t,2);for(var e=31,i=0;i<t.length;i++)e&=$t(t[i]);if(0===e)throw new Error("All arguments should be of compatible type, got ".concat(JSON.stringify(t)," instead"));return"(".concat(L(r,t[0],e&=-5)," ").concat(n," ").concat(L(r,t[1],e),")")}}}function vs(n){return{getReturnType:function(r){return 8},toGlsl:function(r,t){Re(t,2);for(var e=0;e<t.length;e++)Xi(t[e]);var i="";return i=t.map(function(o){return L(r,o)}).join(" ".concat(n," ")),"(".concat(i,")")}}}U.band={getReturnType:function(n){return 1},toGlsl:function(n,r){Re(r,1),xn(r,3);var t=r[0];if(!(ji in n.functions)){for(var e="",i=n.bandCount||1,o=0;o<i;o++){var a=Math.floor(o/4),s=o%4;s===i-1&&1===s&&(s=3);var u="".concat("u_tileTextures","[").concat(a,"]");e+="\n          if (band == ".concat(o+1,".0) {\n            return texture2D(").concat(u,", v_textureCoord + vec2(dx, dy))[").concat(s,"];\n          }\n        ")}n.functions[ji]="\n        float getBandValue(float band, float xOffset, float yOffset) {\n          float dx = xOffset / ".concat("u_texturePixelWidth",";\n          float dy = yOffset / ").concat("u_texturePixelHeight",";\n          ").concat(e,"\n        }\n      ")}var l=L(n,t),c=L(n,r[1]||0),h=L(n,r[2]||0);return"".concat(ji,"(").concat(l,", ").concat(c,", ").concat(h,")")}},U.time={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,0),"u_time"}},U.zoom={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,0),"u_zoom"}},U.resolution={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,0),"u_resolution"}},U["*"]={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,2),at(r),"(".concat(L(n,r[0])," * ").concat(L(n,r[1]),")")}},U["/"]={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,2),at(r),"(".concat(L(n,r[0])," / ").concat(L(n,r[1]),")")}},U["+"]={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,2),at(r),"(".concat(L(n,r[0])," + ").concat(L(n,r[1]),")")}},U["-"]={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,2),at(r),"(".concat(L(n,r[0])," - ").concat(L(n,r[1]),")")}},U.clamp={getReturnType:function(n){return 1},toGlsl:function(n,r){$(r,3),at(r);var t=L(n,r[1]),e=L(n,r[2]);return"clamp(".concat(L(n,r[0]),", ").concat(t,", ").concat(e,")")}},U["%"]={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,2),at(r),"mod(".concat(L(n,r[0]),", ").concat(L(n,r[1]),")")}},U["^"]={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,2),at(r),"pow(".concat(L(n,r[0]),", ").concat(L(n,r[1]),")")}},U.abs={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,1),at(r),"abs(".concat(L(n,r[0]),")")}},U.floor={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,1),at(r),"floor(".concat(L(n,r[0]),")")}},U.round={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,1),at(r),"floor(".concat(L(n,r[0])," + 0.5)")}},U.ceil={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,1),at(r),"ceil(".concat(L(n,r[0]),")")}},U.sin={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,1),at(r),"sin(".concat(L(n,r[0]),")")}},U.cos={getReturnType:function(n){return 1},toGlsl:function(n,r){return $(r,1),at(r),"cos(".concat(L(n,r[0]),")")}},U.atan={getReturnType:function(n){return 1},toGlsl:function(n,r){return Re(r,1),xn(r,2),at(r),2===r.length?"atan(".concat(L(n,r[0]),", ").concat(L(n,r[1]),")"):"atan(".concat(L(n,r[0]),")")}},U[">"]={getReturnType:function(n){return 8},toGlsl:function(n,r){return $(r,2),at(r),"(".concat(L(n,r[0])," > ").concat(L(n,r[1]),")")}},U[">="]={getReturnType:function(n){return 8},toGlsl:function(n,r){return $(r,2),at(r),"(".concat(L(n,r[0])," >= ").concat(L(n,r[1]),")")}},U["<"]={getReturnType:function(n){return 8},toGlsl:function(n,r){return $(r,2),at(r),"(".concat(L(n,r[0])," < ").concat(L(n,r[1]),")")}},U["<="]={getReturnType:function(n){return 8},toGlsl:function(n,r){return $(r,2),at(r),"(".concat(L(n,r[0])," <= ").concat(L(n,r[1]),")")}},U["=="]=ps("=="),U["!="]=ps("!="),U["!"]={getReturnType:function(n){return 8},toGlsl:function(n,r){return $(r,1),Xi(r[0]),"(!".concat(L(n,r[0]),")")}},U.all=vs("&&"),U.any=vs("||"),U.between={getReturnType:function(n){return 8},toGlsl:function(n,r){$(r,3),at(r);var t=L(n,r[1]),e=L(n,r[2]),i=L(n,r[0]);return"(".concat(i," >= ").concat(t," && ").concat(i," <= ").concat(e,")")}},U.array={getReturnType:function(n){return 16},toGlsl:function(n,r){Re(r,2),xn(r,4),at(r);var t=r.map(function(e){return L(n,e,1)});return"vec".concat(r.length,"(").concat(t.join(", "),")")}},U.color={getReturnType:function(n){return 4},toGlsl:function(n,r){Re(r,3),xn(r,4),at(r),3===r.length&&r.push(1);var e=r.map(function(i,o){return L(n,i,1)+(o<3?" / 255.0":"")});return"vec".concat(r.length,"(").concat(e.join(", "),")")}},U.interpolate={getReturnType:function(n){for(var r=5,t=3;t<n.length;t+=2)r&=$t(n[t]);return r},toGlsl:function(n,r,t){fs(r),Re(r,6);var i,e=r[0];switch(e[0]){case"linear":i=1;break;case"exponential":i=e[1];break;default:i=null}if(!i)throw new Error('Invalid interpolation type for "interpolate" operator, received: '.concat(JSON.stringify(e)));var o=void 0!==t?t:31,a=U.interpolate.getReturnType(r)&o;Bi(r,a);for(var s=L(n,r[1]),u=Rn(i),l="",c=2;c<r.length-2;c+=2){var h=L(n,r[c]),f=l||L(n,r[c+1],a),d=L(n,r[c+2]),p=L(n,r[c+3],a);l="mix(".concat(f,", ").concat(p,", pow(clamp((").concat(s," - ").concat(h,") / (").concat(d," - ").concat(h,"), 0.0, 1.0), ").concat(u,"))")}return l}},U.match={getReturnType:function(n){for(var r=31,t=2;t<n.length;t+=2)r&=$t(n[t]);return r&$t(n[n.length-1])},toGlsl:function(n,r,t){fs(r),Re(r,4);var e=void 0!==t?t:31,i=U.match.getReturnType(r)&e;Bi(r,i);for(var o=L(n,r[0]),a=L(n,r[r.length-1],i),s=null,u=r.length-3;u>=1;u-=2){var l=L(n,r[u]),c=L(n,r[u+1],i);s="(".concat(o," == ").concat(l," ? ").concat(c," : ").concat(s||a,")")}return s}},U.case={getReturnType:function(n){for(var r=31,t=1;t<n.length;t+=2)r&=$t(n[t]);return r&$t(n[n.length-1])},toGlsl:function(n,r,t){(function jd(n){if(n.length%2==0)throw new Error("An odd amount of arguments was expected, got ".concat(n," instead"))})(r),Re(r,3);var e=void 0!==t?t:31,i=U.case.getReturnType(r)&e;Bi(r,i);for(var o=0;o<r.length-1;o+=2)Xi(r[o]);var a=L(n,r[r.length-1],i),s=null;for(o=r.length-3;o>=0;o-=2){var u=L(n,r[o]),l=L(n,r[o+1],i);s="(".concat(u," ? ").concat(l," : ").concat(s||a,")")}return s}};var Wd=function(){function n(){this.uniforms=[],this.attributes=[],this.varyings=[],this.sizeExpression="vec2(1.0)",this.rotationExpression="0.0",this.offsetExpression="vec2(0.0)",this.colorExpression="vec4(1.0)",this.texCoordExpression="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression="false",this.rotateWithView=!1}return n.prototype.addUniform=function(r){return this.uniforms.push(r),this},n.prototype.addAttribute=function(r){return this.attributes.push(r),this},n.prototype.addVarying=function(r,t,e){return this.varyings.push({name:r,type:t,expression:e}),this},n.prototype.setSizeExpression=function(r){return this.sizeExpression=r,this},n.prototype.setRotationExpression=function(r){return this.rotationExpression=r,this},n.prototype.setSymbolOffsetExpression=function(r){return this.offsetExpression=r,this},n.prototype.setColorExpression=function(r){return this.colorExpression=r,this},n.prototype.setTextureCoordinateExpression=function(r){return this.texCoordExpression=r,this},n.prototype.setFragmentDiscardExpression=function(r){return this.discardExpression=r,this},n.prototype.setSymbolRotateWithView=function(r){return this.rotateWithView=r,this},n.prototype.getSizeExpression=function(){return this.sizeExpression},n.prototype.getOffsetExpression=function(){return this.offsetExpression},n.prototype.getColorExpression=function(){return this.colorExpression},n.prototype.getTextureCoordinateExpression=function(){return this.texCoordExpression},n.prototype.getFragmentDiscardExpression=function(){return this.discardExpression},n.prototype.getSymbolVertexShader=function(r){var t=this.rotateWithView?"u_offsetScaleMatrix * u_offsetRotateMatrix":"u_offsetScaleMatrix",e=this.attributes,i=this.varyings;return r&&(e=e.concat("vec4 a_hitColor"),i=i.concat({name:"v_hitColor",type:"vec4",expression:"a_hitColor"})),"precision mediump float;\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_time;\nuniform float u_zoom;\nuniform float u_resolution;\n".concat(this.uniforms.map(function(o){return"uniform "+o+";"}).join("\n"),"\nattribute vec2 a_position;\nattribute float a_index;\n").concat(e.map(function(o){return"attribute "+o+";"}).join("\n"),"\nvarying vec2 v_texCoord;\nvarying vec2 v_quadCoord;\n").concat(i.map(function(o){return"varying "+o.type+" "+o.name+";"}).join("\n"),"\nvoid main(void) {\n  mat4 offsetMatrix = ").concat(t,";\n  vec2 halfSize = ").concat(this.sizeExpression," * 0.5;\n  vec2 offset = ").concat(this.offsetExpression,";\n  float angle = ").concat(this.rotationExpression,";\n  float offsetX;\n  float offsetY;\n  if (a_index == 0.0) {\n    offsetX = (offset.x - halfSize.x) * cos(angle) + (offset.y - halfSize.y) * sin(angle);\n    offsetY = (offset.y - halfSize.y) * cos(angle) - (offset.x - halfSize.x) * sin(angle);\n  } else if (a_index == 1.0) {\n    offsetX = (offset.x + halfSize.x) * cos(angle) + (offset.y - halfSize.y) * sin(angle);\n    offsetY = (offset.y - halfSize.y) * cos(angle) - (offset.x + halfSize.x) * sin(angle);\n  } else if (a_index == 2.0) {\n    offsetX = (offset.x + halfSize.x) * cos(angle) + (offset.y + halfSize.y) * sin(angle);\n    offsetY = (offset.y + halfSize.y) * cos(angle) - (offset.x + halfSize.x) * sin(angle);\n  } else {\n    offsetX = (offset.x - halfSize.x) * cos(angle) + (offset.y + halfSize.y) * sin(angle);\n    offsetY = (offset.y + halfSize.y) * cos(angle) - (offset.x - halfSize.x) * sin(angle);\n  }\n  vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n  vec4 texCoord = ").concat(this.texCoordExpression,";\n  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;\n  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;\n  v_texCoord = vec2(u, v);\n  u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;\n  v = a_index == 2.0 || a_index == 3.0 ? 0.0 : 1.0;\n  v_quadCoord = vec2(u, v);\n").concat(i.map(function(o){return"  "+o.name+" = "+o.expression+";"}).join("\n"),"\n}")},n.prototype.getSymbolFragmentShader=function(r){var t=r?"  if (gl_FragColor.a < 0.1) { discard; } gl_FragColor = v_hitColor;":"",e=this.varyings;return r&&(e=e.concat({name:"v_hitColor",type:"vec4",expression:"a_hitColor"})),"precision mediump float;\nuniform float u_time;\nuniform float u_zoom;\nuniform float u_resolution;\n".concat(this.uniforms.map(function(i){return"uniform "+i+";"}).join("\n"),"\nvarying vec2 v_texCoord;\nvarying vec2 v_quadCoord;\n").concat(e.map(function(i){return"varying "+i.type+" "+i.name+";"}).join("\n"),"\nvoid main(void) {\n  if (").concat(this.discardExpression,") { discard; }\n  gl_FragColor = ").concat(this.colorExpression,";\n  gl_FragColor.rgb *= gl_FragColor.a;\n").concat(t,"\n}")},n}(),kd=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Vd=function(n){function r(t){var e=this,i=ot({},t);return(e=n.call(this,i)||this).parseResult_=function Yd(n){var r=n.symbol,t=void 0!==r.size?r.size:1,e=r.color||"white",i=r.textureCoord||[0,0,1,1],o=r.offset||[0,0],a=void 0!==r.opacity?r.opacity:1,s=void 0!==r.rotation?r.rotation:0,u={inFragmentShader:!1,variables:[],attributes:[],stringLiteralsMap:{},functions:{}},l=L(u,t,17),c=L(u,o,16),h=L(u,i,16),f=L(u,s,1),d={inFragmentShader:!0,variables:u.variables,attributes:[],stringLiteralsMap:u.stringLiteralsMap,functions:{}},p=L(d,e,4),v=L(d,a,1),y="1.0",R="vec2(".concat(L(d,t,17),").x");switch(r.symbolType){case"square":case"image":break;case"circle":y="(1.0-smoothstep(1.-4./".concat(R,",1.,dot(v_quadCoord-.5,v_quadCoord-.5)*4.))");break;case"triangle":var T="(v_quadCoord*2.-1.)",m="(atan(".concat(T,".x,").concat(T,".y))");y="(1.0-smoothstep(.5-3./".concat(R,",.5,cos(floor(.5+").concat(m,"/2.094395102)*2.094395102-").concat(m,")*length(").concat(T,")))");break;default:throw new Error("Unexpected symbol type: "+r.symbolType)}var E=(new Wd).setSizeExpression("vec2(".concat(l,")")).setRotationExpression(f).setSymbolOffsetExpression(c).setTextureCoordinateExpression(h).setSymbolRotateWithView(!!r.rotateWithView).setColorExpression("vec4(".concat(p,".rgb, ").concat(p,".a * ").concat(v," * ").concat(y,")"));if(n.filter){var w=L(d,n.filter,8);E.setFragmentDiscardExpression("!".concat(w))}var I={};if(d.variables.forEach(function(N){var X=ds(N);E.addUniform("float ".concat(X)),I[X]=function(){if(!n.variables||void 0===n.variables[N])throw new Error("The following variable is missing from the style: ".concat(N));var B=n.variables[N];return"string"==typeof B&&(B=Ui(u,B)),void 0!==B?B:-9999999}}),"image"===r.symbolType&&r.src){var C=new Image;C.crossOrigin=void 0===r.crossOrigin?"anonymous":r.crossOrigin,C.src=r.src,E.addUniform("sampler2D u_texture").setColorExpression(E.getColorExpression()+" * texture2D(u_texture, v_texCoord)"),I.u_texture=C}return d.attributes.forEach(function(N){-1===u.attributes.indexOf(N)&&u.attributes.push(N),E.addVarying("v_".concat(N),"float","a_".concat(N))}),u.attributes.forEach(function(N){E.addAttribute("float a_".concat(N))}),{builder:E,attributes:u.attributes.map(function(N){return{name:N,callback:function(X,B){var k=B[N];return"string"==typeof k&&(k=Ui(u,k)),void 0!==k?k:-9999999}}}),uniforms:I}}(t.style),e.styleVariables_=t.style.variables||{},e.hitDetectionDisabled_=!!t.disableHitDetection,e}return kd(r,n),r.prototype.createRenderer=function(){return new Rd(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitVertexShader:!this.hitDetectionDisabled_&&this.parseResult_.builder.getSymbolVertexShader(!0),hitFragmentShader:!this.hitDetectionDisabled_&&this.parseResult_.builder.getSymbolFragmentShader(!0),uniforms:this.parseResult_.uniforms,attributes:this.parseResult_.attributes})},r.prototype.updateStyleVariables=function(t){ot(this.styleVariables_,t),this.changed()},r}(lr);const Kd=Vd;var Zd=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),_s=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],Hd=function(n){function r(t){var e=this,i=t||{};(e=n.call(this,{element:document.createElement("div"),target:i.target})||this).keys_=void 0!==i.keys&&i.keys,e.source_=i.source,e.isInFullscreen_=!1,e.boundHandleMapTargetChange_=e.handleMapTargetChange_.bind(e),e.cssClassName_=void 0!==i.className?i.className:"ol-full-screen",e.documentListeners_=[],e.activeClassName_=void 0!==i.activeClassName?i.activeClassName.split(" "):[e.cssClassName_+"-true"],e.inactiveClassName_=void 0!==i.inactiveClassName?i.inactiveClassName.split(" "):[e.cssClassName_+"-false"];var o=void 0!==i.label?i.label:"\u2922";e.labelNode_="string"==typeof o?document.createTextNode(o):o;var a=void 0!==i.labelActive?i.labelActive:"\xd7";e.labelActiveNode_="string"==typeof a?document.createTextNode(a):a;var s=i.tipLabel?i.tipLabel:"Toggle full-screen";return e.button_=document.createElement("button"),e.button_.title=s,e.button_.setAttribute("type","button"),e.button_.appendChild(e.labelNode_),e.button_.addEventListener("click",e.handleClick_.bind(e),!1),e.setClassName_(e.button_,e.isInFullscreen_),e.element.className="".concat(e.cssClassName_," ").concat(hr," ").concat(Zr),e.element.appendChild(e.button_),e}return Zd(r,n),r.prototype.handleClick_=function(t){t.preventDefault(),this.handleFullScreen_()},r.prototype.handleFullScreen_=function(){var t=this.getMap();if(t){var e=t.getOwnerDocument();if(ys(e))if(ms(e))!function Jd(n){n.exitFullscreen?n.exitFullscreen():n.msExitFullscreen?n.msExitFullscreen():n.webkitExitFullscreen&&n.webkitExitFullscreen()}(e);else{var i;i=this.source_?"string"==typeof this.source_?e.getElementById(this.source_):this.source_:t.getTargetElement(),this.keys_?function qd(n){n.webkitRequestFullscreen?n.webkitRequestFullscreen():Es(n)}(i):Es(i)}}},r.prototype.handleFullScreenChange_=function(){var t=this.getMap();if(t){var e=this.isInFullscreen_;this.isInFullscreen_=ms(t.getOwnerDocument()),e!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(Hr(this.labelActiveNode_,this.labelNode_),this.dispatchEvent("enterfullscreen")):(Hr(this.labelNode_,this.labelActiveNode_),this.dispatchEvent("leavefullscreen")),t.updateSize())}},r.prototype.setClassName_=function(t,e){var i,o,a,s;e?((i=t.classList).remove.apply(i,this.inactiveClassName_),(o=t.classList).add.apply(o,this.activeClassName_)):((a=t.classList).remove.apply(a,this.activeClassName_),(s=t.classList).add.apply(s,this.inactiveClassName_))},r.prototype.setMap=function(t){var e=this.getMap();e&&e.removeChangeListener("target",this.boundHandleMapTargetChange_),n.prototype.setMap.call(this,t),this.handleMapTargetChange_(),t&&t.addChangeListener("target",this.boundHandleMapTargetChange_)},r.prototype.handleMapTargetChange_=function(){for(var t=this.documentListeners_,e=0,i=t.length;e<i;++e)Q(t[e]);t.length=0;var o=this.getMap();if(o){var a=o.getOwnerDocument();for(ys(a)?this.element.classList.remove(Eo):this.element.classList.add(Eo),e=0,i=_s.length;e<i;++e)t.push(j(a,_s[e],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}},r}(hn);function ys(n){var r=n.body;return!!(r.webkitRequestFullscreen||r.msRequestFullscreen&&n.msFullscreenEnabled||r.requestFullscreen&&n.fullscreenEnabled)}function ms(n){return!!(n.webkitIsFullScreen||n.msFullscreenElement||n.fullscreenElement)}function Es(n){n.requestFullscreen?n.requestFullscreen():n.msRequestFullscreen?n.msRequestFullscreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()}const Qd=Hd;var $d=function(){function n(){}return n.prototype.drawCustom=function(r,t,e,i){},n.prototype.drawGeometry=function(r){},n.prototype.setStyle=function(r){},n.prototype.drawCircle=function(r,t){},n.prototype.drawFeature=function(r,t){},n.prototype.drawGeometryCollection=function(r,t){},n.prototype.drawLineString=function(r,t){},n.prototype.drawMultiLineString=function(r,t){},n.prototype.drawMultiPoint=function(r,t){},n.prototype.drawMultiPolygon=function(r,t){},n.prototype.drawPoint=function(r,t){},n.prototype.drawPolygon=function(r,t){},n.prototype.drawText=function(r,t){},n.prototype.setFillStrokeStyle=function(r,t){},n.prototype.setImageStyle=function(r,t){},n.prototype.setTextStyle=function(r,t){},n}();const tp=$d;var ep=function(){var n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),rp=function(n){function r(t,e,i,o,a,s,u){var l=n.call(this)||this;return l.context_=t,l.pixelRatio_=e,l.extent_=i,l.transform_=o,l.viewRotation_=a,l.squaredTolerance_=s,l.userTransform_=u,l.contextFillState_=null,l.contextStrokeState_=null,l.contextTextState_=null,l.fillState_=null,l.strokeState_=null,l.image_=null,l.imageAnchorX_=0,l.imageAnchorY_=0,l.imageHeight_=0,l.imageOpacity_=0,l.imageOriginX_=0,l.imageOriginY_=0,l.imageRotateWithView_=!1,l.imageRotation_=0,l.imageScale_=[0,0],l.imageWidth_=0,l.text_="",l.textOffsetX_=0,l.textOffsetY_=0,l.textRotateWithView_=!1,l.textRotation_=0,l.textScale_=[0,0],l.textFillState_=null,l.textStrokeState_=null,l.textState_=null,l.pixelCoordinates_=[],l.tmpLocalTransform_=[1,0,0,1,0,0],l}return ep(r,n),r.prototype.drawImages_=function(t,e,i,o){if(this.image_){var a=_r(t,e,i,o,this.transform_,this.pixelCoordinates_),s=this.context_,u=this.tmpLocalTransform_,l=s.globalAlpha;1!=this.imageOpacity_&&(s.globalAlpha=l*this.imageOpacity_);var c=this.imageRotation_;this.imageRotateWithView_&&(c+=this.viewRotation_);for(var h=0,f=a.length;h<f;h+=2){var d=a[h]-this.imageAnchorX_,p=a[h+1]-this.imageAnchorY_;if(0!==c||1!=this.imageScale_[0]||1!=this.imageScale_[1]){var v=d+this.imageAnchorX_,y=p+this.imageAnchorY_;Zt(u,v,y,1,1,c,-v,-y),s.setTransform.apply(s,u),s.translate(v,y),s.scale(this.imageScale_[0],this.imageScale_[1]),s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),s.setTransform(1,0,0,1,0,0)}else s.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,p,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(s.globalAlpha=l)}},r.prototype.drawText_=function(t,e,i,o){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var a=_r(t,e,i,o,this.transform_,this.pixelCoordinates_),s=this.context_,u=this.textRotation_;for(this.textRotateWithView_&&(u+=this.viewRotation_);e<i;e+=o){var l=a[e]+this.textOffsetX_,c=a[e+1]+this.textOffsetY_;if(0!==u||1!=this.textScale_[0]||1!=this.textScale_[1]){var h=Zt(this.tmpLocalTransform_,l,c,1,1,u,-l,-c);s.setTransform.apply(s,h),s.translate(l,c),s.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&s.strokeText(this.text_,0,0),this.textFillState_&&s.fillText(this.text_,0,0),s.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&s.strokeText(this.text_,l,c),this.textFillState_&&s.fillText(this.text_,l,c)}}},r.prototype.moveToLineTo_=function(t,e,i,o,a){var s=this.context_,u=_r(t,e,i,o,this.transform_,this.pixelCoordinates_);s.moveTo(u[0],u[1]);var l=u.length;a&&(l-=2);for(var c=2;c<l;c+=2)s.lineTo(u[c],u[c+1]);return a&&s.closePath(),i},r.prototype.drawRings_=function(t,e,i,o){for(var a=0,s=i.length;a<s;++a)e=this.moveToLineTo_(t,e,i[a],o,!0);return e},r.prototype.drawCircle=function(t){if(Ht(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=function Il(n,r,t){var e=n.getFlatCoordinates();if(e){var i=n.getStride();return _r(e,0,e.length,i,r,t)}return null}(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],o=e[3]-e[1],a=Math.sqrt(i*i+o*o),s=this.context_;s.beginPath(),s.arc(e[0],e[1],a,0,2*Math.PI),this.fillState_&&s.fill(),this.strokeState_&&s.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}},r.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},r.prototype.setTransform=function(t){this.transform_=t},r.prototype.drawGeometry=function(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t)}},r.prototype.drawFeature=function(t,e){var i=e.getGeometryFunction()(t);!i||!Ht(this.extent_,i.getExtent())||(this.setStyle(e),this.drawGeometry(i))},r.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),i=0,o=e.length;i<o;++i)this.drawGeometry(e[i])},r.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)},r.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)},r.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Ht(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){var o=t.getFlatMidpoint();this.drawText_(o,0,2,2)}}},r.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if(Ht(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,o=t.getFlatCoordinates(),a=0,s=t.getEnds(),u=t.getStride();i.beginPath();for(var l=0,c=s.length;l<c;++l)a=this.moveToLineTo_(o,a,s[l],u,!1);i.stroke()}if(""!==this.text_){var h=t.getFlatMidpoints();this.drawText_(h,0,h.length,2)}}},r.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Ht(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var i=t.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}},r.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Ht(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getOrientedFlatCoordinates(),o=0,a=t.getEndss(),s=t.getStride();e.beginPath();for(var u=0,l=a.length;u<l;++u)o=this.drawRings_(i,o,a[u],s);this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var h=t.getFlatInteriorPoints();this.drawText_(h,0,h.length,2)}}},r.prototype.setContextFillState_=function(t){var e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},r.prototype.setContextStrokeState_=function(t){var e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&(Dt(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},r.prototype.setContextTextState_=function(t){var e=this.context_,i=this.contextTextState_,o=t.textAlign?t.textAlign:"center";i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=o&&(i.textAlign=o,e.textAlign=o),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=o,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:o,textBaseline:t.textBaseline})},r.prototype.setFillStrokeStyle=function(t,e){var i=this;if(t){var o=t.getColor();this.fillState_={fillStyle:Je(o||qr)}}else this.fillState_=null;if(e){var a=e.getColor(),s=e.getLineCap(),u=e.getLineDash(),l=e.getLineDashOffset(),c=e.getLineJoin(),h=e.getWidth(),f=e.getMiterLimit(),d=u||wo;this.strokeState_={lineCap:void 0!==s?s:"round",lineDash:1===this.pixelRatio_?d:d.map(function(p){return p*i.pixelRatio_}),lineDashOffset:(l||0)*this.pixelRatio_,lineJoin:void 0!==c?c:Jr,lineWidth:(void 0!==h?h:1)*this.pixelRatio_,miterLimit:void 0!==f?f:10,strokeStyle:Je(a||Wn)}}else this.strokeState_=null},r.prototype.setImageStyle=function(t){var e;if(t&&(e=t.getSize())){var i=t.getAnchor(),o=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*this.pixelRatio_,this.imageAnchorY_=i[1]*this.pixelRatio_,this.imageHeight_=e[1]*this.pixelRatio_,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScaleArray(),this.imageWidth_=e[0]*this.pixelRatio_}else this.image_=null},r.prototype.setTextStyle=function(t){if(t){var e=t.getFill();if(e){var i=e.getColor();this.textFillState_={fillStyle:Je(i||qr)}}else this.textFillState_=null;var o=t.getStroke();if(o){var a=o.getColor(),s=o.getLineCap(),u=o.getLineDash(),l=o.getLineDashOffset(),c=o.getLineJoin(),h=o.getWidth(),f=o.getMiterLimit();this.textStrokeState_={lineCap:void 0!==s?s:"round",lineDash:u||wo,lineDashOffset:l||0,lineJoin:void 0!==c?c:Jr,lineWidth:void 0!==h?h:1,miterLimit:void 0!==f?f:10,strokeStyle:Je(a||Wn)}}else this.textStrokeState_=null;var d=t.getFont(),p=t.getOffsetX(),v=t.getOffsetY(),y=t.getRotateWithView(),R=t.getRotation(),T=t.getScaleArray(),m=t.getText(),E=t.getTextAlign(),w=t.getTextBaseline();this.textState_={font:void 0!==d?d:"10px sans-serif",textAlign:void 0!==E?E:"center",textBaseline:void 0!==w?w:"middle"},this.text_=void 0!==m?Array.isArray(m)?m.reduce(function(I,C,N){return I+(N%2?" ":C)},""):m:"",this.textOffsetX_=void 0!==p?this.pixelRatio_*p:0,this.textOffsetY_=void 0!==v?this.pixelRatio_*v:0,this.textRotateWithView_=void 0!==y&&y,this.textRotation_=void 0!==R?R:0,this.textScale_=[this.pixelRatio_*T[0],this.pixelRatio_*T[1]]}else this.text_=""},r}(tp);const np=rp;var se=it(9585),gp=it(6243);const xs=n=>({datetime:new Date(n.Epoch),cloudIndication:1===n.CloudIndicator,point:n.Point});var yp=it(5531);let mp=(()=>{class n{constructor(t){this.http=t,this.eventStreamUrl="https://lyn.met.no/events"}getServerSentEvent(){return new gp.y(t=>{const e=new EventSource(this.eventStreamUrl);return e.onerror=i=>t.error(i),e.addEventListener("lx",i=>{const s=i.data.split(/\r?\n/).map(u=>JSON.parse(u));t.next(s.flat().map(u=>xs(u)))}),()=>{1===e.readyState&&e.close()}})}getLynHistory(t){const e=60*t,i=Math.floor((new Date).getTime()/1e3)-e;return this.http.get(`https://lyn.met.no/fetch/${i}/${e}`).pipe((0,Sa.U)(o=>o.map(a=>xs(a))))}}return n.\u0275fac=function(t){return new(t||n)(se.LFG(yp.eN))},n.\u0275prov=se.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Ep=[{path:"",component:(()=>{class n{constructor(t){this.lynMet=t,this.timeNowInS=(new Date).getTime()/1e3,this.lyn$=this.lynMet.getServerSentEvent().pipe(Aa()),this.lynFromLast10Min$=this.lynMet.getLynHistory(10).pipe(Aa()),this.accumulatedLynnedslag$=this.lynFromLast10Min$.pipe((0,hh.b)(e=>this.lyn$.pipe((0,Sa.U)(i=>[...e,...i]))),(0,fh.R)((e,i)=>[...e,...i])),this.glStyle={variables:{"10mAgo":this.timeNowInS-600,now:this.timeNowInS},symbol:{symbolType:"circle",size:10,color:["interpolate",["linear"],["get","time"],["+",["var","10mAgo"],["time"]],"#ffffff",["+",["-",["var","now"],84],["time"]],"#009dff",["+",["-",["var","now"],20],["time"]],"#ff0000"],rotateWithView:!0}},this.lynLayer=new Kd({source:new Ff({features:[],attributions:'</br>Lyndata fra <a href="https://lyn.met.no">lyn.met.no</a>/'}),style:this.glStyle,disableHitDetection:!0}),this.osmLayer=new Of({source:new df}),this.olMap=new oh({layers:[this.osmLayer,this.lynLayer],interactions:Ca({altShiftDragRotate:!1,pinchRotate:!1,shiftDragZoom:!1}).extend([new xa]),view:new me({center:un([20.5651,68.7628]),zoom:4}),controls:_a().extend([new Qd])}),this.fxRainBg=new Audio("/assets/sounds/rain_bg.mp3")}ngAfterViewInit(){this.olMap.setTarget("olMap")}ngOnInit(){this.getUserLocationAndFlyToIt(),this.lynLayer.getSource().on("addfeature",e=>{const i=e.feature;!0===i.get("isLive")&&this.flash(i)}),this.subscribeToRealtimeLyn(),this.subscribeToLynHistory();const t=()=>{this.olMap.render(),window.requestAnimationFrame(t)};t(),new Promise(e=>setTimeout(e,5e3)).then(()=>{this.playBgRainSounds()})}playBgRainSounds(){this.fxRainBg.loop=!0,this.fxRainBg.volume=.5,this.fxRainBg.play()}subscribeToLynHistory(){this.lynFromLast10Min$.subscribe(t=>{this.lynLayer.getSource()?.addFeatures(t.map(e=>{const i=new ui(un(e.point)),o=new wa({geometry:i});return o.set("time",e.datetime.getTime()/1e3),o.set("addedAt",(new Date).getTime()/1e3),o.set("isLive",!1),o}))})}subscribeToRealtimeLyn(){this.lyn$.subscribe(t=>{this.lynLayer.getSource()?.addFeatures(t.map(e=>{const i=new ui(un(e.point)),o=new wa({geometry:i});return this.playSoundIfWithinMapViewport(o),o.set("time",e.datetime.getTime()/1e3),o.set("addedAt",e.datetime.getTime()/1e3),o.set("isLive",!0),o}))})}playSoundIfWithinMapViewport(t){var e=t.getGeometry()?.getExtent();if(e&&bn(this.olMap.getView().calculateExtent(),e)){let i;switch(Math.floor(3*Math.random())){case 0:i=new Audio("./assets/sounds/lyn_long.mp3");break;case 1:i=new Audio("./assets/sounds/lyn_blast.mp3");break;default:i=new Audio("./assets/sounds/lyn.mp3")}i.loop=!1,i.play()}}flash(t){const i=Date.now(),o=t.getGeometry().clone(),a=this.osmLayer.on("postrender",u=>s(u)),s=u=>{const c=u.frameState.time-i;if(c>=3e3)return void fo(a);const h=function _p(n){if(!(n.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");var o,r=n.inversePixelTransform[0],t=n.frameState,e=De(n.inversePixelTransform.slice(),t.coordinateToPixelTransform),i=function op(n,r){var t=function ap(n,r){return.5*n/r}(n,r);return t*t}(t.viewState.resolution,r),a=zo();return a&&(o=dr(a,t.viewState.projection)),new np(n.context,r,t.extent,e,t.viewState.rotation,i,o)}(u),f=c/3e3,d=25*ye(f)+5,p=ye(1-f),v=new Vf({image:new Za({radius:d,stroke:new Ha({color:"rgba(255, 0, 0, "+p+")",width:.25+p})})});h.setStyle(v),h.drawGeometry(o),this.olMap.render()}}getUserLocationAndFlyToIt(){navigator.geolocation.getCurrentPosition(t=>{this.olMap.getView().animate({center:un([t.coords.longitude,t.coords.latitude]),zoom:10})})}}return n.\u0275fac=function(t){return new(t||n)(se.Y36(mp))},n.\u0275cmp=se.Xpm({type:n,selectors:[["app-ligthning-map"]],decls:1,vars:0,consts:[["id","olMap",1,"w-full","h-full"]],template:function(t,e){1&t&&se._UZ(0,"div",0)}}),n})()}];let Tp=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=se.oAB({type:n}),n.\u0275inj=se.cJS({imports:[q.Bz.forChild(Ep),q.Bz]}),n})(),Rp=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=se.oAB({type:n}),n.\u0275inj=se.cJS({imports:[Pn.ez,Tp]}),n})()},6465:function(Yi){Yi.exports=function(){"use strict";function ir(_,g,x,M,O){!function D(b,A,Y,P,tt){for(;P>Y;){if(P-Y>600){var z=P-Y+1,st=A-Y+1,Ce=Math.log(z),ee=.5*Math.exp(2*Ce/3),ue=.5*Math.sqrt(Ce*ee*(z-ee)/z)*(st-z/2<0?-1:1);D(b,A,Math.max(Y,Math.floor(A-st*ee/z+ue)),Math.min(P,Math.floor(A+(z-st)*ee/z+ue)),tt)}var ce=b[A],we=Y,Ct=P;for(it(b,Y,A),tt(b[P],ce)>0&&it(b,Y,P);we<Ct;){for(it(b,we,Ct),we++,Ct--;tt(b[we],ce)<0;)we++;for(;tt(b[Ct],ce)>0;)Ct--}0===tt(b[Y],ce)?it(b,Y,Ct):it(b,++Ct,P),Ct<=A&&(Y=Ct+1),A<=Ct&&(P=Ct-1)}}(_,g,x||0,M||_.length-1,O||Pn)}function it(_,g,x){var M=_[g];_[g]=_[x],_[x]=M}function Pn(_,g){return _<g?-1:_>g?1:0}var q=function(_){void 0===_&&(_=9),this._maxEntries=Math.max(4,_),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function Ln(_,g,x){if(!x)return g.indexOf(_);for(var M=0;M<g.length;M++)if(x(_,g[M]))return M;return-1}function Bt(_,g){Fe(_,0,_.children.length,g,_)}function Fe(_,g,x,M,O){O||(O=Dt(null)),O.minX=1/0,O.minY=1/0,O.maxX=-1/0,O.maxY=-1/0;for(var D=g;D<x;D++){var b=_.children[D];jt(O,_.leaf?M(b):b)}return O}function jt(_,g){return _.minX=Math.min(_.minX,g.minX),_.minY=Math.min(_.minY,g.minY),_.maxX=Math.max(_.maxX,g.maxX),_.maxY=Math.max(_.maxY,g.maxY),_}function ki(_,g){return _.minX-g.minX}function or(_,g){return _.minY-g.minY}function Or(_){return(_.maxX-_.minX)*(_.maxY-_.minY)}function xe(_){return _.maxX-_.minX+(_.maxY-_.minY)}function Pr(_,g){return _.minX<=g.minX&&_.minY<=g.minY&&g.maxX<=_.maxX&&g.maxY<=_.maxY}function ar(_,g){return g.minX<=_.maxX&&g.minY<=_.maxY&&g.maxX>=_.minX&&g.maxY>=_.minY}function Dt(_){return{children:_,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function In(_,g,x,M,O){for(var D=[g,x];D.length;)if(!((x=D.pop())-(g=D.pop())<=M)){var b=g+Math.ceil((x-g)/M/2)*M;ir(_,b,g,x,O),D.push(g,b,b,x)}}return q.prototype.all=function(){return this._all(this.data,[])},q.prototype.search=function(_){var g=this.data,x=[];if(!ar(_,g))return x;for(var M=this.toBBox,O=[];g;){for(var D=0;D<g.children.length;D++){var b=g.children[D],A=g.leaf?M(b):b;ar(_,A)&&(g.leaf?x.push(b):Pr(_,A)?this._all(b,x):O.push(b))}g=O.pop()}return x},q.prototype.collides=function(_){var g=this.data;if(!ar(_,g))return!1;for(var x=[];g;){for(var M=0;M<g.children.length;M++){var O=g.children[M],D=g.leaf?this.toBBox(O):O;if(ar(_,D)){if(g.leaf||Pr(_,D))return!0;x.push(O)}}g=x.pop()}return!1},q.prototype.load=function(_){if(!_||!_.length)return this;if(_.length<this._minEntries){for(var g=0;g<_.length;g++)this.insert(_[g]);return this}var x=this._build(_.slice(),0,_.length-1,0);if(this.data.children.length)if(this.data.height===x.height)this._splitRoot(this.data,x);else{if(this.data.height<x.height){var M=this.data;this.data=x,x=M}this._insert(x,this.data.height-x.height-1,!0)}else this.data=x;return this},q.prototype.insert=function(_){return _&&this._insert(_,this.data.height-1),this},q.prototype.clear=function(){return this.data=Dt([]),this},q.prototype.remove=function(_,g){if(!_)return this;for(var x,M,O,D=this.data,b=this.toBBox(_),A=[],Y=[];D||A.length;){if(D||(D=A.pop(),M=A[A.length-1],x=Y.pop(),O=!0),D.leaf){var P=Ln(_,D.children,g);if(-1!==P)return D.children.splice(P,1),A.push(D),this._condense(A),this}O||D.leaf||!Pr(D,b)?M?(x++,D=M.children[x],O=!1):D=null:(A.push(D),Y.push(x),x=0,M=D,D=D.children[0])}return this},q.prototype.toBBox=function(_){return _},q.prototype.compareMinX=function(_,g){return _.minX-g.minX},q.prototype.compareMinY=function(_,g){return _.minY-g.minY},q.prototype.toJSON=function(){return this.data},q.prototype.fromJSON=function(_){return this.data=_,this},q.prototype._all=function(_,g){for(var x=[];_;)_.leaf?g.push.apply(g,_.children):x.push.apply(x,_.children),_=x.pop();return g},q.prototype._build=function(_,g,x,M){var O,D=x-g+1,b=this._maxEntries;if(D<=b)return Bt(O=Dt(_.slice(g,x+1)),this.toBBox),O;M||(M=Math.ceil(Math.log(D)/Math.log(b)),b=Math.ceil(D/Math.pow(b,M-1))),(O=Dt([])).leaf=!1,O.height=M;var A=Math.ceil(D/b),Y=A*Math.ceil(Math.sqrt(b));In(_,g,x,Y,this.compareMinX);for(var P=g;P<=x;P+=Y){var tt=Math.min(P+Y-1,x);In(_,P,tt,A,this.compareMinY);for(var z=P;z<=tt;z+=A){var st=Math.min(z+A-1,tt);O.children.push(this._build(_,z,st,M-1))}}return Bt(O,this.toBBox),O},q.prototype._chooseSubtree=function(_,g,x,M){for(;M.push(g),!g.leaf&&M.length-1!==x;){for(var O=1/0,D=1/0,b=void 0,A=0;A<g.children.length;A++){var Y=g.children[A],P=Or(Y),tt=(z=_,st=Y,(Math.max(st.maxX,z.maxX)-Math.min(st.minX,z.minX))*(Math.max(st.maxY,z.maxY)-Math.min(st.minY,z.minY))-P);tt<D?(D=tt,O=P<O?P:O,b=Y):tt===D&&P<O&&(O=P,b=Y)}g=b||g.children[0]}var z,st;return g},q.prototype._insert=function(_,g,x){var M=x?_:this.toBBox(_),O=[],D=this._chooseSubtree(M,this.data,g,O);for(D.children.push(_),jt(D,M);g>=0&&O[g].children.length>this._maxEntries;)this._split(O,g),g--;this._adjustParentBBoxes(M,O,g)},q.prototype._split=function(_,g){var x=_[g],M=x.children.length,O=this._minEntries;this._chooseSplitAxis(x,O,M);var D=this._chooseSplitIndex(x,O,M),b=Dt(x.children.splice(D,x.children.length-D));b.height=x.height,b.leaf=x.leaf,Bt(x,this.toBBox),Bt(b,this.toBBox),g?_[g-1].children.push(b):this._splitRoot(x,b)},q.prototype._splitRoot=function(_,g){this.data=Dt([_,g]),this.data.height=_.height+1,this.data.leaf=!1,Bt(this.data,this.toBBox)},q.prototype._chooseSplitIndex=function(_,g,x){for(var M,O,D,b,A,Y,P,tt=1/0,z=1/0,st=g;st<=x-g;st++){var Ce=Fe(_,0,st,this.toBBox),ee=Fe(_,st,x,this.toBBox),ue=(O=Ce,D=ee,void 0,void 0,void 0,void 0,b=Math.max(O.minX,D.minX),A=Math.max(O.minY,D.minY),Y=Math.min(O.maxX,D.maxX),P=Math.min(O.maxY,D.maxY),Math.max(0,Y-b)*Math.max(0,P-A)),le=Or(Ce)+Or(ee);ue<tt?(tt=ue,M=st,z=le<z?le:z):ue===tt&&le<z&&(z=le,M=st)}return M||x-g},q.prototype._chooseSplitAxis=function(_,g,x){var M=_.leaf?this.compareMinX:ki,O=_.leaf?this.compareMinY:or;this._allDistMargin(_,g,x,M)<this._allDistMargin(_,g,x,O)&&_.children.sort(M)},q.prototype._allDistMargin=function(_,g,x,M){_.children.sort(M);for(var O=this.toBBox,D=Fe(_,0,g,O),b=Fe(_,x-g,x,O),A=xe(D)+xe(b),Y=g;Y<x-g;Y++){var P=_.children[Y];jt(D,_.leaf?O(P):P),A+=xe(D)}for(var tt=x-g-1;tt>=g;tt--){var z=_.children[tt];jt(b,_.leaf?O(z):z),A+=xe(b)}return A},q.prototype._adjustParentBBoxes=function(_,g,x){for(var M=x;M>=0;M--)jt(g[M],_)},q.prototype._condense=function(_){for(var g=_.length-1,x=void 0;g>=0;g--)0===_[g].children.length?g>0?(x=_[g-1].children).splice(x.indexOf(_[g]),1):this.clear():Bt(_[g],this.toBBox)},q}()}}]);